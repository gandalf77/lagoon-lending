/*! For license information please see index.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StacksSbtc=e():t.StacksSbtc=e()}(this,(()=>(()=>{var t,e,r={102:(t,e,r)=>{"use strict";var n,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,c={};((t,e)=>{for(var r in e)o(t,r,{get:e[r],enumerable:!0})})(c,{default:()=>u}),t.exports=(n=c,((t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of s(e))a.call(t,r)||void 0===r||o(t,r,{get:()=>e[r],enumerable:!(n=i(e,r))||n.enumerable});return t})(o({},"__esModule",{value:!0}),n)),r(616);var h=r(237),u=class{hostname;port;protocol;auth;constructor(t){"string"==typeof t&&(t=function(t){const e=new URL(t);return{host:e.hostname,port:parseInt(e.port,10),protocol:e.protocol,user:e.username,pass:e.password}}(t));const e=Object.assign({host:"127.0.0.1",port:8332,user:"devnet",pass:"devnet",protocol:"http"},t||{});this.hostname=e.host,this.port=e.port,this.protocol=e.protocol,this.auth=h.base64.encode((new TextEncoder).encode(`${e.user}:${e.pass}`))}get Typed(){return new Proxy(this,{get:(t,e,r)=>e in t?Reflect.get(t,e,r):async function(r){return await t.call({jsonrpc:"2.0",method:e.toString().toLowerCase(),params:r,id:parseInt(1e5*Math.random())})}})}async call(t){const e={method:"POST",headers:{Authorization:`Basic ${this.auth}`,"Content-Type":"application/json"},body:JSON.stringify(t)},r="Bitcoin JSON-RPC: ",n=await fetch(`${this.protocol}//${this.hostname}:${this.port}`,e);if(401===n.status)throw new Error(r+"Connection Rejected: 401 Unnauthorized");if(403===n.status)throw new Error(r+"Connection Rejected: 403 Forbidden");const o=await n.text();if(500===n.status&&"Work queue depth exceeded"===o){const t=new Error(r+o);throw t.code=429,t}const i=JSON.parse(o);if(!n.ok)throw new Error(`${r}${i?.error?.code} ${i?.error?.message}`);return i.result}}},525:(t,e)=>{"use strict";function r(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function n(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)}function o(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function i(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");r(t.outputLen),r(t.blockLen)}function s(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a(t,e){o(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(e,"__esModule",{value:!0}),e.output=e.exists=e.hash=e.bytes=e.bool=e.number=void 0,e.number=r,e.bool=n,e.bytes=o,e.hash=i,e.exists=s,e.output=a;const c={number:r,bool:n,bytes:o,hash:i,exists:s,output:a};e.default=c},350:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SHA2=void 0;const n=r(525),o=r(64);class i extends o.Hash{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,o.createView)(this.buffer)}update(t){n.default.exists(this);const{view:e,buffer:r,blockLen:i}=this,s=(t=(0,o.toBytes)(t)).length;for(let n=0;n<s;){const a=Math.min(i-this.pos,s-n);if(a!==i)r.set(t.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===i&&(this.process(e,0),this.pos=0);else{const e=(0,o.createView)(t);for(;i<=s-n;n+=i)this.process(e,n)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){n.default.exists(this),n.default.output(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:i,isLE:s}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>i-a&&(this.process(r,0),a=0);for(let t=a;t<i;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,h=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+h,a,n)}(r,i-8,BigInt(8*this.length),s),this.process(r,0);const c=(0,o.createView)(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=h/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<u;t++)c.setUint32(4*t,f[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return t.length=n,t.pos=s,t.finished=o,t.destroyed=i,n%e&&t.buffer.set(r),t}}e.SHA2=i},661:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.crypto=void 0,e.crypto={node:void 0,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0}},53:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sha224=e.sha256=void 0;const n=r(350),o=r(64),i=(t,e,r)=>t&e^t&r^e&r,s=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),c=new Uint32Array(64);class h extends n.SHA2{constructor(){super(64,32,8,!1),this.A=0|a[0],this.B=0|a[1],this.C=0|a[2],this.D=0|a[3],this.E=0|a[4],this.F=0|a[5],this.G=0|a[6],this.H=0|a[7]}get(){const{A:t,B:e,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[t,e,r,n,o,i,s,a]}set(t,e,r,n,o,i,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)c[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=c[t-15],r=c[t-2],n=(0,o.rotr)(e,7)^(0,o.rotr)(e,18)^e>>>3,i=(0,o.rotr)(r,17)^(0,o.rotr)(r,19)^r>>>10;c[t]=i+c[t-7]+n+c[t-16]|0}let{A:r,B:n,C:a,D:h,E:u,F:f,G:l,H:d}=this;for(let t=0;t<64;t++){const e=d+((0,o.rotr)(u,6)^(0,o.rotr)(u,11)^(0,o.rotr)(u,25))+((p=u)&f^~p&l)+s[t]+c[t]|0,y=((0,o.rotr)(r,2)^(0,o.rotr)(r,13)^(0,o.rotr)(r,22))+i(r,n,a)|0;d=l,l=f,f=u,u=h+e|0,h=a,a=n,n=r,r=e+y|0}var p;r=r+this.A|0,n=n+this.B|0,a=a+this.C|0,h=h+this.D|0,u=u+this.E|0,f=f+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(r,n,a,h,u,f,l,d)}roundClean(){c.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class u extends h{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}e.sha256=(0,o.wrapConstructor)((()=>new h)),e.sha224=(0,o.wrapConstructor)((()=>new u))},64:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomBytes=e.wrapConstructorWithOpts=e.wrapConstructor=e.checkOpts=e.Hash=e.concatBytes=e.toBytes=e.utf8ToBytes=e.asyncLoop=e.nextTick=e.hexToBytes=e.bytesToHex=e.isLE=e.rotr=e.createView=e.u32=e.u8=void 0;const n=r(661);if(e.u8=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e.u32=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),e.createView=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),e.rotr=(t,e)=>t<<32-e|t>>>e,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],!e.isLE)throw new Error("Non little-endian hardware is not supported");const o=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function i(t){if("string"!=typeof t)throw new TypeError("utf8ToBytes expected string, got "+typeof t);return(new TextEncoder).encode(t)}function s(t){if("string"==typeof t&&(t=i(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}e.bytesToHex=function(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=o[t[r]];return e},e.hexToBytes=function(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){const n=2*r,o=t.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[r]=i}return e},e.nextTick=async()=>{},e.asyncLoop=async function(t,r,n){let o=Date.now();for(let i=0;i<t;i++){n(i);const t=Date.now()-o;t>=0&&t<r||(await(0,e.nextTick)(),o+=t)}},e.utf8ToBytes=i,e.toBytes=s,e.concatBytes=function(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const o=t[e];r.set(o,n),n+=o.length}return r},e.Hash=class{clone(){return this._cloneInto()}},e.checkOpts=function(t,e){if(void 0!==e&&("object"!=typeof e||(r=e,"[object Object]"!==Object.prototype.toString.call(r)||r.constructor!==Object)))throw new TypeError("Options should be object or undefined");var r;return Object.assign(t,e)},e.wrapConstructor=function(t){const e=e=>t().update(s(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e},e.wrapConstructorWithOpts=function(t){const e=(e,r)=>t(r).update(s(e)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=e=>t(e),e},e.randomBytes=function(t=32){if(n.crypto.web)return n.crypto.web.getRandomValues(new Uint8Array(t));if(n.crypto.node)return new Uint8Array(n.crypto.node.randomBytes(t).buffer);throw new Error("The environment doesn't have randomBytes function")}},237:(t,e)=>{"use strict";function r(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function n(...t){const e=(t,e)=>r=>t(e(r));return{encode:Array.from(t).reverse().reduce(((t,r)=>t?e(t,r.encode):r.encode),void 0),decode:t.reduce(((t,r)=>t?e(t,r.decode):r.decode),void 0)}}function o(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(r(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const r=t.indexOf(e);if(-1===r)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return r}))}}}function i(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function s(t,e="="){if(r(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;r.length*t%8;)r.push(e);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let n=r.length;if(n*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if(!((n-1)*t%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function a(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function c(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let o=0;const i=[],s=Array.from(t);for(s.forEach((t=>{if(r(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,r=!0;for(let i=o;i<s.length;i++){const a=s[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");t=c%n;const h=Math.floor(c/n);if(s[i]=h,!Number.isSafeInteger(h)||h*n+t!==c)throw new Error("convertRadix: carry overflow");r&&(h?r=!1:o=i)}if(i.push(t),r)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64urlnopad=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=r;const h=(t,e)=>e?h(e,t%e):t,u=(t,e)=>t+(e-h(t,e));function f(t,e,n,o){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(u(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${u(e,n)}`);let i=0,s=0;const a=2**n-1,c=[];for(const o of t){if(r(o),o>=2**e)throw new Error(`convertRadix2: invalid data word=${o} from=${e}`);if(i=i<<e|o,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);i&=2**s-1}if(i=i<<n-s&a,!o&&s>=e)throw new Error("Excess padding");if(!o&&i)throw new Error(`Non-zero padding: ${i}`);return o&&s>0&&c.push(i>>>0),c}function l(t){return r(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(e,t,256))}}}function d(t,e=!1){if(r(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,t)>32||u(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(r),8,t,!e)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(r,t,8,e))}}}function p(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}function y(t,e){if(r(t),"function"!=typeof e)throw new Error("checksum fn should be function");return{encode(r){if(!(r instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const n=e(r).slice(0,t),o=new Uint8Array(r.length+t);return o.set(r),o.set(n,r.length),o},decode(r){if(!(r instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const n=r.slice(0,-t),o=e(n).slice(0,t),i=r.slice(-t);for(let e=0;e<t;e++)if(o[e]!==i[e])throw new Error("Invalid checksum");return n}}}e.utils={alphabet:o,chain:n,checksum:y,radix:l,radix2:d,join:i,padding:s},e.base16=n(d(4),o("0123456789ABCDEF"),i("")),e.base32=n(d(5),o("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),s(5),i("")),e.base32hex=n(d(5),o("0123456789ABCDEFGHIJKLMNOPQRSTUV"),s(5),i("")),e.base32crockford=n(d(5),o("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),i(""),a((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=n(d(6),o("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s(6),i("")),e.base64url=n(d(6),o("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),s(6),i("")),e.base64urlnopad=n(d(6),o("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),i(""));const w=t=>n(l(58),o(t),i(""));e.base58=w("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=w("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=w("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const g=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let r="";for(let n=0;n<t.length;n+=8){const o=t.subarray(n,n+8);r+=e.base58.encode(o).padStart(g[o.length],"1")}return r},decode(t){let r=[];for(let n=0;n<t.length;n+=11){const o=t.slice(n,n+11),i=g.indexOf(o.length),s=e.base58.decode(o);for(let t=0;t<s.length-i;t++)if(0!==s[t])throw new Error("base58xmr: wrong padding");r=r.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(r)}},e.base58check=t=>n(y(4,(e=>t(t(e)))),e.base58);const b=n(o("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),i("")),E=[996825010,642813549,513874426,1027748829,705979059];function m(t){const e=t>>25;let r=(33554431&t)<<5;for(let t=0;t<E.length;t++)1==(e>>t&1)&&(r^=E[t]);return r}function x(t,e,r=1){const n=t.length;let o=1;for(let e=0;e<n;e++){const r=t.charCodeAt(e);if(r<33||r>126)throw new Error(`Invalid prefix (${t})`);o=m(o)^r>>5}o=m(o);for(let e=0;e<n;e++)o=m(o)^31&t.charCodeAt(e);for(let t of e)o=m(o)^t;for(let t=0;t<6;t++)o=m(o);return o^=r,b.encode(f([o%2**30],30,5,!1))}function A(t){const e="bech32"===t?1:734539939,r=d(5),n=r.decode,o=r.encode,i=p(n);function s(t,r=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==r&&t.length>r)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${r})`);const n=t.toLowerCase();if(t!==n&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(t=n).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=t.slice(0,o),s=t.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=b.decode(s).slice(0,-6),c=x(i,a,e);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(t,r,n=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof r);const o=t.length+7+r.length;if(!1!==n&&o>n)throw new TypeError(`Length ${o} exceeds limit ${n}`);const i=t.toLowerCase(),s=x(i,r,e);return`${i}1${b.encode(r)}${s}`},decode:s,decodeToBytes:function(t){const{prefix:e,words:r}=s(t,!1);return{prefix:e,words:r,bytes:n(r)}},decodeUnsafe:p(s),fromWords:n,fromWordsUnsafe:i,toWords:o}}e.bech32=A("bech32"),e.bech32m=A("bech32m"),e.utf8={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},e.hex=n(d(4),o("0123456789abcdef"),i(""),a((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const S={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},v="Invalid encoding type. Available types: utf8, hex, base16, base32, base64, base64url, base58, base58xmr";e.bytesToString=(t,e)=>{if("string"!=typeof t||!S.hasOwnProperty(t))throw new TypeError(v);if(!(e instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return S[t].encode(e)},e.str=e.bytesToString,e.stringToBytes=(t,e)=>{if(!S.hasOwnProperty(t))throw new TypeError(v);if("string"!=typeof e)throw new TypeError("stringToBytes() expects string");return S[t].decode(e)},e.bytes=e.stringToBytes},166:t=>{"use strict";t.exports=function(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var n=0;n<t.length;n++){var o=t.charAt(n),i=o.charCodeAt(0);if(255!==e[i])throw new TypeError(o+" is ambiguous");e[i]=n}var s=t.length,a=t.charAt(0),c=Math.log(s)/Math.log(256),h=Math.log(256)/Math.log(s);function u(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var r=0,n=0,o=0;t[r]===a;)n++,r++;for(var i=(t.length-r)*c+1>>>0,h=new Uint8Array(i);t[r];){var u=e[t.charCodeAt(r)];if(255===u)return;for(var f=0,l=i-1;(0!==u||f<o)&&-1!==l;l--,f++)u+=s*h[l]>>>0,h[l]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");o=f,r++}for(var d=i-o;d!==i&&0===h[d];)d++;for(var p=new Uint8Array(n+(i-d)),y=n;d!==i;)p[y++]=h[d++];return p}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var r=0,n=0,o=0,i=e.length;o!==i&&0===e[o];)o++,r++;for(var c=(i-o)*h+1>>>0,u=new Uint8Array(c);o!==i;){for(var f=e[o],l=0,d=c-1;(0!==f||l<n)&&-1!==d;d--,l++)f+=256*u[d]>>>0,u[d]=f%s>>>0,f=f/s>>>0;if(0!==f)throw new Error("Non-zero carry");n=l,o++}for(var p=c-n;p!==c&&0===u[p];)p++;for(var y=a.repeat(r);p<c;++p)y+=t.charAt(u[p]);return y},decodeUnsafe:u,decode:function(t){var e=u(t);if(e)return e;throw new Error("Non-base"+s+" character")}}}},22:(t,e,r)=>{const n=r(166);t.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},98:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32ToB58=e.b58ToC32=e.c32addressDecode=e.c32address=e.versions=void 0;const n=r(392),o=r(716),i=r(64);e.versions={mainnet:{p2pkh:22,p2sh:20},testnet:{p2pkh:26,p2sh:21}};const s={};s[0]=e.versions.mainnet.p2pkh,s[5]=e.versions.mainnet.p2sh,s[111]=e.versions.testnet.p2pkh,s[196]=e.versions.testnet.p2sh;const a={};function c(t,e){if(!e.match(/^[0-9a-fA-F]{40}$/))throw new Error("Invalid argument: not a hash160 hex string");return`S${(0,n.c32checkEncode)(t,e)}`}function h(t){if(t.length<=5)throw new Error("Invalid c32 address: invalid length");if("S"!=t[0])throw new Error('Invalid c32 address: must start with "S"');return(0,n.c32checkDecode)(t.slice(1))}a[e.versions.mainnet.p2pkh]=0,a[e.versions.mainnet.p2sh]=5,a[e.versions.testnet.p2pkh]=111,a[e.versions.testnet.p2sh]=196,e.c32address=c,e.c32addressDecode=h,e.b58ToC32=function(t,e=-1){const r=o.decode(t),n=(0,i.bytesToHex)(r.data),a=parseInt((0,i.bytesToHex)(r.prefix),16);let h;return e<0?(h=a,void 0!==s[a]&&(h=s[a])):h=e,c(h,n)},e.c32ToB58=function(t,e=-1){const r=h(t),n=r[0],i=r[1];let s;e<0?(s=n,void 0!==a[n]&&(s=a[n])):s=e;let c=s.toString(16);return 1===c.length&&(c=`0${c}`),o.encode(i,c)}},716:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.encode=void 0;const n=r(53),o=r(64),i=r(166),s="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";e.encode=function(t,e="00"){const r="string"==typeof t?(0,o.hexToBytes)(t):t,a="string"==typeof e?(0,o.hexToBytes)(e):t;if(!(r instanceof Uint8Array&&a instanceof Uint8Array))throw new TypeError("Argument must be of type Uint8Array or string");const c=(0,n.sha256)((0,n.sha256)(new Uint8Array([...a,...r])));return i(s).encode([...a,...r,...c.slice(0,4)])},e.decode=function(t){const e=i(s).decode(t),r=e.slice(0,1),o=e.slice(1,-4),a=(0,n.sha256)((0,n.sha256)(new Uint8Array([...r,...o])));return e.slice(-4).forEach(((t,e)=>{if(t!==a[e])throw new Error("Invalid checksum")})),{prefix:r,data:o}}},392:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32checkDecode=e.c32checkEncode=void 0;const n=r(53),o=r(64),i=r(103);function s(t){const e=(0,n.sha256)((0,n.sha256)((0,o.hexToBytes)(t)));return(0,o.bytesToHex)(e.slice(0,4))}e.c32checkEncode=function(t,e){if(t<0||t>=32)throw new Error("Invalid version (must be between 0 and 31)");if(!e.match(/^[0-9a-fA-F]*$/))throw new Error("Invalid data (not a hex string)");(e=e.toLowerCase()).length%2!=0&&(e=`0${e}`);let r=t.toString(16);1===r.length&&(r=`0${r}`);const n=s(`${r}${e}`),o=(0,i.c32encode)(`${e}${n}`);return`${i.c32[t]}${o}`},e.c32checkDecode=function(t){t=(0,i.c32normalize)(t);const e=(0,i.c32decode)(t.slice(1)),r=t[0],n=i.c32.indexOf(r),o=e.slice(-8);let a=n.toString(16);if(1===a.length&&(a=`0${a}`),s(`${a}${e.substring(0,e.length-8)}`)!==o)throw new Error("Invalid c32check string: checksum mismatch");return[n,e.substring(0,e.length-8)]}},103:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.c32decode=e.c32normalize=e.c32encode=e.c32=void 0;const n=r(64);e.c32="0123456789ABCDEFGHJKMNPQRSTVWXYZ";const o="0123456789abcdef";function i(t){return t.toUpperCase().replace(/O/g,"0").replace(/L|I/g,"1")}e.c32encode=function(t,r){if(!t.match(/^[0-9a-fA-F]*$/))throw new Error("Not a hex-encoded string");t.length%2!=0&&(t=`0${t}`);let i=[],s=0;for(let r=(t=t.toLowerCase()).length-1;r>=0;r--)if(s<4){const n=o.indexOf(t[r])>>s;let a=0;0!==r&&(a=o.indexOf(t[r-1]));const c=1+s,h=a%(1<<c)<<5-c,u=e.c32[n+h];s=c,i.unshift(u)}else s=0;let a=0;for(let t=0;t<i.length&&"0"===i[t];t++)a++;i=i.slice(a);const c=(new TextDecoder).decode((0,n.hexToBytes)(t)).match(/^\u0000*/),h=c?c[0].length:0;for(let t=0;t<h;t++)i.unshift(e.c32[0]);if(r){const t=r-i.length;for(let r=0;r<t;r++)i.unshift(e.c32[0])}return i.join("")},e.c32normalize=i,e.c32decode=function(t,r){if(!(t=i(t)).match(`^[${e.c32}]*$`))throw new Error("Not a c32-encoded string");const n=t.match(`^${e.c32[0]}*`),s=n?n[0].length:0;let a=[],c=0,h=0;for(let r=t.length-1;r>=0;r--){4===h&&(a.unshift(o[c]),h=0,c=0);const n=(e.c32.indexOf(t[r])<<h)+c,i=o[n%16];if(h+=1,c=n>>4,c>1<<h)throw new Error("Panic error in decoding.");a.unshift(i)}a.unshift(o[c]),a.length%2==1&&a.unshift("0");let u=0;for(let t=0;t<a.length&&"0"===a[t];t++)u++;a=a.slice(u-u%2);let f=a.join("");for(let t=0;t<s;t++)f=`00${f}`;if(r){const t=2*r-f.length;for(let e=0;e<t;e+=2)f=`00${f}`}return f}},870:(t,e,r)=>{"use strict";e.yI=e.H4=void 0;r(103),r(392);const n=r(98);Object.defineProperty(e,"H4",{enumerable:!0,get:function(){return n.c32address}}),Object.defineProperty(e,"yI",{enumerable:!0,get:function(){return n.c32addressDecode}})},616:function(){!function(t){!function(e){var r="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,s="ArrayBuffer"in t;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function h(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function l(t){this.map={},t instanceof l?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function d(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function p(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function y(t){var e=new FileReader,r=p(e);return e.readAsArrayBuffer(t),r}function w(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:o&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&o&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=w(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||c(t))?this._bodyArrayBuffer=w(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=d(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,r,n=d(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,r=p(e=new FileReader),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(t,e){t=h(t),e=u(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},l.prototype.delete=function(t){delete this.map[h(t)]},l.prototype.get=function(t){return t=h(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(h(t))},l.prototype.set=function(t,e){this.map[h(t)]=u(e)},l.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},l.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),f(t)},l.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),f(t)},l.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),f(t)},n&&(l.prototype[Symbol.iterator]=l.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function E(t,e){var r,n,o=(e=e||{}).body;if(t instanceof E){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new l(e.headers)),this.method=(n=(r=e.method||this.method||"GET").toUpperCase(),b.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function m(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}})),e}function x(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new l(e.headers),this.url=e.url||"",this._initBody(t)}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},g.call(E.prototype),g.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},x.error=function(){var t=new x(null,{status:0,statusText:""});return t.type="error",t};var A=[301,302,303,307,308];x.redirect=function(t,e){if(-1===A.indexOf(e))throw new RangeError("Invalid status code");return new x(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function S(t,r){return new Promise((function(n,i){var s=new E(t,r);if(s.signal&&s.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new l,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();e.append(n,o)}})),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new x(o,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&o&&(a.responseType="blob"),s.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}S.polyfill=!0,t.fetch||(t.fetch=S,t.Headers=l,t.Request=E,t.Response=x),e.Headers=l,e.Request=E,e.Response=x,e.fetch=S,Object.defineProperty(e,"__esModule",{value:!0})}({})}("undefined"!=typeof self?self:this)},907:(t,e,r)=>{t=r.nmd(t);var n="__lodash_hash_undefined__",o=9007199254740991,i="[object Arguments]",s="[object Boolean]",a="[object Date]",c="[object Function]",h="[object GeneratorFunction]",u="[object Map]",f="[object Number]",l="[object Object]",d="[object Promise]",p="[object RegExp]",y="[object Set]",w="[object String]",g="[object Symbol]",b="[object WeakMap]",E="[object ArrayBuffer]",m="[object DataView]",x="[object Float32Array]",A="[object Float64Array]",S="[object Int8Array]",v="[object Int16Array]",I="[object Int32Array]",B="[object Uint8Array]",U="[object Uint8ClampedArray]",T="[object Uint16Array]",k="[object Uint32Array]",O=/\w*$/,P=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,N={};N[i]=N["[object Array]"]=N[E]=N[m]=N[s]=N[a]=N[x]=N[A]=N[S]=N[v]=N[I]=N[u]=N[f]=N[l]=N[p]=N[y]=N[w]=N[g]=N[B]=N[U]=N[T]=N[k]=!0,N["[object Error]"]=N[c]=N[b]=!1;var C="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,H="object"==typeof self&&self&&self.Object===Object&&self,$=C||H||Function("return this")(),_=e&&!e.nodeType&&e,R=_&&t&&!t.nodeType&&t,D=R&&R.exports===_;function F(t,e){return t.set(e[0],e[1]),t}function K(t,e){return t.add(e),t}function j(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function M(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function W(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function z(t,e){return function(r){return t(e(r))}}function V(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var G,q=Array.prototype,Y=Function.prototype,Z=Object.prototype,Q=$["__core-js_shared__"],X=(G=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"",J=Y.toString,tt=Z.hasOwnProperty,et=Z.toString,rt=RegExp("^"+J.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=D?$.Buffer:void 0,ot=$.Symbol,it=$.Uint8Array,st=z(Object.getPrototypeOf,Object),at=Object.create,ct=Z.propertyIsEnumerable,ht=q.splice,ut=Object.getOwnPropertySymbols,ft=nt?nt.isBuffer:void 0,lt=z(Object.keys,Object),dt=$t($,"DataView"),pt=$t($,"Map"),yt=$t($,"Promise"),wt=$t($,"Set"),gt=$t($,"WeakMap"),bt=$t(Object,"create"),Et=Kt(dt),mt=Kt(pt),xt=Kt(yt),At=Kt(wt),St=Kt(gt),vt=ot?ot.prototype:void 0,It=vt?vt.valueOf:void 0;function Bt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ut(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Tt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function kt(t){this.__data__=new Ut(t)}function Ot(t,e,r){var n=t[e];tt.call(t,e)&&jt(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function Pt(t,e){for(var r=t.length;r--;)if(jt(t[r][0],e))return r;return-1}function Lt(t,e,r,n,o,d,b){var P;if(n&&(P=d?n(t,o,d,b):n(t)),void 0!==P)return P;if(!Gt(t))return t;var L=Mt(t);if(L){if(P=function(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&tt.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!e)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,P)}else{var C=Rt(t),H=C==c||C==h;if(zt(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if(C==l||C==i||H&&!d){if(M(t))return d?t:{};if(P=function(t){return"function"!=typeof t.constructor||Ft(t)?{}:Gt(e=st(t))?at(e):{};var e}(H?{}:t),!e)return function(t,e){return Ct(t,_t(t),e)}(t,function(t,e){return t&&Ct(e,qt(e),t)}(P,t))}else{if(!N[C])return d?t:{};P=function(t,e,r,n){var o,i=t.constructor;switch(e){case E:return Nt(t);case s:case a:return new i(+t);case m:return function(t,e){var r=e?Nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,n);case x:case A:case S:case v:case I:case B:case U:case T:case k:return function(t,e){var r=e?Nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,n);case u:return function(t,e,r){return j(e?r(W(t),!0):W(t),F,new t.constructor)}(t,n,r);case f:case w:return new i(t);case p:return function(t){var e=new t.constructor(t.source,O.exec(t));return e.lastIndex=t.lastIndex,e}(t);case y:return function(t,e,r){return j(e?r(V(t),!0):V(t),K,new t.constructor)}(t,n,r);case g:return o=t,It?Object(It.call(o)):{}}}(t,C,Lt,e)}}b||(b=new kt);var $=b.get(t);if($)return $;if(b.set(t,P),!L)var _=r?function(t){return function(t,e,r){var n=e(t);return Mt(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,qt,_t)}(t):qt(t);return function(t,e){for(var r=-1,n=t?t.length:0;++r<n&&!1!==e(t[r],r););}(_||t,(function(o,i){_&&(o=t[i=o]),Ot(P,i,Lt(o,e,r,n,i,t,b))})),P}function Nt(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Ct(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var s=e[o],a=n?n(r[s],t[s],s,r,t):void 0;Ot(r,s,void 0===a?t[s]:a)}return r}function Ht(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function $t(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Gt(t)||(e=t,X&&X in e))&&(Vt(t)||M(t)?rt:P).test(Kt(t));var e}(r)?r:void 0}Bt.prototype.clear=function(){this.__data__=bt?bt(null):{}},Bt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Bt.prototype.get=function(t){var e=this.__data__;if(bt){var r=e[t];return r===n?void 0:r}return tt.call(e,t)?e[t]:void 0},Bt.prototype.has=function(t){var e=this.__data__;return bt?void 0!==e[t]:tt.call(e,t)},Bt.prototype.set=function(t,e){return this.__data__[t]=bt&&void 0===e?n:e,this},Ut.prototype.clear=function(){this.__data__=[]},Ut.prototype.delete=function(t){var e=this.__data__,r=Pt(e,t);return!(r<0||(r==e.length-1?e.pop():ht.call(e,r,1),0))},Ut.prototype.get=function(t){var e=this.__data__,r=Pt(e,t);return r<0?void 0:e[r][1]},Ut.prototype.has=function(t){return Pt(this.__data__,t)>-1},Ut.prototype.set=function(t,e){var r=this.__data__,n=Pt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},Tt.prototype.clear=function(){this.__data__={hash:new Bt,map:new(pt||Ut),string:new Bt}},Tt.prototype.delete=function(t){return Ht(this,t).delete(t)},Tt.prototype.get=function(t){return Ht(this,t).get(t)},Tt.prototype.has=function(t){return Ht(this,t).has(t)},Tt.prototype.set=function(t,e){return Ht(this,t).set(t,e),this},kt.prototype.clear=function(){this.__data__=new Ut},kt.prototype.delete=function(t){return this.__data__.delete(t)},kt.prototype.get=function(t){return this.__data__.get(t)},kt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Ut){var n=r.__data__;if(!pt||n.length<199)return n.push([t,e]),this;r=this.__data__=new Tt(n)}return r.set(t,e),this};var _t=ut?z(ut,Object):function(){return[]},Rt=function(t){return et.call(t)};function Dt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||L.test(t))&&t>-1&&t%1==0&&t<e}function Ft(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Z)}function Kt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function jt(t,e){return t===e||t!=t&&e!=e}(dt&&Rt(new dt(new ArrayBuffer(1)))!=m||pt&&Rt(new pt)!=u||yt&&Rt(yt.resolve())!=d||wt&&Rt(new wt)!=y||gt&&Rt(new gt)!=b)&&(Rt=function(t){var e=et.call(t),r=e==l?t.constructor:void 0,n=r?Kt(r):void 0;if(n)switch(n){case Et:return m;case mt:return u;case xt:return d;case At:return y;case St:return b}return e});var Mt=Array.isArray;function Wt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}(t.length)&&!Vt(t)}var zt=ft||function(){return!1};function Vt(t){var e=Gt(t)?et.call(t):"";return e==c||e==h}function Gt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function qt(t){return Wt(t)?function(t,e){var r=Mt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Wt(t)}(t)&&tt.call(t,"callee")&&(!ct.call(t,"callee")||et.call(t)==i)}(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],n=r.length,o=!!n;for(var s in t)!e&&!tt.call(t,s)||o&&("length"==s||Dt(s,n))||r.push(s);return r}(t):function(t){if(!Ft(t))return lt(t);var e=[];for(var r in Object(t))tt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}t.exports=function(t){return Lt(t,!0,!0)}},314:()=>{}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var i=Object.create(null);o.r(i);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&n&&r;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>r[t]));return s.default=()=>r,o.d(i,s),i},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var i={};return(()=>{"use strict";o.r(i),o.d(i,{DEFAULT_UTXO_TO_SPENDABLE:()=>Bh,DevEnvHelper:()=>Ch,MAINNET:()=>lh,MagicBytes:()=>uh,OVERHEAD_TX:()=>yh,OpCode:()=>fh,REGTEST:()=>ph,SBTC_FT_ADDRESS_DEVENV:()=>hh,SBTC_FT_ADDRESS_TESTNET:()=>ch,SBTC_PEG_ADDRESS_DEVENV:()=>ah,SBTC_PEG_ADDRESS_TESTNET:()=>sh,SbtcApiHelper:()=>Lh,TESTNET:()=>dh,TestnetHelper:()=>Nh,VSIZE_INPUT_P2WPKH:()=>wh,WALLET_00:()=>Hh,WALLET_01:()=>$h,WALLET_02:()=>_h,buildSBtcDepositBtcPayload:()=>jh,buildSBtcWithdrawBtcPayload:()=>Zh,buildSbtcDepositTx:()=>Mh,buildSbtcDepositTxOpReturn:()=>Wh,buildSbtcWithdrawTx:()=>qh,buildSbtcWithdrawTxOpReturn:()=>Yh,dustMinimum:()=>vh,getBitcoinAccount:()=>Rh,getStacksAccount:()=>Dh,inputBytes:()=>Ah,lengthPrefixedString:()=>Eh,outputBytes:()=>Sh,paymentInfo:()=>mh,sbtcDepositHelper:()=>zh,sbtcWithdrawHelper:()=>Gh,sbtcWithdrawMessage:()=>Qh,shUtxoToSpendable:()=>Th,sleep:()=>Fh,stacksAddressBytes:()=>bh,switchUtxoToSpendable:()=>Oh,txBytes:()=>xh,utxoSelect:()=>kh,wpkhUtxoToSpendable:()=>Uh,wrapLazyProxy:()=>Ph});var t={};function e(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function r(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function n(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");e(t.outputLen),e(t.blockLen)}function s(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}o.r(t),o.d(t,{dQ:()=>jt,ci:()=>Nt,bytesToNumberBE:()=>$t,ty:()=>_t,eV:()=>Kt,n$:()=>zt,ql:()=>Ft,hexToBytes:()=>Ht,tL:()=>Rt,S5:()=>Dt,FF:()=>Gt});const a=t=>t instanceof Uint8Array,c=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),h=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const u=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0"))),f=async()=>{};async function l(t,e,r){let n=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-n;t>=0&&t<e||(await f(),n+=t)}}function d(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}function p(t){if("string"==typeof t&&(t=d(t)),!a(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function y(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let r=0;return t.forEach((t=>{if(!a(t))throw new Error("Uint8Array expected");e.set(t,r),r+=t.length})),e}class w{clone(){return this._cloneInto()}}const g={}.toString;function b(t){const e=e=>t().update(p(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}class E extends w{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,n(t);const r=p(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return s(this),this.iHash.update(t),this}digestInto(t){s(this),r(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return t.finished=n,t.destroyed=o,t.blockLen=i,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const m=(t,e,r)=>new E(t,e).update(r).digest();m.create=(t,e)=>new E(t,e);class x extends w{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=c(this.buffer)}update(t){s(this);const{view:e,buffer:r,blockLen:n}=this,o=(t=p(t)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=c(t);for(;n<=o-i;i+=n)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){s(this),function(t,e){r(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:o,isLE:i}=this;let{pos:a}=this;e[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(n,0),a=0);for(let t=a;t<o;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,h=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+h,a,n)}(n,o-8,BigInt(8*this.length),i),this.process(n,0);const h=c(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=u/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<f;t++)h.setUint32(4*t,l[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return t.length=n,t.pos=s,t.finished=o,t.destroyed=i,n%e&&t.buffer.set(r),t}}const A=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),S=Uint8Array.from({length:16},((t,e)=>e));let v=[S],I=[S.map((t=>(9*t+5)%16))];for(let t=0;t<4;t++)for(let e of[v,I])e.push(e[t].map((t=>A[t])));const B=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((t=>new Uint8Array(t))),U=v.map(((t,e)=>t.map((t=>B[e][t])))),T=I.map(((t,e)=>t.map((t=>B[e][t])))),k=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),O=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),P=(t,e)=>t<<e|t>>>32-e;function L(t,e,r,n){return 0===t?e^r^n:1===t?e&r|~e&n:2===t?(e|~r)^n:3===t?e&n|r&~n:e^(r|~n)}const N=new Uint32Array(16);class C extends x{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:e,h2:r,h3:n,h4:o}=this;return[t,e,r,n,o]}set(t,e,r,n,o){this.h0=0|t,this.h1=0|e,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(t,e){for(let r=0;r<16;r++,e+=4)N[r]=t.getUint32(e,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,a=s,c=0|this.h3,h=c,u=0|this.h4,f=u;for(let t=0;t<5;t++){const e=4-t,l=k[t],d=O[t],p=v[t],y=I[t],w=U[t],g=T[t];for(let e=0;e<16;e++){const n=P(r+L(t,o,s,c)+N[p[e]]+l,w[e])+u|0;r=u,u=c,c=0|P(s,10),s=o,o=n}for(let t=0;t<16;t++){const r=P(n+L(e,i,a,h)+N[y[t]]+d,g[t])+f|0;n=f,f=h,h=0|P(a,10),a=i,i=r}}this.set(this.h1+s+h|0,this.h2+c+f|0,this.h3+u+n|0,this.h4+r+i|0,this.h0+o+a|0)}roundClean(){N.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const H=b((()=>new C)),$=(t,e,r)=>t&e^t&r^e&r,_=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),R=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),D=new Uint32Array(64);class F extends x{constructor(){super(64,32,8,!1),this.A=0|R[0],this.B=0|R[1],this.C=0|R[2],this.D=0|R[3],this.E=0|R[4],this.F=0|R[5],this.G=0|R[6],this.H=0|R[7]}get(){const{A:t,B:e,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[t,e,r,n,o,i,s,a]}set(t,e,r,n,o,i,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)D[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=D[t-15],r=D[t-2],n=h(e,7)^h(e,18)^e>>>3,o=h(r,17)^h(r,19)^r>>>10;D[t]=o+D[t-7]+n+D[t-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:a,G:c,H:u}=this;for(let t=0;t<64;t++){const e=u+(h(s,6)^h(s,11)^h(s,25))+((f=s)&a^~f&c)+_[t]+D[t]|0,l=(h(r,2)^h(r,13)^h(r,22))+$(r,n,o)|0;u=c,c=a,a=s,s=i+e|0,i=o,o=n,n=r,r=e+l|0}var f;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,o,i,s,a,c,u)}roundClean(){D.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const K=b((()=>new F)),j=BigInt(2**32-1),M=BigInt(32);function W(t,e=!1){return e?{h:Number(t&j),l:Number(t>>M&j)}:{h:0|Number(t>>M&j),l:0|Number(t&j)}}const z=function(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:i,l:s}=W(t[o],e);[r[o],n[o]]=[i,s]}return[r,n]},V=(t,e,r)=>t>>>r,G=(t,e,r)=>t<<32-r|e>>>r,q=(t,e,r)=>t>>>r|e<<32-r,Y=(t,e,r)=>t<<32-r|e>>>r,Z=(t,e,r)=>t<<64-r|e>>>r-32,Q=(t,e,r)=>t>>>r-32|e<<64-r,X=function(t,e,r,n){const o=(e>>>0)+(n>>>0);return{h:t+r+(o/2**32|0)|0,l:0|o}},J=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),tt=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,et=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),rt=(t,e,r,n,o)=>e+r+n+o+(t/2**32|0)|0,nt=(t,e,r,n,o,i)=>e+r+n+o+i+(t/2**32|0)|0,ot=(t,e,r,n,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(o>>>0),[it,st]=(()=>z(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))))(),at=new Uint32Array(80),ct=new Uint32Array(80);class ht extends x{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:a,Eh:c,El:h,Fh:u,Fl:f,Gh:l,Gl:d,Hh:p,Hl:y}=this;return[t,e,r,n,o,i,s,a,c,h,u,f,l,d,p,y]}set(t,e,r,n,o,i,s,a,c,h,u,f,l,d,p,y){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|u,this.Fl=0|f,this.Gh=0|l,this.Gl=0|d,this.Hh=0|p,this.Hl=0|y}process(t,e){for(let r=0;r<16;r++,e+=4)at[r]=t.getUint32(e),ct[r]=t.getUint32(e+=4);for(let t=16;t<80;t++){const e=0|at[t-15],r=0|ct[t-15],n=q(e,r,1)^q(e,r,8)^V(e,r,7),o=Y(e,r,1)^Y(e,r,8)^G(e,r,7),i=0|at[t-2],s=0|ct[t-2],a=q(i,s,19)^Z(i,s,61)^V(i,s,6),c=Y(i,s,19)^Q(i,s,61)^G(i,s,6),h=et(o,c,ct[t-7],ct[t-16]),u=rt(h,n,a,at[t-7],at[t-16]);at[t]=0|u,ct[t]=0|h}let{Ah:r,Al:n,Bh:o,Bl:i,Ch:s,Cl:a,Dh:c,Dl:h,Eh:u,El:f,Fh:l,Fl:d,Gh:p,Gl:y,Hh:w,Hl:g}=this;for(let t=0;t<80;t++){const e=q(u,f,14)^q(u,f,18)^Z(u,f,41),b=Y(u,f,14)^Y(u,f,18)^Q(u,f,41),E=u&l^~u&p,m=ot(g,b,f&d^~f&y,st[t],ct[t]),x=nt(m,w,e,E,it[t],at[t]),A=0|m,S=q(r,n,28)^Z(r,n,34)^Z(r,n,39),v=Y(r,n,28)^Q(r,n,34)^Q(r,n,39),I=r&o^r&s^o&s,B=n&i^n&a^i&a;w=0|p,g=0|y,p=0|l,y=0|d,l=0|u,d=0|f,({h:u,l:f}=X(0|c,0|h,0|x,0|A)),c=0|s,h=0|a,s=0|o,a=0|i,o=0|r,i=0|n;const U=J(A,v,B);r=tt(U,x,S,I),n=0|U}({h:r,l:n}=X(0|this.Ah,0|this.Al,0|r,0|n)),({h:o,l:i}=X(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:a}=X(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:h}=X(0|this.Dh,0|this.Dl,0|c,0|h)),({h:u,l:f}=X(0|this.Eh,0|this.El,0|u,0|f)),({h:l,l:d}=X(0|this.Fh,0|this.Fl,0|l,0|d)),({h:p,l:y}=X(0|this.Gh,0|this.Gl,0|p,0|y)),({h:w,l:g}=X(0|this.Hh,0|this.Hl,0|w,0|g)),this.set(r,n,o,i,s,a,c,h,u,f,l,d,p,y,w,g)}roundClean(){at.fill(0),ct.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ut=b((()=>new ht));function ft(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function lt(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function dt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const pt="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,yt=t=>t instanceof Uint8Array,wt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),gt=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function bt(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!yt(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class Et{clone(){return this._cloneInto()}}function mt(t){const e=e=>t().update(bt(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xt(t=32){if(pt&&"function"==typeof pt.getRandomValues)return pt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class At extends Et{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=wt(this.buffer)}update(t){dt(this);const{view:e,buffer:r,blockLen:n}=this,o=(t=bt(t)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=wt(t);for(;n<=o-i;i+=n)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){dt(this),function(t,e){lt(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let t=i;t<n;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,h=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+h,a,n)}(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=wt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)s.setUint32(4*t,h[t],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return t.length=n,t.pos=s,t.finished=o,t.destroyed=i,n%e&&t.buffer.set(r),t}}const St=(t,e,r)=>t&e^t&r^e&r,vt=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),It=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Bt=new Uint32Array(64);class Ut extends At{constructor(){super(64,32,8,!1),this.A=0|It[0],this.B=0|It[1],this.C=0|It[2],this.D=0|It[3],this.E=0|It[4],this.F=0|It[5],this.G=0|It[6],this.H=0|It[7]}get(){const{A:t,B:e,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[t,e,r,n,o,i,s,a]}set(t,e,r,n,o,i,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)Bt[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=Bt[t-15],r=Bt[t-2],n=gt(e,7)^gt(e,18)^e>>>3,o=gt(r,17)^gt(r,19)^r>>>10;Bt[t]=o+Bt[t-7]+n+Bt[t-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(gt(s,6)^gt(s,11)^gt(s,25))+((u=s)&a^~u&c)+vt[t]+Bt[t]|0,f=(gt(r,2)^gt(r,13)^gt(r,22))+St(r,n,o)|0;h=c,c=a,a=s,s=i+e|0,i=o,o=n,n=r,r=e+f|0}var u;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,n,o,i,s,a,c,h)}roundClean(){Bt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Tt=mt((()=>new Ut)),kt=(BigInt(0),BigInt(1)),Ot=BigInt(2),Pt=t=>t instanceof Uint8Array,Lt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Nt(t){if(!Pt(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=Lt[t[r]];return e}function Ct(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function Ht(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(e/2);for(let e=0;e<r.length;e++){const n=2*e,o=t.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[e]=i}return r}function $t(t){return Ct(Nt(t))}function _t(t){if(!Pt(t))throw new Error("Uint8Array expected");return Ct(Nt(Uint8Array.from(t).reverse()))}function Rt(t,e){return Ht(t.toString(16).padStart(2*e,"0"))}function Dt(t,e){return Rt(t,e).reverse()}function Ft(t,e,r){let n;if("string"==typeof e)try{n=Ht(e)}catch(r){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${r}`)}else{if(!Pt(e))throw new Error(`${t} must be hex string or Uint8Array`);n=Uint8Array.from(e)}const o=n.length;if("number"==typeof r&&o!==r)throw new Error(`${t} expected ${r} bytes, got ${o}`);return n}function Kt(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let r=0;return t.forEach((t=>{if(!Pt(t))throw new Error("Uint8Array expected");e.set(t,r),r+=t.length})),e}const jt=t=>(Ot<<BigInt(t-1))-kt,Mt=t=>new Uint8Array(t),Wt=t=>Uint8Array.from(t);function zt(t,e,r){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let n=Mt(t),o=Mt(t),i=0;const s=()=>{n.fill(1),o.fill(0),i=0},a=(...t)=>r(o,n,...t),c=(t=Mt())=>{o=a(Wt([0]),t),n=a(),0!==t.length&&(o=a(Wt([1]),t),n=a())},h=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const r=[];for(;t<e;){n=a();const e=n.slice();r.push(e),t+=n.length}return Kt(...r)};return(t,e)=>{let r;for(s(),c(t);!(r=e(h()));)c();return s(),r}}const Vt={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Gt(t,e,r={}){const n=(e,r,n)=>{const o=Vt[r];if("function"!=typeof o)throw new Error(`Invalid validator "${r}", expected function`);const i=t[e];if(!(n&&void 0===i||o(i,t)))throw new Error(`Invalid param ${String(e)}=${i} (${typeof i}), expected ${r}`)};for(const[t,r]of Object.entries(e))n(t,r,!1);for(const[t,e]of Object.entries(r))n(t,e,!0);return t}const qt=BigInt(0),Yt=BigInt(1),Zt=BigInt(2),Qt=BigInt(3),Xt=BigInt(4),Jt=BigInt(5),te=BigInt(8);function ee(t,e){const r=t%e;return r>=qt?r:e+r}function re(t,e,r){if(r<=qt||e<qt)throw new Error("Expected power/modulo > 0");if(r===Yt)return qt;let n=Yt;for(;e>qt;)e&Yt&&(n=n*t%r),t=t*t%r,e>>=Yt;return n}function ne(t,e,r){let n=t;for(;e-- >qt;)n*=n,n%=r;return n}function oe(t,e){if(t===qt||e<=qt)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=ee(t,e),n=e,o=qt,i=Yt,s=Yt,a=qt;for(;r!==qt;){const t=n/r,e=n%r,c=o-s*t,h=i-a*t;n=r,r=e,o=s,i=a,s=c,a=h}if(n!==Yt)throw new Error("invert: does not exist");return ee(o,e)}BigInt(9),BigInt(16);const ie=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function se(t,e){const r=void 0!==e?e:t.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function ae(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ce(t){const e=ae(t);return e+Math.ceil(e/2)}class he extends Et{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ft(t.outputLen),ft(t.blockLen)}(t);const r=bt(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let t=0;t<o.length;t++)o[t]^=54;this.iHash.update(o),this.oHash=t.create();for(let t=0;t<o.length;t++)o[t]^=106;this.oHash.update(o),o.fill(0)}update(t){return dt(this),this.iHash.update(t),this}digestInto(t){dt(this),lt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return t.finished=n,t.destroyed=o,t.blockLen=i,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ue=(t,e,r)=>new he(t,e).update(r).digest();ue.create=(t,e)=>new he(t,e);const fe=BigInt(0),le=BigInt(1);function de(t){return Gt(t.Fp,ie.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Gt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...se(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{bytesToNumberBE:pe,hexToBytes:ye}=t,we={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=we;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const r=t[1],n=t.subarray(2,r+2);if(!r||n.length!==r)throw new e("Invalid signature integer: wrong length");if(128&n[0])throw new e("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:pe(n),l:t.subarray(r+2)}},toSig(t){const{Err:e}=we,r="string"==typeof t?ye(t):t;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||48!=r[0])throw new e("Invalid signature tag");if(r[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:o,l:i}=we._parseInt(r.subarray(2)),{d:s,l:a}=we._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,r=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},n=e(r(t.s)),o=e(r(t.r)),i=n.length/2,s=o.length/2,a=r(i),c=r(s);return`30${r(s+i+4)}02${c}${o}02${a}${n}`}},ge=BigInt(0),be=BigInt(1),Ee=(BigInt(2),BigInt(3));function me(t){const e=function(t){const e=de(t);return Gt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:r,n}=e,o=r.BYTES+1,i=2*r.BYTES+1;function s(t){return ee(t,n)}function a(t){return oe(t,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:u,isWithinCurveOrder:f}=function(t){const e=function(t){const e=de(t);Gt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:o}=e;if(r){if(!n.eql(o,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:r}=e,n=e.toBytes||((t,e,n)=>{const o=e.toAffine();return Kt(Uint8Array.from([4]),r.toBytes(o.x),r.toBytes(o.y))}),o=e.fromBytes||(t=>{const e=t.subarray(1);return{x:r.fromBytes(e.subarray(0,r.BYTES)),y:r.fromBytes(e.subarray(r.BYTES,2*r.BYTES))}});function i(t){const{a:n,b:o}=e,i=r.sqr(t),s=r.mul(i,t);return r.add(r.add(s,r.mul(t,n)),o)}if(!r.eql(r.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function s(t){return"bigint"==typeof t&&ge<t&&t<e.n}function a(t){if(!s(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:o,n:i}=e;if(r&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=Nt(t)),"string"!=typeof t||!r.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*n,"0")}let s;try{s="bigint"==typeof t?t:$t(Ft("private key",t,n))}catch(e){throw new Error(`private key must be ${n} bytes, hex or bigint, not ${typeof t}`)}return o&&(s=ee(s,i)),a(s),s}const h=new Map;function u(t){if(!(t instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(t,e,n){if(this.px=t,this.py=e,this.pz=n,null==t||!r.isValid(t))throw new Error("x required");if(null==e||!r.isValid(e))throw new Error("y required");if(null==n||!r.isValid(n))throw new Error("z required")}static fromAffine(t){const{x:e,y:n}=t||{};if(!t||!r.isValid(e)||!r.isValid(n))throw new Error("invalid affine point");if(t instanceof f)throw new Error("projective point not allowed");const o=t=>r.eql(t,r.ZERO);return o(e)&&o(n)?f.ZERO:new f(e,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(f.fromAffine)}static fromHex(t){const e=f.fromAffine(o(Ft("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return f.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,h.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:n}=this.toAffine();if(!r.isValid(t)||!r.isValid(n))throw new Error("bad point: x or y not FE");const o=r.sqr(n),s=i(t);if(!r.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(r.isOdd)return!r.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){u(t);const{px:e,py:n,pz:o}=this,{px:i,py:s,pz:a}=t,c=r.eql(r.mul(e,a),r.mul(i,o)),h=r.eql(r.mul(n,a),r.mul(s,o));return c&&h}negate(){return new f(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,o=r.mul(n,Ee),{px:i,py:s,pz:a}=this;let c=r.ZERO,h=r.ZERO,u=r.ZERO,l=r.mul(i,i),d=r.mul(s,s),p=r.mul(a,a),y=r.mul(i,s);return y=r.add(y,y),u=r.mul(i,a),u=r.add(u,u),c=r.mul(t,u),h=r.mul(o,p),h=r.add(c,h),c=r.sub(d,h),h=r.add(d,h),h=r.mul(c,h),c=r.mul(y,c),u=r.mul(o,u),p=r.mul(t,p),y=r.sub(l,p),y=r.mul(t,y),y=r.add(y,u),u=r.add(l,l),l=r.add(u,l),l=r.add(l,p),l=r.mul(l,y),h=r.add(h,l),p=r.mul(s,a),p=r.add(p,p),l=r.mul(p,y),c=r.sub(c,l),u=r.mul(p,d),u=r.add(u,u),u=r.add(u,u),new f(c,h,u)}add(t){u(t);const{px:n,py:o,pz:i}=this,{px:s,py:a,pz:c}=t;let h=r.ZERO,l=r.ZERO,d=r.ZERO;const p=e.a,y=r.mul(e.b,Ee);let w=r.mul(n,s),g=r.mul(o,a),b=r.mul(i,c),E=r.add(n,o),m=r.add(s,a);E=r.mul(E,m),m=r.add(w,g),E=r.sub(E,m),m=r.add(n,i);let x=r.add(s,c);return m=r.mul(m,x),x=r.add(w,b),m=r.sub(m,x),x=r.add(o,i),h=r.add(a,c),x=r.mul(x,h),h=r.add(g,b),x=r.sub(x,h),d=r.mul(p,m),h=r.mul(y,b),d=r.add(h,d),h=r.sub(g,d),d=r.add(g,d),l=r.mul(h,d),g=r.add(w,w),g=r.add(g,w),b=r.mul(p,b),m=r.mul(y,m),g=r.add(g,b),b=r.sub(w,b),b=r.mul(p,b),m=r.add(m,b),w=r.mul(g,m),l=r.add(l,w),w=r.mul(x,m),h=r.mul(E,h),h=r.sub(h,w),w=r.mul(E,g),d=r.mul(x,d),d=r.add(d,w),new f(h,l,d)}subtract(t){return this.add(t.negate())}is0(){return this.equals(f.ZERO)}wNAF(t){return d.wNAFCached(this,h,t,(t=>{const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(f.fromAffine)}))}multiplyUnsafe(t){const n=f.ZERO;if(t===ge)return n;if(a(t),t===be)return this;const{endo:o}=e;if(!o)return d.unsafeLadder(this,t);let{k1neg:i,k1:s,k2neg:c,k2:h}=o.splitScalar(t),u=n,l=n,p=this;for(;s>ge||h>ge;)s&be&&(u=u.add(p)),h&be&&(l=l.add(p)),p=p.double(),s>>=be,h>>=be;return i&&(u=u.negate()),c&&(l=l.negate()),l=new f(r.mul(l.px,o.beta),l.py,l.pz),u.add(l)}multiply(t){a(t);let n,o,i=t;const{endo:s}=e;if(s){const{k1neg:t,k1:e,k2neg:a,k2:c}=s.splitScalar(i);let{p:h,f:u}=this.wNAF(e),{p:l,f:p}=this.wNAF(c);h=d.constTimeNegate(t,h),l=d.constTimeNegate(a,l),l=new f(r.mul(l.px,s.beta),l.py,l.pz),n=h.add(l),o=u.add(p)}else{const{p:t,f:e}=this.wNAF(i);n=t,o=e}return f.normalizeZ([n,o])[0]}multiplyAndAddUnsafe(t,e,r){const n=f.BASE,o=(t,e)=>e!==ge&&e!==be&&t.equals(n)?t.multiply(e):t.multiplyUnsafe(e),i=o(this,e).add(o(t,r));return i.is0()?void 0:i}toAffine(t){const{px:e,py:n,pz:o}=this,i=this.is0();null==t&&(t=i?r.ONE:r.inv(o));const s=r.mul(e,t),a=r.mul(n,t),c=r.mul(o,t);if(i)return{x:r.ZERO,y:r.ZERO};if(!r.eql(c,r.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:t,isTorsionFree:r}=e;if(t===be)return!0;if(r)return r(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:r}=e;return t===be?this:r?r(f,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),n(f,this,t)}toHex(t=!0){return Nt(this.toRawBytes(t))}}f.BASE=new f(e.Gx,e.Gy,r.ONE),f.ZERO=new f(r.ZERO,r.ONE,r.ZERO);const l=e.nBitLength,d=function(t,e){const r=(t,e)=>{const r=e.negate();return t?r:e},n=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:r,unsafeLadder(e,r){let n=t.ZERO,o=e;for(;r>fe;)r&le&&(n=n.add(o)),o=o.double(),r>>=le;return n},precomputeWindow(t,e){const{windows:r,windowSize:o}=n(e),i=[];let s=t,a=s;for(let t=0;t<r;t++){a=s,i.push(a);for(let t=1;t<o;t++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(e,o,i){const{windows:s,windowSize:a}=n(e);let c=t.ZERO,h=t.BASE;const u=BigInt(2**e-1),f=2**e,l=BigInt(e);for(let t=0;t<s;t++){const e=t*a;let n=Number(i&u);i>>=l,n>a&&(n-=f,i+=le);const s=e,d=e+Math.abs(n)-1,p=t%2!=0,y=n<0;0===n?h=h.add(r(p,o[s])):c=c.add(r(y,o[d]))}return{p:c,f:h}},wNAFCached(t,e,r,n){const o=t._WINDOW_SIZE||1;let i=e.get(t);return i||(i=this.precomputeWindow(t,o),1!==o&&e.set(t,n(i))),this.wNAF(o,i,r)}}}(f,e.endo?Math.ceil(l/2):l);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:s}}({...e,toBytes(t,e,n){const o=e.toAffine(),i=r.toBytes(o.x),s=Kt;return n?s(Uint8Array.from([e.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,r.toBytes(o.y))},fromBytes(t){const e=t.length,n=t[0],s=t.subarray(1);if(e!==o||2!==n&&3!==n){if(e===i&&4===n)return{x:r.fromBytes(s.subarray(0,r.BYTES)),y:r.fromBytes(s.subarray(r.BYTES,2*r.BYTES))};throw new Error(`Point of length ${e} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const t=$t(s);if(!(ge<(a=t)&&a<r.ORDER))throw new Error("Point is not on curve");const e=u(t);let o=r.sqrt(e);return 1==(1&n)!=((o&be)===be)&&(o=r.neg(o)),{x:t,y:o}}var a}}),l=t=>Nt(Rt(t,e.nByteLength));function d(t){return t>n>>be}const p=(t,e,r)=>$t(t.slice(e,r));class y{constructor(t,e,r){this.r=t,this.s=e,this.recovery=r,this.assertValidity()}static fromCompact(t){const r=e.nByteLength;return t=Ft("compactSignature",t,2*r),new y(p(t,0,r),p(t,r,2*r))}static fromDER(t){const{r:e,s:r}=we.toSig(Ft("DER",t));return new y(e,r)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new y(this.r,this.s,t)}recoverPublicKey(t){const{r:n,s:o,recovery:i}=this,h=E(Ft("msgHash",t));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?n+e.n:n;if(u>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const f=0==(1&i)?"02":"03",d=c.fromHex(f+l(u)),p=a(u),y=s(-h*p),w=s(o*p),g=c.BASE.multiplyAndAddUnsafe(d,y,w);if(!g)throw new Error("point at infinify");return g.assertValidity(),g}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Ht(this.toDERHex())}toDERHex(){return we.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ht(this.toCompactHex())}toCompactHex(){return l(this.r)+l(this.s)}}const w={isValidPrivateKey(t){try{return h(t),!0}catch(t){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const t=ce(e.n);return function(t,e,r=!1){const n=t.length,o=ae(e),i=ce(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const s=ee(r?$t(t):_t(t),e-Yt)+Yt;return r?Dt(s,o):Rt(s,o)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function g(t){const e=t instanceof Uint8Array,r="string"==typeof t,n=(e||r)&&t.length;return e?n===o||n===i:r?n===2*o||n===2*i:t instanceof c}const b=e.bits2int||function(t){const r=$t(t),n=8*t.length-e.nBitLength;return n>0?r>>BigInt(n):r},E=e.bits2int_modN||function(t){return s(b(t))},m=jt(e.nBitLength);function x(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(ge<=t&&t<m))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Rt(t,e.nByteLength)}const A={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,r=!0){if(g(t))throw new Error("first arg must be private key");if(!g(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(h(t)).toRawBytes(r)},sign:function(t,n,o=A){const{seed:i,k2sig:u}=function(t,n,o=A){if(["recovered","canonical"].some((t=>t in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=e;let{lowS:l,prehash:p,extraEntropy:w}=o;null==l&&(l=!0),t=Ft("msgHash",t),p&&(t=Ft("prehashed msgHash",i(t)));const g=E(t),m=h(n),S=[x(m),x(g)];if(null!=w){const t=!0===w?u(r.BYTES):w;S.push(Ft("extraEntropy",t))}const v=Kt(...S),I=g;return{seed:v,k2sig:function(t){const e=b(t);if(!f(e))return;const r=a(e),n=c.BASE.multiply(e).toAffine(),o=s(n.x);if(o===ge)return;const i=s(r*s(I+o*m));if(i===ge)return;let h=(n.x===o?0:2)|Number(n.y&be),u=i;return l&&d(i)&&(u=function(t){return d(t)?s(-t):t}(i),h^=1),new y(o,u,h)}}}(t,n,o),l=e;return zt(l.hash.outputLen,l.nByteLength,l.hmac)(i,u)},verify:function(t,r,n,o=S){const i=t;if(r=Ft("msgHash",r),n=Ft("publicKey",n),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:u}=o;let f,l;try{if("string"==typeof i||i instanceof Uint8Array)try{f=y.fromDER(i)}catch(t){if(!(t instanceof we.Err))throw t;f=y.fromCompact(i)}else{if("object"!=typeof i||"bigint"!=typeof i.r||"bigint"!=typeof i.s)throw new Error("PARSE");{const{r:t,s:e}=i;f=new y(t,e)}}l=c.fromHex(n)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&f.hasHighS())return!1;u&&(r=e.hash(r));const{r:d,s:p}=f,w=E(r),g=a(p),b=s(w*g),m=s(d*g),x=c.BASE.multiplyAndAddUnsafe(l,b,m)?.toAffine();return!!x&&s(x.x)===d},ProjectivePoint:c,Signature:y,utils:w}}function xe(t){return{hash:t,hmac:(e,...r)=>ue(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let r=0;return t.forEach((t=>{if(!yt(t))throw new Error("Uint8Array expected");e.set(t,r),r+=t.length})),e}(...r)),randomBytes:xt}}BigInt(4);const Ae=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Se=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ve=BigInt(1),Ie=BigInt(2),Be=(t,e)=>(t+e/Ie)/e;function Ue(t){const e=Ae,r=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),h=t*t*t%e,u=h*h*t%e,f=ne(u,r,e)*u%e,l=ne(f,r,e)*u%e,d=ne(l,Ie,e)*h%e,p=ne(d,o,e)*d%e,y=ne(p,i,e)*p%e,w=ne(y,a,e)*y%e,g=ne(w,c,e)*w%e,b=ne(g,a,e)*y%e,E=ne(b,r,e)*u%e,m=ne(E,s,e)*p%e,x=ne(m,n,e)*h%e,A=ne(x,Ie,e);if(!Te.eql(Te.sqr(A),t))throw new Error("Cannot find square root");return A}const Te=function(t,e,r=!1,n={}){if(t<=qt)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:i}=se(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=function(t){if(t%Xt===Qt){const e=(t+Yt)/Xt;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}if(t%te===Jt){const e=(t-Jt)/te;return function(t,r){const n=t.mul(r,Zt),o=t.pow(n,e),i=t.mul(r,o),s=t.mul(t.mul(i,Zt),o),a=t.mul(i,t.sub(s,t.ONE));if(!t.eql(t.sqr(a),r))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-Yt)/Zt;let r,n,o;for(r=t-Yt,n=0;r%Zt===qt;r/=Zt,n++);for(o=Zt;o<t&&re(o,e,t)!==t-Yt;o++);if(1===n){const e=(t+Yt)/Xt;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}const i=(r+Yt)/Zt;return function(t,s){if(t.pow(s,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=n,c=t.pow(t.mul(t.ONE,o),r),h=t.pow(s,i),u=t.pow(s,r);for(;!t.eql(u,t.ONE);){if(t.eql(u,t.ZERO))return t.ZERO;let e=1;for(let r=t.sqr(u);e<a&&!t.eql(r,t.ONE);e++)r=t.sqr(r);const r=t.pow(c,Yt<<BigInt(a-e-1));c=t.sqr(r),h=t.mul(h,r),u=t.mul(u,c),a=e}return h}}(t)}(t),a=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:jt(o),ZERO:qt,ONE:Yt,create:e=>ee(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return qt<=e&&e<t},is0:t=>t===qt,isOdd:t=>(t&Yt)===Yt,neg:e=>ee(-e,t),eql:(t,e)=>t===e,sqr:e=>ee(e*e,t),add:(e,r)=>ee(e+r,t),sub:(e,r)=>ee(e-r,t),mul:(e,r)=>ee(e*r,t),pow:(t,e)=>function(t,e,r){if(r<qt)throw new Error("Expected power > 0");if(r===qt)return t.ONE;if(r===Yt)return e;let n=t.ONE,o=e;for(;r>qt;)r&Yt&&(n=t.mul(n,o)),o=t.sqr(o),r>>=Yt;return n}(a,t,e),div:(e,r)=>ee(e*oe(r,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>oe(e,t),sqrt:n.sqrt||(t=>s(a,t)),invertBatch:t=>function(t,e){const r=new Array(e.length),n=e.reduce(((e,n,o)=>t.is0(n)?e:(r[o]=e,t.mul(e,n))),t.ONE),o=t.inv(n);return e.reduceRight(((e,n,o)=>t.is0(n)?e:(r[o]=t.mul(e,r[o]),t.mul(e,n))),o),r}(a,t),cmov:(t,e,r)=>r?e:t,toBytes:t=>r?Dt(t,i):Rt(t,i),fromBytes:t=>{if(t.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${t.length}`);return r?_t(t):$t(t)}});return Object.freeze(a)}(Ae,void 0,void 0,{sqrt:Ue}),ke=function(t,e){const r=e=>me({...t,...xe(e)});return Object.freeze({...r(e),create:r})}({a:BigInt(0),b:BigInt(7),Fp:Te,n:Se,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Se,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-ve*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,s=BigInt("0x100000000000000000000000000000000"),a=Be(i*t,e),c=Be(-n*t,e);let h=ee(t-a*r-c*o,e),u=ee(-a*n-c*i,e);const f=h>s,l=u>s;if(f&&(h=e-h),l&&(u=e-u),h>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:h,k2neg:l,k2:u}}}},Tt),Oe=BigInt(0),Pe=t=>"bigint"==typeof t&&Oe<t&&t<Ae,Le=t=>"bigint"==typeof t&&Oe<t&&t<Se,Ne={};function Ce(t,...e){let r=Ne[t];if(void 0===r){const e=Tt(Uint8Array.from(t,(t=>t.charCodeAt(0))));r=Kt(e,e),Ne[t]=r}return Tt(Kt(r,...e))}const He=t=>t.toRawBytes(!0).slice(1),$e=t=>Rt(t,32),_e=t=>ee(t,Ae),Re=t=>ee(t,Se),De=ke.ProjectivePoint,Fe=(t,e,r)=>De.BASE.multiplyAndAddUnsafe(t,e,r);function Ke(t){let e=ke.utils.normPrivateKeyToScalar(t),r=De.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:Re(-e),bytes:He(r)}}function je(t){if(!Pe(t))throw new Error("bad x: need 0 < x < p");const e=_e(t*t);let r=Ue(_e(e*t+BigInt(7)));r%Ie!==Oe&&(r=_e(-r));const n=new De(t,r,ve);return n.assertValidity(),n}function Me(...t){return Re($t(Ce("BIP0340/challenge",...t)))}function We(t){return Ke(t).bytes}function ze(t,e,r=xt(32)){const n=Ft("message",t),{bytes:o,scalar:i}=Ke(e),s=Ft("auxRand",r,32),a=$e(i^$t(Ce("BIP0340/aux",s))),c=Ce("BIP0340/nonce",a,o,n),h=Re($t(c));if(h===Oe)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Ke(h),l=Me(u,o,n),d=new Uint8Array(64);if(d.set(u,0),d.set($e(Re(f+l*i)),32),!Ve(d,n,o))throw new Error("sign: Invalid signature produced");return d}function Ve(t,e,r){const n=Ft("signature",t,64),o=Ft("message",e),i=Ft("publicKey",r,32);try{const t=je($t(i)),e=$t(n.subarray(0,32));if(!Pe(e))return!1;const r=$t(n.subarray(32,64));if(!Le(r))return!1;const s=Me($e(e),He(t),o),a=Fe(t,r,Re(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==e)}catch(t){return!1}}const Ge=(()=>({getPublicKey:We,sign:ze,verify:Ve,utils:{randomPrivateKey:ke.utils.randomPrivateKey,lift_x:je,pointToBytes:He,numberToBytesBE:Rt,bytesToNumberBE:$t,taggedHash:Ce,mod:ee}}))();function qe(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Ye(...t){const e=(t,e)=>r=>t(e(r));return{encode:Array.from(t).reverse().reduce(((t,r)=>t?e(t,r.encode):r.encode),void 0),decode:t.reduce(((t,r)=>t?e(t,r.decode):r.decode),void 0)}}function Ze(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(qe(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const r=t.indexOf(e);if(-1===r)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return r}))}}}function Qe(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function Xe(t,e="="){if(qe(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;r.length*t%8;)r.push(e);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let n=r.length;if(n*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if(!((n-1)*t%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function Je(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function tr(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let n=0;const o=[],i=Array.from(t);for(i.forEach((t=>{if(qe(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,s=!0;for(let o=n;o<i.length;o++){const a=i[o],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");t=c%r;const h=Math.floor(c/r);if(i[o]=h,!Number.isSafeInteger(h)||h*r+t!==c)throw new Error("convertRadix: carry overflow");s&&(h?s=!1:n=o)}if(o.push(t),s)break}for(let e=0;e<t.length-1&&0===t[e];e++)o.push(0);return o.reverse()}const er=(t,e)=>e?er(e,t%e):t,rr=(t,e)=>t+(e-er(t,e));function nr(t,e,r,n){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(rr(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${rr(e,r)}`);let o=0,i=0;const s=2**r-1,a=[];for(const n of t){if(qe(n),n>=2**e)throw new Error(`convertRadix2: invalid data word=${n} from=${e}`);if(o=o<<e|n,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=r;i-=r)a.push((o>>i-r&s)>>>0);o&=2**i-1}if(o=o<<r-i&s,!n&&i>=e)throw new Error("Excess padding");if(!n&&o)throw new Error(`Non-zero padding: ${o}`);return n&&i>0&&a.push(o>>>0),a}function or(t,e=!1){if(qe(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(rr(8,t)>32||rr(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return nr(Array.from(r),8,t,!e)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(nr(r,t,8,e))}}}function ir(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}or(4),Ze("0123456789ABCDEF"),Qe(""),or(5),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xe(5),Qe(""),or(5),Ze("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Xe(5),Qe(""),or(5),Ze("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Qe(""),Je((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),or(6),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Xe(6),Qe(""),or(6),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Xe(6),Qe(""),or(6),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Qe("");const sr=t=>{return Ye((qe(e=58),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return tr(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(tr(t,e,256))}}),Ze(t),Qe(""));var e},ar=sr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),cr=t=>Ye(function(t,e){if(qe(t),"function"!=typeof e)throw new Error("checksum fn should be function");return{encode(r){if(!(r instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const n=e(r).slice(0,t),o=new Uint8Array(r.length+t);return o.set(r),o.set(n,r.length),o},decode(r){if(!(r instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const n=r.slice(0,-t),o=e(n).slice(0,t),i=r.slice(-t);for(let e=0;e<t;e++)if(o[e]!==i[e])throw new Error("Invalid checksum");return n}}}(4,(e=>t(t(e)))),ar),hr=Ye(Ze("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Qe("")),ur=[996825010,642813549,513874426,1027748829,705979059];function fr(t){const e=t>>25;let r=(33554431&t)<<5;for(let t=0;t<ur.length;t++)1==(e>>t&1)&&(r^=ur[t]);return r}function lr(t,e,r=1){const n=t.length;let o=1;for(let e=0;e<n;e++){const r=t.charCodeAt(e);if(r<33||r>126)throw new Error(`Invalid prefix (${t})`);o=fr(o)^r>>5}o=fr(o);for(let e=0;e<n;e++)o=fr(o)^31&t.charCodeAt(e);for(let t of e)o=fr(o)^t;for(let t=0;t<6;t++)o=fr(o);return o^=r,hr.encode(nr([o%2**30],30,5,!1))}function dr(t){const e="bech32"===t?1:734539939,r=or(5),n=r.decode,o=r.encode,i=ir(n);function s(t,r=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==r&&t.length>r)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${r})`);const n=t.toLowerCase();if(t!==n&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(t=n).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=t.slice(0,o),s=t.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=hr.decode(s).slice(0,-6),c=lr(i,a,e);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(t,r,n=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof r);const o=t.length+7+r.length;if(!1!==n&&o>n)throw new TypeError(`Length ${o} exceeds limit ${n}`);const i=t.toLowerCase(),s=lr(i,r,e);return`${i}1${hr.encode(r)}${s}`},decode:s,decodeToBytes:function(t){const{prefix:e,words:r}=s(t,!1);return{prefix:e,words:r,bytes:n(r)}},decodeUnsafe:ir(s),fromWords:n,fromWordsUnsafe:i,toWords:o}}const pr=dr("bech32"),yr=dr("bech32m"),wr=t=>(new TextDecoder).decode(t),gr=t=>(new TextEncoder).encode(t),br=Ye(or(4),Ze("0123456789abcdef"),Qe(""),Je((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}))),Er=ke.ProjectivePoint,mr=cr(K);function xr(t){return BigInt(`0x${function(t){if(!a(t))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=u[t[r]];return e}(t)}`)}const Ar=d("Bitcoin seed"),Sr={private:76066276,public:76067358},vr=2147483648,Ir=t=>{if(!Number.isSafeInteger(t)||t<0||t>2**32-1)throw new Error(`Invalid number=${t}. Should be from 0 to 2 ** 32 - 1`);const e=new Uint8Array(4);return c(e).setUint32(0,t,!1),e};class Br{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return t=this.pubHash,c(t).getUint32(0,!1);var t}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const t=this.privateKey;if(!t)throw new Error("No private key");return mr.encode(this.serialize(this.versions.private,y(new Uint8Array([0]),t)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return mr.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(t,e=Sr){if(r(t),8*t.length<128||8*t.length>512)throw new Error(`HDKey: wrong seed length=${t.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const n=m(ut,Ar,t);return new Br({versions:e,chainCode:n.slice(32),privateKey:n.slice(0,32)})}static fromExtendedKey(t,e=Sr){const r=mr.decode(t),n=c(r),o=n.getUint32(0,!1),i={versions:e,depth:r[4],parentFingerprint:n.getUint32(5,!1),index:n.getUint32(9,!1),chainCode:r.slice(13,45)},s=r.slice(45),a=0===s[0];if(o!==e[a?"private":"public"])throw new Error("Version mismatch");return new Br(a?{...i,privateKey:s.slice(1)}:{...i,publicKey:s})}static fromJSON(t){return Br.fromExtendedKey(t.xpriv)}constructor(t){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!t||"object"!=typeof t)throw new Error("HDKey.constructor must not be called directly");if(this.versions=t.versions||Sr,this.depth=t.depth||0,this.chainCode=t.chainCode,this.index=t.index||0,this.parentFingerprint=t.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(t.publicKey&&t.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(t.privateKey){if(!ke.utils.isValidPrivateKey(t.privateKey))throw new Error("Invalid private key");this.privKey="bigint"==typeof t.privateKey?t.privateKey:xr(t.privateKey),this.privKeyBytes=function(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(e/2);for(let e=0;e<r.length;e++){const n=2*e,o=t.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[e]=i}return r}(this.privKey.toString(16).padStart(64,"0")),this.pubKey=ke.getPublicKey(t.privateKey,!0)}else{if(!t.publicKey)throw new Error("HDKey: no public or private key provided");this.pubKey=Er.fromHex(t.publicKey).toRawBytes(!0)}var e;this.pubHash=(e=this.pubKey,H(K(e)))}derive(t){if(!/^[mM]'?/.test(t))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(t))return this;const e=t.replace(/^[mM]'?\//,"").split("/");let r=this;for(const t of e){const e=/^(\d+)('?)$/.exec(t),n=e&&e[1];if(!e||3!==e.length||"string"!=typeof n)throw new Error(`Invalid child index: ${t}`);let o=+n;if(!Number.isSafeInteger(o)||o>=vr)throw new Error("Invalid index");"'"===e[2]&&(o+=vr),r=r.deriveChild(o)}return r}deriveChild(t){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let e=Ir(t);if(t>=vr){const t=this.privateKey;if(!t)throw new Error("Could not derive hardened child key");e=y(new Uint8Array([0]),t,e)}else e=y(this.pubKey,e);const r=m(ut,this.chainCode,e),n=xr(r.slice(0,32)),o=r.slice(32);if(!ke.utils.isValidPrivateKey(n))throw new Error("Tweak bigger than curve order");const i={versions:this.versions,chainCode:o,depth:this.depth+1,parentFingerprint:this.fingerprint,index:t};try{if(this.privateKey){const t=ee(this.privKey+n,ke.CURVE.n);if(!ke.utils.isValidPrivateKey(t))throw new Error("The tweak was out of range or the resulted private key is invalid");i.privateKey=t}else{const t=Er.fromHex(this.pubKey).add(Er.fromPrivateKey(n));if(t.equals(Er.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");i.publicKey=t.toRawBytes(!0)}return new Br(i)}catch(e){return this.deriveChild(t+1)}}sign(t){if(!this.privateKey)throw new Error("No privateKey set!");return r(t,32),ke.sign(t,this.privKey).toCompactRawBytes()}verify(t,e){if(r(t,32),r(e,64),!this.publicKey)throw new Error("No publicKey set!");let n;try{n=ke.Signature.fromCompact(e)}catch(t){return!1}return ke.verify(n,t,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(t,e){if(!this.chainCode)throw new Error("No chainCode set");return r(e,33),y(Ir(t),new Uint8Array([this.depth]),Ir(this.parentFingerprint),Ir(this.index),this.chainCode,e)}}function Ur(t){if("string"!=typeof t)throw new TypeError("Invalid mnemonic type: "+typeof t);return t.normalize("NFKD")}const Tr=t=>Ur(`mnemonic${t}`);function kr(t,r=""){return async function(t,r,o,i){const{c:s,dkLen:a,asyncTick:h,DK:u,PRF:f,PRFSalt:d}=function(t,r,o,i){n(t);const s=function(t,e){if(void 0!==e&&"[object Object]"!==g.call(e))throw new Error("Options should be object or undefined");return Object.assign({dkLen:32,asyncTick:10},e)}(0,i),{c:a,dkLen:c,asyncTick:h}=s;if(e(a),e(c),e(h),a<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const u=p(r),f=p(o),l=new Uint8Array(c),d=m.create(t,u),y=d._cloneInto().update(f);return{c:a,dkLen:c,asyncTick:h,DK:l,PRF:d,PRFSalt:y}}(t,r,o,{c:2048,dkLen:64});let y;const w=new Uint8Array(4),b=c(w),E=new Uint8Array(f.outputLen);for(let t=1,e=0;e<a;t++,e+=f.outputLen){const r=u.subarray(e,e+f.outputLen);b.setInt32(0,t,!1),(y=d._cloneInto(y)).update(w).digestInto(E),r.set(E.subarray(0,r.length)),await l(s-1,h,(()=>{f._cloneInto(y).update(E).digestInto(E);for(let t=0;t<r.length;t++)r[t]^=E[t]}))}return function(t,e,r,n,o){return t.destroy(),e.destroy(),n&&n.destroy(),o.fill(0),r}(f,d,u,y,E)}(ut,function(t){const e=Ur(t),r=e.split(" ");if(![12,15,18,21,24].includes(r.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:r}}(t).nfkd,Tr(r))}function Or(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Pr(t,e){!function(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Lr=t=>t instanceof Uint8Array,Nr=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Cr=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function Hr(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!Lr(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class $r{clone(){return this._cloneInto()}}function _r(t){const e=e=>t().update(Hr(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}class Rr extends $r{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Nr(this.buffer)}update(t){Or(this);const{view:e,buffer:r,blockLen:n}=this,o=(t=Hr(t)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=Nr(t);for(;n<=o-i;i+=n)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Or(this),Pr(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let t=i;t<n;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,h=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+h,a,n)}(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=Nr(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)s.setUint32(4*t,h[t],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return t.length=n,t.pos=s,t.finished=o,t.destroyed=i,n%e&&t.buffer.set(r),t}}const Dr=(t,e,r)=>t&e^t&r^e&r,Fr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),jr=new Uint32Array(64);class Mr extends Rr{constructor(){super(64,32,8,!1),this.A=0|Kr[0],this.B=0|Kr[1],this.C=0|Kr[2],this.D=0|Kr[3],this.E=0|Kr[4],this.F=0|Kr[5],this.G=0|Kr[6],this.H=0|Kr[7]}get(){const{A:t,B:e,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[t,e,r,n,o,i,s,a]}set(t,e,r,n,o,i,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)jr[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=jr[t-15],r=jr[t-2],n=Cr(e,7)^Cr(e,18)^e>>>3,o=Cr(r,17)^Cr(r,19)^r>>>10;jr[t]=o+jr[t-7]+n+jr[t-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(Cr(s,6)^Cr(s,11)^Cr(s,25))+((u=s)&a^~u&c)+Fr[t]+jr[t]|0,f=(Cr(r,2)^Cr(r,13)^Cr(r,22))+Dr(r,n,o)|0;h=c,c=a,a=s,s=i+e|0,i=o,o=n,n=r,r=e+f|0}var u;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,n,o,i,s,a,c,h)}roundClean(){jr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Wr=_r((()=>new Mr)),zr=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Vr=Uint8Array.from({length:16},((t,e)=>e));let Gr=[Vr],qr=[Vr.map((t=>(9*t+5)%16))];for(let t=0;t<4;t++)for(let e of[Gr,qr])e.push(e[t].map((t=>zr[t])));const Yr=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((t=>new Uint8Array(t))),Zr=Gr.map(((t,e)=>t.map((t=>Yr[e][t])))),Qr=qr.map(((t,e)=>t.map((t=>Yr[e][t])))),Xr=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Jr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),tn=(t,e)=>t<<e|t>>>32-e;function en(t,e,r,n){return 0===t?e^r^n:1===t?e&r|~e&n:2===t?(e|~r)^n:3===t?e&n|r&~n:e^(r|~n)}const rn=new Uint32Array(16);class nn extends Rr{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:e,h2:r,h3:n,h4:o}=this;return[t,e,r,n,o]}set(t,e,r,n,o){this.h0=0|t,this.h1=0|e,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(t,e){for(let r=0;r<16;r++,e+=4)rn[r]=t.getUint32(e,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,a=s,c=0|this.h3,h=c,u=0|this.h4,f=u;for(let t=0;t<5;t++){const e=4-t,l=Xr[t],d=Jr[t],p=Gr[t],y=qr[t],w=Zr[t],g=Qr[t];for(let e=0;e<16;e++){const n=tn(r+en(t,o,s,c)+rn[p[e]]+l,w[e])+u|0;r=u,u=c,c=0|tn(s,10),s=o,o=n}for(let t=0;t<16;t++){const r=tn(n+en(e,i,a,h)+rn[y[t]]+d,g[t])+f|0;n=f,f=h,h=0|tn(a,10),a=i,i=r}}this.set(this.h1+s+h|0,this.h2+c+f|0,this.h3+u+n|0,this.h4+r+i|0,this.h0+o+a|0)}roundClean(){rn.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const on=_r((()=>new nn)),sn=new Uint8Array,an=new Uint8Array([0]);function cn(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function hn(...t){if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const o=t[e];r.set(o,n),n+=o.length}return r}const un=t=>t instanceof Uint8Array;class fn{constructor(t,e=[],r=[]){this.data=t,this.path=e,this.fieldPath=r,this.pos=0,this.hasPtr=!1,this.bitBuf=0,this.bitPos=0}err(t){return new Error(`Reader(${this.fieldPath.join("/")}): ${t}`)}absBytes(t){if(t>this.data.length)throw new Error("absBytes: Unexpected end of buffer");return this.data.subarray(t)}bytes(t,e=!1){if(this.bitPos)throw this.err("readBytes: bitPos not empty");if(!Number.isFinite(t))throw this.err(`readBytes: wrong length=${t}`);if(this.pos+t>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const r=this.data.subarray(this.pos,this.pos+t);return e||(this.pos+=t),r}byte(t=!1){if(this.bitPos)throw this.err("readByte: bitPos not empty");return this.data[t?this.pos:this.pos++]}get leftBytes(){return this.data.length-this.pos}isEnd(){return this.pos>=this.data.length&&!this.bitPos}length(t){let e;if(gn(t)?e=Number(t.decodeStream(this)):"number"==typeof t?e=t:"string"==typeof t&&(e=wn(this.path,t.split("/"))),"bigint"==typeof e&&(e=Number(e)),"number"!=typeof e)throw this.err(`Wrong length: ${e}`);return e}bits(t){if(t>32)throw this.err("BitReader: cannot read more than 32 bits in single call");let e=0;for(;t;){this.bitPos||(this.bitBuf=this.data[this.pos++],this.bitPos=8);const r=Math.min(t,this.bitPos);this.bitPos-=r,e=e<<r|this.bitBuf>>this.bitPos&2**r-1,this.bitBuf&=2**this.bitPos-1,t-=r}return e>>>0}find(t,e=this.pos){if(!un(t))throw this.err(`find: needle is not bytes! ${t}`);if(this.bitPos)throw this.err("findByte: bitPos not empty");if(!t.length)throw this.err("find: needle is empty");for(let r=e;-1!==(r=this.data.indexOf(t[0],r));r++){if(-1===r)return;if(this.data.length-r<t.length)return;if(cn(t,this.data.subarray(r,r+t.length)))return r}}finish(){if(!this.isEnd()&&!this.hasPtr)throw this.err(`${this.leftBytes} bytes ${this.bitPos} bits left after unpack: ${br.encode(this.data.slice(this.pos))}`)}fieldPathPush(t){this.fieldPath.push(t)}fieldPathPop(){this.fieldPath.pop()}}class ln{constructor(t=[],e=[]){this.path=t,this.fieldPath=e,this.buffers=[],this.pos=0,this.ptrs=[],this.bitBuf=0,this.bitPos=0}err(t){return new Error(`Writer(${this.fieldPath.join("/")}): ${t}`)}bytes(t){if(this.bitPos)throw this.err("writeBytes: ends with non-empty bit buffer");this.buffers.push(t),this.pos+=t.length}byte(t){if(this.bitPos)throw this.err("writeByte: ends with non-empty bit buffer");this.buffers.push(new Uint8Array([t])),this.pos++}get buffer(){if(this.bitPos)throw this.err("buffer: ends with non-empty bit buffer");let t=hn(...this.buffers);for(let e of this.ptrs){const r=t.length;t=hn(t,e.buffer);const n=e.ptr.encode(r);for(let r=0;r<n.length;r++)t[e.pos+r]=n[r]}return t}length(t,e){if(null===t)return;if(gn(t))return t.encodeStream(this,e);let r;if("number"==typeof t?r=t:"string"==typeof t&&(r=wn(this.path,t.split("/"))),"bigint"==typeof r&&(r=Number(r)),void 0===r||r!==e)throw this.err(`Wrong length: ${r} len=${t} exp=${e}`)}bits(t,e){if(e>32)throw this.err("writeBits: cannot write more than 32 bits in single call");if(t>=2**e)throw this.err(`writeBits: value (${t}) >= 2**bits (${e})`);for(;e;){const r=Math.min(e,8-this.bitPos);this.bitBuf=this.bitBuf<<r|t>>e-r,this.bitPos+=r,t&=2**(e-=r)-1,8===this.bitPos&&(this.bitPos=0,this.buffers.push(new Uint8Array([this.bitBuf])),this.pos++)}}fieldPathPush(t){this.fieldPath.push(t)}fieldPathPop(){this.fieldPath.pop()}}const dn=t=>Uint8Array.from(t).reverse();function pn(t,e,r,n){if(n){const n=2n**(r-1n);if(e<-n||e>=n)throw t.err("sInt: value out of bounds")}else if(0n>e||e>=2n**r)throw t.err("uInt: value out of bounds")}function yn(t){return{...t,encode:e=>{const r=new ln;return t.encodeStream(r,e),r.buffer},decode:e=>{const r=new fn(e),n=t.decodeStream(r);return r.finish(),n}}}function wn(t,e){t=Array.from(t);let r=0;for(;r<e.length&&".."===e[r];r++)t.pop();let n=t.pop();for(;r<e.length;r++){if(!n||void 0===n[e[r]])return;n=n[e[r]]}return n}function gn(t){return"function"==typeof t.encode&&"function"==typeof t.encodeStream&&"function"==typeof t.decode&&"function"==typeof t.decodeStream}const bn={dict:function(){return{encode:t=>{const e={};for(const[r,n]of t){if(void 0!==e[r])throw new Error(`coders.dict: same key(${r}) appears twice in struct`);e[r]=n}return e},decode:t=>Object.entries(t)}},number:{encode:t=>{if(t>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`coders.number: element bigger than MAX_SAFE_INTEGER=${t}`);return Number(t)},decode:t=>BigInt(t)},tsEnum:function(t){return{encode:e=>t[e],decode:e=>t[e]}},decimal:function(t){const e=10n**BigInt(t);return{encode:e=>{let r=(e<0n?-e:e).toString(10),n=r.length-t;n<0&&(r=r.padStart(r.length-n,"0"),n=0);let o=r.length-1;for(;o>=n&&"0"===r[o];o--);let[i,s]=[r.slice(0,n),r.slice(n,o+1)];return i||(i="0"),e<0n&&(i="-"+i),s?`${i}.${s}`:i},decode:r=>{let n=!1;r.startsWith("-")&&(n=!0,r=r.slice(1));let o=r.indexOf(".");o=-1===o?r.length:o;const[i,s]=[r.slice(0,o),r.slice(o+1)],a=BigInt(i)*e,c=Math.min(s.length,t),h=a+BigInt(s.slice(0,c))*10n**BigInt(t-c);return n?-h:h}}},match:function(t){return{encode:e=>{for(const r of t){const t=r.encode(e);if(void 0!==t)return t}throw new Error(`match/encode: cannot find match in ${e}`)},decode:e=>{for(const r of t){const t=r.decode(e);if(void 0!==t)return t}throw new Error(`match/decode: cannot find match in ${e}`)}}}},En=(t,e=!1,r=!1)=>yn({size:t,encodeStream:(n,o)=>{if("number"!=typeof o&&"bigint"!=typeof o)throw n.err(`bigint: invalid value: ${o}`);let i=BigInt(o);const s=BigInt(t);pn(n,i,8n*s,!!r),r&&i<0&&(i|=2n**(8n*s-1n));let a=[];for(let e=0;e<t;e++)a.push(Number(255n&i)),i>>=8n;let c=new Uint8Array(a).reverse();n.bytes(e?c.reverse():c)},decodeStream:n=>{const o=BigInt(t);let i=n.bytes(t);e&&(i=dn(i));const s=dn(i),a=2n**(8n*o-1n);let c=0n;for(let t=0;t<s.length;t++)c|=BigInt(s[t])<<8n*BigInt(t);return r&&c&a&&(c=(c^a)-a),pn(n,c,8n*o,!!r),c}}),mn=(En(32,!0),En(32,!1)),xn=(En(32,!0,!0),En(32,!1,!0),En(16,!0),En(16,!1),En(16,!0,!0),En(16,!1,!0),En(8,!0)),An=En(8,!1),Sn=En(8,!0,!0),vn=(En(8,!1,!0),(t,e=!1,r=!1)=>{if(t>6)throw new Error("int supports size up to 6 bytes (48 bits), for other use bigint");return Ln(En(t,e,r),bn.number)}),In=vn(4,!0),Bn=vn(4,!1),Un=vn(4,!0,!0),Tn=(vn(4,!1,!0),vn(2,!0)),kn=(vn(2,!1),vn(2,!0,!0),vn(2,!1,!0),vn(1,!1)),On=(vn(1,!1,!0),yn({size:1,encodeStream:(t,e)=>t.byte(e?1:0),decodeStream:t=>{const e=t.byte();if(0!==e&&1!==e)throw t.err(`bool: invalid value ${e}`);return 1===e}}),(t,e=!1)=>yn({size:"number"==typeof t?t:void 0,encodeStream:(r,n)=>{if(!un(n))throw r.err(`bytes: invalid value ${n}`);un(t)||r.length(t,n.length),r.bytes(e?dn(n):n),un(t)&&r.bytes(t)},decodeStream:r=>{let n;if(un(t)){const e=r.find(t);if(!e)throw r.err("bytes: cannot find terminator");n=r.bytes(e-r.pos),r.bytes(t.length)}else n=r.bytes(null===t?r.leftBytes:r.length(t));return e?dn(n):n}})),Pn=(t,e=!1)=>{const r=On(t,e);return yn({size:r.size,encodeStream:(t,e)=>r.encodeStream(t,gr(e)),decodeStream:t=>wr(r.decodeStream(t))})};function Ln(t,e){if(!gn(t))throw new Error(`apply: invalid inner value ${t}`);return yn({size:t.size,encodeStream:(r,n)=>{let o;try{o=e.decode(n)}catch(t){throw r.err(""+t)}return t.encodeStream(r,o)},decodeStream:r=>{const n=t.decodeStream(r);try{return e.encode(n)}catch(t){throw r.err(""+t)}}})}function Nn(t,e){if(!gn(t))throw new Error(`validate: invalid inner value ${t}`);return yn({size:t.size,encodeStream:(r,n)=>t.encodeStream(r,e(n)),decodeStream:r=>e(t.decodeStream(r))})}function Cn(t,e,r=!0){if(!gn(t))throw new Error(`flagged: invalid inner value ${t}`);return yn({size:t.size,encodeStream:(r,n)=>t.encodeStream(r,e),decodeStream:n=>{const o=t.decodeStream(n);if(r&&"object"!=typeof o&&o!==e||un(e)&&!cn(e,o))throw n.err(`magic: invalid value: ${o} !== ${e}`)}})}function Hn(t){let e=0;for(let r of t){if(!r.size)return;e+=r.size}return e}function $n(t){if(Array.isArray(t))throw new Error("Packed.Struct: got array instead of object");return yn({size:Hn(Object.values(t)),encodeStream:(e,r)=>{if("object"!=typeof r||null===r)throw e.err(`struct: invalid value ${r}`);e.path.push(r);for(let n in t)e.fieldPathPush(n),t[n].encodeStream(e,r[n]),e.fieldPathPop();e.path.pop()},decodeStream:e=>{let r={};e.path.push(r);for(let n in t)e.fieldPathPush(n),r[n]=t[n].decodeStream(e),e.fieldPathPop();return e.path.pop(),r}})}function _n(t,e){if(!gn(e))throw new Error(`array: invalid inner value ${e}`);return yn({size:"number"==typeof t&&e.size?t*e.size:void 0,encodeStream:(r,n)=>{if(!Array.isArray(n))throw r.err(`array: invalid value ${n}`);un(t)||r.length(t,n.length),r.path.push(n);for(let o=0;o<n.length;o++){r.fieldPathPush(""+o);const i=n[o],s=r.pos;if(e.encodeStream(r,i),un(t)){if(t.length>r.pos-s)continue;const e=r.buffer.subarray(s,r.pos);if(cn(e.subarray(0,t.length),t))throw r.err(`array: inner element encoding same as separator. elm=${i} data=${e}`)}r.fieldPathPop()}r.path.pop(),un(t)&&r.bytes(t)},decodeStream:r=>{let n=[];if(null===t){let t=0;for(r.path.push(n);!(r.isEnd()||(r.fieldPathPush(""+t++),n.push(e.decodeStream(r)),r.fieldPathPop(),e.size&&r.leftBytes<e.size)););r.path.pop()}else if(un(t)){let o=0;for(r.path.push(n);;){if(cn(r.bytes(t.length,!0),t)){r.bytes(t.length);break}r.fieldPathPush(""+o++),n.push(e.decodeStream(r)),r.fieldPathPop()}r.path.pop()}else{r.fieldPathPush("arrayLen");const o=r.length(t);r.fieldPathPop(),r.path.push(n);for(let t=0;t<o;t++)r.fieldPathPush(""+t),n.push(e.decodeStream(r)),r.fieldPathPop();r.path.pop()}return n}})}Pn(an),Cn(On(0),sn);const{ProjectivePoint:Rn,sign:Dn,getPublicKey:Fn}=ke,Kn=ke.CURVE.n,jn=(t,e)=>void 0===t?e:t,Mn=un,Wn=t=>on(Wr(t)),zn=(...t)=>Wr(Wr(Vn(...t))),Vn=hn,Gn=cr(Wr);function qn(t){if(Array.isArray(t))return t.map((t=>qn(t)));if(t instanceof Uint8Array)return Uint8Array.from(t);if(["number","bigint","boolean","string","undefined"].includes(typeof t))return t;if(null===t)return t;if("object"==typeof t)return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,qn(e)])));throw new Error(`cloneDeep: unknown type=${t} (${typeof t})`)}var Yn;function Zn(t,e){const r=t.length;if(e===Yn.ecdsa){if(32===r)throw new Error("Expected non-Schnorr key");return Rn.fromHex(t),t}if(e===Yn.schnorr){if(32!==r)throw new Error("Expected 32-byte Schnorr key");return Ge.utils.lift_x(Ge.utils.bytesToNumberBE(t)),t}throw new Error("Unknown key type")}function Qn(t,e){try{return Zn(t,e),!0}catch(t){return!1}}!function(t){t[t.ecdsa=0]="ecdsa",t[t.schnorr=1]="schnorr"}(Yn||(Yn={}));const Xn=t=>t.r<Kn/2n;function Jn(t,e){const r=Ge.utils,n=r.taggedHash("TapTweak",t,e),o=r.bytesToNumberBE(n);if(o>=Kn)throw new Error("tweak higher than curve order");return o}function to(t,e){const r=Ge.utils,n=Jn(t,e),o=r.lift_x(r.bytesToNumberBE(t)).add(Rn.fromPrivateKey(n)),i=o.hasEvenY()?0:1;return[r.pointToBytes(o),i]}const eo=Nn(On(null),(t=>Zn(t,Yn.ecdsa))),ro=Nn(On(32),(t=>Zn(t,Yn.schnorr))),no=Nn(On(null),(t=>{if(64!==t.length&&65!==t.length)throw new Error("Schnorr signature should be 64 or 65 bytes long");return t}));const oo={bech32:"bc",pubKeyHash:0,scriptHash:5,wif:128},io=4294967295,so=new Uint8Array(32);function ao(t,e){if(!Mn(t)||!Mn(e))throw new Error(`cmp: wrong type a=${typeof t} b=${typeof e}`);const r=Math.min(t.length,e.length);for(let n=0;n<r;n++)if(t[n]!=e[n])return Math.sign(t[n]-e[n]);return Math.sign(t.length-e.length)}var co;bn.decimal(8),function(t){t[t.OP_0=0]="OP_0",t[t.PUSHDATA1=76]="PUSHDATA1",t[t.PUSHDATA2=77]="PUSHDATA2",t[t.PUSHDATA4=78]="PUSHDATA4",t[t["1NEGATE"]=79]="1NEGATE",t[t.RESERVED=80]="RESERVED",t[t.OP_1=81]="OP_1",t[t.OP_2=82]="OP_2",t[t.OP_3=83]="OP_3",t[t.OP_4=84]="OP_4",t[t.OP_5=85]="OP_5",t[t.OP_6=86]="OP_6",t[t.OP_7=87]="OP_7",t[t.OP_8=88]="OP_8",t[t.OP_9=89]="OP_9",t[t.OP_10=90]="OP_10",t[t.OP_11=91]="OP_11",t[t.OP_12=92]="OP_12",t[t.OP_13=93]="OP_13",t[t.OP_14=94]="OP_14",t[t.OP_15=95]="OP_15",t[t.OP_16=96]="OP_16",t[t.NOP=97]="NOP",t[t.VER=98]="VER",t[t.IF=99]="IF",t[t.NOTIF=100]="NOTIF",t[t.VERIF=101]="VERIF",t[t.VERNOTIF=102]="VERNOTIF",t[t.ELSE=103]="ELSE",t[t.ENDIF=104]="ENDIF",t[t.VERIFY=105]="VERIFY",t[t.RETURN=106]="RETURN",t[t.TOALTSTACK=107]="TOALTSTACK",t[t.FROMALTSTACK=108]="FROMALTSTACK",t[t["2DROP"]=109]="2DROP",t[t["2DUP"]=110]="2DUP",t[t["3DUP"]=111]="3DUP",t[t["2OVER"]=112]="2OVER",t[t["2ROT"]=113]="2ROT",t[t["2SWAP"]=114]="2SWAP",t[t.IFDUP=115]="IFDUP",t[t.DEPTH=116]="DEPTH",t[t.DROP=117]="DROP",t[t.DUP=118]="DUP",t[t.NIP=119]="NIP",t[t.OVER=120]="OVER",t[t.PICK=121]="PICK",t[t.ROLL=122]="ROLL",t[t.ROT=123]="ROT",t[t.SWAP=124]="SWAP",t[t.TUCK=125]="TUCK",t[t.CAT=126]="CAT",t[t.SUBSTR=127]="SUBSTR",t[t.LEFT=128]="LEFT",t[t.RIGHT=129]="RIGHT",t[t.SIZE=130]="SIZE",t[t.INVERT=131]="INVERT",t[t.AND=132]="AND",t[t.OR=133]="OR",t[t.XOR=134]="XOR",t[t.EQUAL=135]="EQUAL",t[t.EQUALVERIFY=136]="EQUALVERIFY",t[t.RESERVED1=137]="RESERVED1",t[t.RESERVED2=138]="RESERVED2",t[t["1ADD"]=139]="1ADD",t[t["1SUB"]=140]="1SUB",t[t["2MUL"]=141]="2MUL",t[t["2DIV"]=142]="2DIV",t[t.NEGATE=143]="NEGATE",t[t.ABS=144]="ABS",t[t.NOT=145]="NOT",t[t["0NOTEQUAL"]=146]="0NOTEQUAL",t[t.ADD=147]="ADD",t[t.SUB=148]="SUB",t[t.MUL=149]="MUL",t[t.DIV=150]="DIV",t[t.MOD=151]="MOD",t[t.LSHIFT=152]="LSHIFT",t[t.RSHIFT=153]="RSHIFT",t[t.BOOLAND=154]="BOOLAND",t[t.BOOLOR=155]="BOOLOR",t[t.NUMEQUAL=156]="NUMEQUAL",t[t.NUMEQUALVERIFY=157]="NUMEQUALVERIFY",t[t.NUMNOTEQUAL=158]="NUMNOTEQUAL",t[t.LESSTHAN=159]="LESSTHAN",t[t.GREATERTHAN=160]="GREATERTHAN",t[t.LESSTHANOREQUAL=161]="LESSTHANOREQUAL",t[t.GREATERTHANOREQUAL=162]="GREATERTHANOREQUAL",t[t.MIN=163]="MIN",t[t.MAX=164]="MAX",t[t.WITHIN=165]="WITHIN",t[t.RIPEMD160=166]="RIPEMD160",t[t.SHA1=167]="SHA1",t[t.SHA256=168]="SHA256",t[t.HASH160=169]="HASH160",t[t.HASH256=170]="HASH256",t[t.CODESEPARATOR=171]="CODESEPARATOR",t[t.CHECKSIG=172]="CHECKSIG",t[t.CHECKSIGVERIFY=173]="CHECKSIGVERIFY",t[t.CHECKMULTISIG=174]="CHECKMULTISIG",t[t.CHECKMULTISIGVERIFY=175]="CHECKMULTISIGVERIFY",t[t.NOP1=176]="NOP1",t[t.CHECKLOCKTIMEVERIFY=177]="CHECKLOCKTIMEVERIFY",t[t.CHECKSEQUENCEVERIFY=178]="CHECKSEQUENCEVERIFY",t[t.NOP4=179]="NOP4",t[t.NOP5=180]="NOP5",t[t.NOP6=181]="NOP6",t[t.NOP7=182]="NOP7",t[t.NOP8=183]="NOP8",t[t.NOP9=184]="NOP9",t[t.NOP10=185]="NOP10",t[t.CHECKSIGADD=186]="CHECKSIGADD",t[t.INVALID=255]="INVALID"}(co||(co={}));const ho=yn({encodeStream:(t,e)=>{for(let r of e){if("string"==typeof r){if(void 0===co[r])throw new Error(`Unknown opcode=${r}`);t.byte(co[r]);continue}if("number"==typeof r){if(0===r){t.byte(0);continue}if(1<=r&&r<=16){t.byte(co.OP_1-1+r);continue}}if("number"==typeof r&&(r=uo().encode(BigInt(r))),!Mn(r))throw new Error(`Wrong Script OP=${r} (${typeof r})`);const e=r.length;e<co.PUSHDATA1?t.byte(e):e<=255?(t.byte(co.PUSHDATA1),t.byte(e)):e<=65535?(t.byte(co.PUSHDATA2),t.bytes(Tn.encode(e))):(t.byte(co.PUSHDATA4),t.bytes(In.encode(e))),t.bytes(r)}},decodeStream:t=>{const e=[];for(;!t.isEnd();){const r=t.byte();if(co.OP_0<r&&r<=co.PUSHDATA4){let n;if(r<co.PUSHDATA1)n=r;else if(r===co.PUSHDATA1)n=kn.decodeStream(t);else if(r===co.PUSHDATA2)n=Tn.decodeStream(t);else{if(r!==co.PUSHDATA4)throw new Error("Should be not possible");n=In.decodeStream(t)}e.push(t.bytes(n))}else if(0===r)e.push(0);else if(co.OP_1<=r&&r<=co.OP_16)e.push(r-(co.OP_1-1));else{const t=co[r];if(void 0===t)throw new Error(`Unknown opcode=${r.toString(16)}`);e.push(t)}}return e}});function uo(t=6,e=!1){return yn({encodeStream:(t,e)=>{if(0n===e)return;const r=e<0,n=BigInt(e),o=[];for(let t=r?-n:n;t;t>>=8n)o.push(Number(0xffn&t));o[o.length-1]>=128?o.push(r?128:0):r&&(o[o.length-1]|=128),t.bytes(new Uint8Array(o))},decodeStream:r=>{const n=r.leftBytes;if(n>t)throw new Error(`ScriptNum: number (${n}) bigger than limit=${t}`);if(0===n)return 0n;if(e&&0==(127&r.data[n-1])&&(n<=1||0==(128&r.data[n-2])))throw new Error("Non-minimally encoded ScriptNum");let o=0,i=0n;for(let t=0;t<n;++t)o=r.byte(),i|=BigInt(o)<<8n*BigInt(t);return o>=128&&(i&=2n**BigInt(8*n)-1n>>1n,i=-i),i}})}const fo={253:[253,2,253n,65535n],254:[254,4,65536n,4294967295n],255:[255,8,4294967296n,18446744073709551615n]},lo=yn({encodeStream:(t,e)=>{if("number"==typeof e&&(e=BigInt(e)),0n<=e&&e<=252n)return t.byte(Number(e));for(const[r,n,o,i]of Object.values(fo))if(!(o>e||e>i)){t.byte(r);for(let r=0;r<n;r++)t.byte(Number(e>>8n*BigInt(r)&0xffn));return}throw t.err(`VarInt too big: ${e}`)},decodeStream:t=>{const e=t.byte();if(e<=252)return BigInt(e);const[r,n,o]=fo[e];let i=0n;for(let e=0;e<n;e++)i|=BigInt(t.byte())<<8n*BigInt(e);if(i<o)throw t.err(`Wrong CompactSize(${8*n})`);return i}}),po=Ln(lo,bn.number),yo=t=>_n(lo,t),wo=On(lo),go=$n({txid:On(32,!0),index:In,finalScriptSig:wo,sequence:In}),bo=$n({amount:xn,script:wo}),Eo={amount:0xffffffffffffffffn,script:sn},mo=_n(po,wo),xo=Nn($n({version:Un,segwitFlag:((t,e=!1)=>yn({size:t.length,encodeStream:(r,n)=>{!!n!==e&&r.bytes(t)},decodeStream:r=>{let n=r.leftBytes>=t.length;return n&&(n=cn(r.bytes(t.length,!0),t),n&&r.bytes(t.length)),n!==e}}))(new Uint8Array([0,1])),inputs:yo(go),outputs:yo(bo),witnesses:function(t,e,r){if(!gn(e))throw new Error(`flagged: invalid inner value ${e}`);return yn({encodeStream:(r,n)=>{wn(r.path,t.split("/"))&&e.encodeStream(r,n)},decodeStream:r=>{let n=!1;if(n=wn(r.path,t.split("/")),n)return e.decodeStream(r)}})}("segwitFlag",_n("inputs/length",mo)),lockTime:In}),(function(t){if(t.segwitFlag&&t.witnesses&&!t.witnesses.length)throw new Error("Segwit flag with empty witnesses array");return t}));function Ao(t){const[e,r,n,o,i,s]=t;return{type:e,kc:r,vc:n,reqInc:o,allowInc:i,silentIgnore:s}}const So=$n({fingerprint:Bn,path:_n(null,In)}),vo=Nn($n({version:kn,internalKey:On(32),merklePath:_n(null,On(32))}),(t=>{if(t.merklePath.length>128)throw new Error("TaprootControlBlock: merklePath should be of length 0..128 (inclusive)");return t})),Io=$n({hashes:_n(po,On(32)),der:So}),Bo=On(78),Uo=$n({pubKey:ro,leafHash:On(32)}),To=_n(null,$n({depth:kn,version:kn,script:wo})),ko=On(null),Oo=On(20),Po=On(32),Lo={unsignedTx:[0,!1,xo,[0],[0],!1],xpub:[1,Bo,So,[],[0,2],!1],txVersion:[2,!1,In,[2],[2],!1],fallbackLocktime:[3,!1,In,[],[2],!1],inputCount:[4,!1,po,[2],[2],!1],outputCount:[5,!1,po,[2],[2],!1],txModifiable:[6,!1,kn,[],[2],!1],version:[251,!1,In,[],[0,2],!1],proprietary:[252,ko,ko,[],[0,2],!1]},No={nonWitnessUtxo:[0,!1,xo,[],[0,2],!1],witnessUtxo:[1,!1,bo,[],[0,2],!1],partialSig:[2,eo,ko,[],[0,2],!1],sighashType:[3,!1,In,[],[0,2],!1],redeemScript:[4,!1,ko,[],[0,2],!1],witnessScript:[5,!1,ko,[],[0,2],!1],bip32Derivation:[6,eo,So,[],[0,2],!1],finalScriptSig:[7,!1,ko,[],[0,2],!1],finalScriptWitness:[8,!1,mo,[],[0,2],!1],porCommitment:[9,!1,ko,[],[0,2],!1],ripemd160:[10,Oo,ko,[],[0,2],!1],sha256:[11,Po,ko,[],[0,2],!1],hash160:[12,Oo,ko,[],[0,2],!1],hash256:[13,Po,ko,[],[0,2],!1],txid:[14,!1,Po,[2],[2],!0],index:[15,!1,In,[2],[2],!0],sequence:[16,!1,In,[],[2],!0],requiredTimeLocktime:[17,!1,In,[],[2],!1],requiredHeightLocktime:[18,!1,In,[],[2],!1],tapKeySig:[19,!1,no,[],[0,2],!1],tapScriptSig:[20,Uo,no,[],[0,2],!1],tapLeafScript:[21,vo,ko,[],[0,2],!1],tapBip32Derivation:[22,Po,Io,[],[0,2],!1],tapInternalKey:[23,!1,ro,[],[0,2],!1],tapMerkleRoot:[24,!1,Po,[],[0,2],!1],proprietary:[252,ko,ko,[],[0,2],!1]},Co=["txid","sequence","index","witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknown"],Ho=["partialSig","finalScriptSig","finalScriptWitness","tapKeySig","tapScriptSig"],$o={redeemScript:[0,!1,ko,[],[0,2],!1],witnessScript:[1,!1,ko,[],[0,2],!1],bip32Derivation:[2,eo,So,[],[0,2],!1],amount:[3,!1,Sn,[2],[2],!0],script:[4,!1,ko,[2],[2],!0],tapInternalKey:[5,!1,ro,[],[0,2],!1],tapTree:[6,!1,To,[],[0,2],!1],tapBip32Derivation:[7,ro,Io,[],[0,2],!1],proprietary:[252,ko,ko,[],[0,2],!1]},_o=[],Ro=_n(an,$n({key:function(t,e){if(!gn(e))throw new Error(`prefix: invalid inner value ${e}`);if(un(t))throw new Error("prefix: len cannot be Uint8Array");const r=On(t);return yn({size:"number"==typeof t?t:void 0,encodeStream:(t,n)=>{const o=new ln(t.path,t.fieldPath);e.encodeStream(o,n),r.encodeStream(t,o.buffer)},decodeStream:t=>{const n=r.decodeStream(t);return e.decodeStream(new fn(n,t.path,t.fieldPath))}})}(po,$n({type:po,key:On(null)})),value:On(po)}));function Do(t){const e={};for(const r in t){const[n,o,i]=t[r];e[n]=[r,o,i]}return yn({encodeStream:(e,r)=>{let n=[];for(const e in t){const o=r[e];if(void 0===o)continue;const[i,s,a]=t[e];if(s){const t=o.map((([t,e])=>[s.encode(t),a.encode(e)]));t.sort(((t,e)=>ao(t[0],e[0])));for(const[e,r]of t)n.push({key:{key:e,type:i},value:r})}else n.push({key:{type:i,key:sn},value:a.encode(o)})}if(r.unknown){r.unknown.sort(((t,e)=>ao(t[0].key,e[0].key)));for(const[t,e]of r.unknown)n.push({key:t,value:e})}Ro.encodeStream(e,n)},decodeStream:t=>{const r=Ro.decodeStream(t),n={},o={};for(const t of r){let r="unknown",i=t.key.key,s=t.value;if(e[t.key.type]){const[a,c,h]=e[t.key.type];if(r=a,!c&&i.length)throw new Error(`PSBT: Non-empty key for ${r} (key=${br.encode(i)} value=${br.encode(s)}`);if(i=c?c.decode(i):void 0,s=h.decode(s),!c){if(n[r])throw new Error(`PSBT: Same keys: ${r} (key=${i} value=${s})`);n[r]=s,o[r]=!0;continue}}else i={type:t.key.type,key:t.key.key};if(o[r])throw new Error(`PSBT: Key type with empty key and no key=${r} val=${s}`);n[r]||(n[r]=[]),n[r].push([i,s])}return n}})}function Fo(t,e){if(!cn(t.hash,Wr(e)))throw new Error("checkScript: wsh wrong witnessScript hash");const r=bi.decode(e);if("tr"===r.type||"tr_ns"===r.type||"tr_ms"===r.type)throw new Error(`checkScript: P2${r.type} cannot be wrapped in P2SH`);if("wpkh"===r.type||"sh"===r.type)throw new Error(`checkScript: P2${r.type} cannot be wrapped in P2WSH`)}function Ko(t,e,r){if(t){const n=bi.decode(t);if("tr_ns"===n.type||"tr_ms"===n.type||"ms"===n.type||"pk"==n.type)throw new Error(`checkScript: non-wrapped ${n.type}`);if("sh"===n.type&&e){if(!cn(n.hash,Wn(e)))throw new Error("checkScript: sh wrong redeemScript hash");const t=bi.decode(e);if("tr"===t.type||"tr_ns"===t.type||"tr_ms"===t.type)throw new Error(`checkScript: P2${t.type} cannot be wrapped in P2SH`);if("sh"===t.type)throw new Error("checkScript: P2SH cannot be wrapped in P2SH")}"wsh"===n.type&&r&&Fo(n,r)}if(e){const t=bi.decode(e);"wsh"===t.type&&r&&Fo(t,r)}}$n({type:po,key:On(null)});const jo=Nn(Do(No),(t=>{if(t.finalScriptWitness&&!t.finalScriptWitness.length)throw new Error("validateInput: wmpty finalScriptWitness");if(t.partialSig&&!t.partialSig.length)throw new Error("Empty partialSig");if(t.partialSig)for(const[e]of t.partialSig)Zn(e,Yn.ecdsa);if(t.bip32Derivation)for(const[e]of t.bip32Derivation)Zn(e,Yn.ecdsa);if(void 0!==t.requiredTimeLocktime&&t.requiredTimeLocktime<5e8)throw new Error(`validateInput: wrong timeLocktime=${t.requiredTimeLocktime}`);if(void 0!==t.requiredHeightLocktime&&(t.requiredHeightLocktime<=0||t.requiredHeightLocktime>=5e8))throw new Error(`validateInput: wrong heighLocktime=${t.requiredHeightLocktime}`);if(t.nonWitnessUtxo&&void 0!==t.index){const e=t.nonWitnessUtxo.outputs.length-1;if(t.index>e)throw new Error(`validateInput: index(${t.index}) not in nonWitnessUtxo`);const r=t.nonWitnessUtxo.outputs[t.index];if(t.witnessUtxo&&(!cn(t.witnessUtxo.script,r.script)||t.witnessUtxo.amount!==r.amount))throw new Error("validateInput: witnessUtxo different from nonWitnessUtxo")}if(t.tapLeafScript)for(const[e,r]of t.tapLeafScript){if((254&e.version)!==r[r.length-1])throw new Error("validateInput: tapLeafScript version mimatch");if(1&r[r.length-1])throw new Error("validateInput: tapLeafScript version has parity bit!")}if(t.nonWitnessUtxo&&t.index&&t.txid){if(t.nonWitnessUtxo.outputs.length-1<t.index)throw new Error("nonWitnessUtxo: incorect output index");const e=Ni.fromRaw(xo.encode(t.nonWitnessUtxo)),r=br.encode(t.txid);if(e.id!==r)throw new Error(`nonWitnessUtxo: wrong txid, exp=${r} got=${e.id}`)}return t})),Mo=Nn(Do($o),(t=>{if(t.bip32Derivation)for(const[e]of t.bip32Derivation)Zn(e,Yn.ecdsa);return t})),Wo=Nn(Do(Lo),(t=>{if(0===(t.version||0)){if(!t.unsignedTx)throw new Error("PSBTv0: missing unsignedTx");if(t.unsignedTx.segwitFlag||t.unsignedTx.witnesses)throw new Error("PSBTv0: witness in unsingedTx");for(const e of t.unsignedTx.inputs)if(e.finalScriptSig&&e.finalScriptSig.length)throw new Error("PSBTv0: input scriptSig found in unsignedTx")}return t})),zo=$n({magic:Cn(Pn(new Uint8Array([255])),"psbt"),global:Wo,inputs:_n("global/unsignedTx/inputs/length",jo),outputs:_n(null,Mo)}),Vo=$n({magic:Cn(Pn(new Uint8Array([255])),"psbt"),global:Wo,inputs:_n("global/inputCount",jo),outputs:_n("global/outputCount",Mo)});function Go(t,e,r){for(const n in r){if("unknown"===n)continue;if(!e[n])continue;const{allowInc:r}=Ao(e[n]);if(!r.includes(t))throw new Error(`PSBTv${t}: field ${n} is not allowed`)}for(const n in e){const{reqInc:o}=Ao(e[n]);if(o.includes(t)&&void 0===r[n])throw new Error(`PSBTv${t}: missing required field ${n}`)}}function qo(t,e,r){const n={};for(const o in r){const i=o;if("unknown"!==i){if(!e[i])continue;const{allowInc:r,silentIgnore:n}=Ao(e[i]);if(!r.includes(t)){if(n)continue;throw new Error(`Failed to serialize in PSBTv${t}: ${i} but versions allows inclusion=${r}`)}}n[i]=r[i]}return n}function Yo(t){const e=t&&t.global&&t.global.version||0;Go(e,Lo,t.global);for(const r of t.inputs)Go(e,No,r);for(const r of t.outputs)Go(e,$o,r);const r=e?t.global.inputCount:t.global.unsignedTx.inputs.length;if(t.inputs.length<r)throw new Error("Not enough inputs");const n=t.inputs.slice(r);if(n.length>1||n.length&&Object.keys(n[0]).length)throw new Error(`Unexpected inputs left in tx=${n}`);const o=e?t.global.outputCount:t.global.unsignedTx.outputs.length;if(t.outputs.length<o)throw new Error("Not outputs inputs");const i=t.outputs.slice(o);if(i.length>1||i.length&&Object.keys(i[0]).length)throw new Error(`Unexpected outputs left in tx=${i}`);return t}function Zo(t,e,r,n){const o={...r,...e};for(const i in t){const s=i,[a,c,h]=t[s],u=n&&!n.includes(i);if(void 0===e[i]&&i in e){if(u)throw new Error(`Cannot remove signed field=${i}`);delete o[i]}else if(c){const t=r&&r[i]?r[i]:[];let n=e[s];if(n){if(!Array.isArray(n))throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);n=n.map((t=>{if(2!==t.length)throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);return["string"==typeof t[0]?c.decode(br.decode(t[0])):t[0],"string"==typeof t[1]?h.decode(br.decode(t[1])):t[1]]}));const e={},r=(t,r,n)=>{if(void 0===e[t])return void(e[t]=[r,n]);const o=br.encode(h.encode(e[t][1])),i=br.encode(h.encode(n));if(o!==i)throw new Error(`keyMap(${s}): same key=${t} oldVal=${o} newVal=${i}`)};for(const[e,n]of t)r(br.encode(c.encode(e)),e,n);for(const[t,o]of n){const n=br.encode(c.encode(t));if(void 0===o){if(u)throw new Error(`Cannot remove signed field=${s}/${t}`);delete e[n]}else r(n,t,o)}o[s]=Object.values(e)}}else if("string"==typeof o[i])o[i]=h.decode(br.decode(o[i]));else if(u&&i in e&&r&&void 0!==r[i]&&!cn(h.encode(e[i]),h.encode(r[i])))throw new Error(`Cannot change signed field=${i}`)}for(const e in o)t[e]||delete o[e];return o}$n({magic:Cn(Pn(new Uint8Array([255])),"psbt"),items:_n(null,Ln(_n(an,function(t){if(!Array.isArray(t))throw new Error(`Packed.Tuple: got ${typeof t} instead of array`);return yn({size:Hn(t),encodeStream:(e,r)=>{if(!Array.isArray(r))throw e.err(`tuple: invalid value ${r}`);e.path.push(r);for(let n=0;n<t.length;n++)e.fieldPathPush(""+n),t[n].encodeStream(e,r[n]),e.fieldPathPop();e.path.pop()},decodeStream:e=>{let r=[];e.path.push(r);for(let n=0;n<t.length;n++)e.fieldPathPush(""+n),r.push(t[n].decodeStream(e)),e.fieldPathPop();return e.path.pop(),r}})}([((t,e=!1,r=!1)=>{const n=On(t,e);return yn({size:n.size,encodeStream:(t,e)=>{if(r&&!e.startsWith("0x"))throw new Error("hex(withZero=true).encode input should start with 0x");const o=br.decode(r?e.slice(2):e);return n.encodeStream(t,o)},decodeStream:t=>(r?"0x":"")+br.encode(n.decodeStream(t))})})(po),On(lo)])),bn.dict()))});const Qo=Nn(zo,Yo),Xo=Nn(Vo,Yo),Jo=$n({txid:On(32,!0),index:In}),ti={encode(t){if(2===t.length&&Mn(t[0])&&Qn(t[0],Yn.ecdsa)&&"CHECKSIG"===t[1])return{type:"pk",pubkey:t[0]}},decode:t=>"pk"===t.type?[t.pubkey,"CHECKSIG"]:void 0},ei={encode(t){if(5===t.length&&"DUP"===t[0]&&"HASH160"===t[1]&&Mn(t[2])&&"EQUALVERIFY"===t[3]&&"CHECKSIG"===t[4])return{type:"pkh",hash:t[2]}},decode:t=>"pkh"===t.type?["DUP","HASH160",t.hash,"EQUALVERIFY","CHECKSIG"]:void 0},ri=(t,e=oo)=>{if(!Qn(t,Yn.ecdsa))throw new Error("P2PKH: invalid publicKey");const r=Wn(t);return{type:"pkh",script:bi.encode({type:"pkh",hash:r}),address:Ai(e).encode({type:"pkh",hash:r})}},ni={encode(t){if(3===t.length&&"HASH160"===t[0]&&Mn(t[1])&&"EQUAL"===t[2])return{type:"sh",hash:t[1]}},decode:t=>"sh"===t.type?["HASH160",t.hash,"EQUAL"]:void 0},oi=(t,e=oo)=>{const r=t.script;if(!Mn(r))throw new Error(`Wrong script: ${typeof t.script}, expected Uint8Array`);const n=Wn(r);Ko(bi.encode({type:"sh",hash:n}),r,t.witnessScript);const o={type:"sh",redeemScript:r,script:bi.encode({type:"sh",hash:n}),address:Ai(e).encode({type:"sh",hash:n})};return t.witnessScript&&(o.witnessScript=t.witnessScript),o},ii={encode(t){if(2===t.length&&0===t[0]&&Mn(t[1])&&32===t[1].length)return{type:"wsh",hash:t[1]}},decode:t=>"wsh"===t.type?[0,t.hash]:void 0},si=(t,e=oo)=>{const r=t.script;if(!Mn(r))throw new Error(`Wrong script: ${typeof r}, expected Uint8Array`);const n=Wr(r);return Ko(bi.encode({type:"wsh",hash:n}),void 0,r),{type:"wsh",witnessScript:r,script:bi.encode({type:"wsh",hash:n}),address:Ai(e).encode({type:"wsh",hash:n})}},ai={encode(t){if(2===t.length&&0===t[0]&&Mn(t[1])&&20===t[1].length)return{type:"wpkh",hash:t[1]}},decode:t=>"wpkh"===t.type?[0,t.hash]:void 0},ci=(t,e=oo)=>{if(!Qn(t,Yn.ecdsa))throw new Error("P2WPKH: invalid publicKey");if(65===t.length)throw new Error("P2WPKH: uncompressed public key");const r=Wn(t);return{type:"wpkh",script:bi.encode({type:"wpkh",hash:r}),address:Ai(e).encode({type:"wpkh",hash:r})}},hi={encode(t){const e=t.length-1;if("CHECKMULTISIG"!==t[e])return;const r=t[0],n=t[e-1];if("number"!=typeof r||"number"!=typeof n)return;const o=t.slice(1,-2);if(n===o.length){for(const t of o)if(!Mn(t))return;return{type:"ms",m:r,pubkeys:o}}},decode:t=>"ms"===t.type?[t.m,...t.pubkeys,t.pubkeys.length,"CHECKMULTISIG"]:void 0},ui=(t,e,r=!1)=>(r||function(t){const e={};for(const r of t){const n=br.encode(r);if(e[n])throw new Error(`Multisig: non-uniq pubkey: ${t.map(br.encode)}`);e[n]=!0}}(e),{type:"ms",script:bi.encode({type:"ms",pubkeys:e,m:t})}),fi={encode(t){if(2===t.length&&1===t[0]&&Mn(t[1]))return{type:"tr",pubkey:t[1]}},decode:t=>"tr"===t.type?[1,t.pubkey]:void 0};function li(t,e,r=!1){if(!t)throw new Error("taprootHashTree: empty tree");if(Array.isArray(t)&&1===t.length&&(t=t[0]),!Array.isArray(t)){const{leafVersion:n,script:o}=t;if(t.tapLeafScript||t.tapMerkleRoot&&!cn(t.tapMerkleRoot,sn))throw new Error("P2TR: tapRoot leafScript cannot have tree");const i="string"==typeof o?br.decode(o):o;if(!Mn(i))throw new Error(`checkScript: wrong script type=${i}`);return function(t,e,r=!1){const n=bi.decode(t);if("unknown"===n.type&&r)return;if(!["tr_ns","tr_ms"].includes(n.type))throw new Error(`P2TR: invalid leaf script=${n.type}`);const o=n;if(!r&&o.pubkeys)for(const t of o.pubkeys){if(cn(t,yi))throw new Error("Unspendable taproot key in leaf script");if(cn(t,e))throw new Error("Using P2TR with leaf script with same key as internal key is not supported")}}(i,e,r),{type:"leaf",version:n,script:i,hash:Pi(i,n)}}if(2!==t.length&&(t=function(t){const e=Array.from(t);for(;e.length>=2;){e.sort(((t,e)=>(e.weight||1)-(t.weight||1)));const t=e.pop(),r=e.pop(),n=(r?.weight||1)+(t?.weight||1);e.push({weight:n,childs:[r?.childs||r,t?.childs||t]})}const r=e[0];return r?.childs||r}(t)),2!==t.length)throw new Error("hashTree: non binary tree!");const n=li(t[0],e,r),o=li(t[1],e,r);let[i,s]=[n.hash,o.hash];return-1===ao(s,i)&&([i,s]=[s,i]),{type:"branch",left:n,right:o,hash:Ge.utils.taggedHash("TapBranch",i,s)}}function di(t,e=[]){if(!t)throw new Error("taprootAddPath: empty tree");if("leaf"===t.type)return{...t,path:e};if("branch"!==t.type)throw new Error(`taprootAddPath: wrong type=${t}`);return{...t,path:e,left:di(t.left,[t.right.hash,...e]),right:di(t.right,[t.left.hash,...e])}}function pi(t){if(!t)throw new Error("taprootAddPath: empty tree");if("leaf"===t.type)return[t];if("branch"!==t.type)throw new Error(`taprootWalkTree: wrong type=${t}`);return[...pi(t.left),...pi(t.right)]}const yi=Wr(Rn.BASE.toRawBytes(!1));function wi(t,e,r=oo,n=!1){if(!t&&!e)throw new Error("p2tr: should have pubKey or scriptTree (or both)");const o="string"==typeof t?br.decode(t):t||yi;if(!Qn(o,Yn.schnorr))throw new Error("p2tr: non-schnorr pubkey");let i=e?di(li(e,o,n)):void 0;const s=i?i.hash:void 0,[a,c]=to(o,s||sn);let h,u;i&&(h=pi(i).map((t=>({...t,controlBlock:vo.encode({version:(t.version||Oi)+c,internalKey:o,merklePath:t.path})})))),h&&(u=h.map((t=>[vo.decode(t.controlBlock),Vn(t.script,new Uint8Array([t.version||Oi]))])));const f={type:"tr",script:bi.encode({type:"tr",pubkey:a}),address:Ai(r).encode({type:"tr",pubkey:a}),tweakedPubkey:a,tapInternalKey:o};return h&&(f.leaves=h),u&&(f.tapLeafScript=u),s&&(f.tapMerkleRoot=s),f}const gi=[ti,ei,ni,ii,ai,hi,fi,{encode(t){const e=t.length-1;if("CHECKSIG"!==t[e])return;const r=[];for(let n=0;n<e;n++){const o=t[n];if(1&n){if("CHECKSIGVERIFY"!==o||n===e-1)return}else{if(!Mn(o))return;r.push(o)}}return{type:"tr_ns",pubkeys:r}},decode:t=>{if("tr_ns"!==t.type)return;const e=[];for(let r=0;r<t.pubkeys.length-1;r++)e.push(t.pubkeys[r],"CHECKSIGVERIFY");return e.push(t.pubkeys[t.pubkeys.length-1],"CHECKSIG"),e}},{encode(t){const e=t.length-1;if("NUMEQUAL"!==t[e]||"CHECKSIG"!==t[1])return;const r=[],n=function(t,e=4,r=!0){if("number"==typeof t)return t;if(Mn(t))try{const n=uo(e,r).decode(t);if(n>Number.MAX_SAFE_INTEGER)return;return Number(n)}catch(t){return}}(t[e-1]);if("number"==typeof n){for(let n=0;n<e-1;n++){const e=t[n];if(1&n){if(e!==(1===n?"CHECKSIG":"CHECKSIGADD"))throw new Error("OutScript.encode/tr_ms: wrong element")}else{if(!Mn(e))throw new Error("OutScript.encode/tr_ms: wrong key element");r.push(e)}}return{type:"tr_ms",pubkeys:r,m:n}}},decode:t=>{if("tr_ms"!==t.type)return;const e=[t.pubkeys[0],"CHECKSIG"];for(let r=1;r<t.pubkeys.length;r++)e.push(t.pubkeys[r],"CHECKSIGADD");return e.push(t.m,"NUMEQUAL"),e}},{encode:t=>({type:"unknown",script:ho.encode(t)}),decode:t=>"unknown"===t.type?ho.decode(t.script):void 0}],bi=Nn(Ln(ho,bn.match(gi)),(t=>{if("pk"===t.type&&!Qn(t.pubkey,Yn.ecdsa))throw new Error("OutScript/pk: wrong key");if(!("pkh"!==t.type&&"sh"!==t.type&&"wpkh"!==t.type||Mn(t.hash)&&20===t.hash.length))throw new Error(`OutScript/${t.type}: wrong hash`);if("wsh"===t.type&&(!Mn(t.hash)||32!==t.hash.length))throw new Error("OutScript/wsh: wrong hash");if(!("tr"!==t.type||Mn(t.pubkey)&&Qn(t.pubkey,Yn.schnorr)))throw new Error("OutScript/tr: wrong taproot public key");if(("ms"===t.type||"tr_ns"===t.type||"tr_ms"===t.type)&&!Array.isArray(t.pubkeys))throw new Error("OutScript/multisig: wrong pubkeys array");if("ms"===t.type){const e=t.pubkeys.length;for(const e of t.pubkeys)if(!Qn(e,Yn.ecdsa))throw new Error("OutScript/multisig: wrong pubkey");if(t.m<=0||e>16||t.m>e)throw new Error("OutScript/multisig: invalid params")}if("tr_ns"===t.type||"tr_ms"===t.type)for(const e of t.pubkeys)if(!Qn(e,Yn.schnorr))throw new Error(`OutScript/${t.type}: wrong pubkey`);if("tr_ms"===t.type){const e=t.pubkeys.length;if(t.m<=0||e>999||t.m>e)throw new Error("OutScript/tr_ms: invalid params")}return t}));function Ei(t,e){if(e.length<2||e.length>40)throw new Error("Witness: invalid length");if(t>16)throw new Error("Witness: invalid version");if(0===t&&20!==e.length&&32!==e.length)throw new Error("Witness: invalid length for version")}function mi(t,e,r=oo){Ei(t,e);const n=0===t?pr:yr;return n.encode(r.bech32,[t].concat(n.toWords(e)))}function xi(t,e){return Gn.encode(Vn(Uint8Array.from(e),t))}function Ai(t=oo){return{encode(e){const{type:r}=e;if("wpkh"===r)return mi(0,e.hash,t);if("wsh"===r)return mi(0,e.hash,t);if("tr"===r)return mi(1,e.pubkey,t);if("pkh"===r)return xi(e.hash,[t.pubKeyHash]);if("sh"===r)return xi(e.hash,[t.scriptHash]);throw new Error(`Unknown address type=${r}`)},decode(e){if(e.length<14||e.length>74)throw new Error("Invalid address length");if(t.bech32&&e.toLowerCase().startsWith(t.bech32)){let r;try{if(r=pr.decode(e),0!==r.words[0])throw new Error(`bech32: wrong version=${r.words[0]}`)}catch(t){if(r=yr.decode(e),0===r.words[0])throw new Error(`bech32m: wrong version=${r.words[0]}`)}if(r.prefix!==t.bech32)throw new Error(`wrong bech32 prefix=${r.prefix}`);const[n,...o]=r.words,i=pr.fromWords(o);if(Ei(n,i),0===n&&32===i.length)return{type:"wsh",hash:i};if(0===n&&20===i.length)return{type:"wpkh",hash:i};if(1===n&&32===i.length)return{type:"tr",pubkey:i};throw new Error("Unknown witness program")}const r=Gn.decode(e);if(21!==r.length)throw new Error("Invalid base58 address");if(r[0]===t.pubKeyHash)return{type:"pkh",hash:r.slice(1)};if(r[0]===t.scriptHash)return{type:"sh",hash:r.slice(1)};throw new Error(`Invalid address prefix=${r[0]}`)}}}var Si,vi;function Ii(t){if("number"!=typeof t||"string"!=typeof vi[t])throw new Error(`Invalid SigHash=${t}`);return t}function Bi(t){const e=31&t;return{isAny:!!(t&Si.ANYONECANPAY),isNone:e===Si.NONE,isSingle:e===Si.SINGLE}}function Ui(t){if(void 0===t.txid||void 0===t.index)throw new Error("Transaction/input: txid and index required");return{txid:t.txid,index:t.index,sequence:jn(t.sequence,io),finalScriptSig:jn(t.finalScriptSig,sn)}}function Ti(t){for(const e in t){const r=e;Co.includes(r)||delete t[r]}}function ki(t){if(void 0===t.script||void 0===t.amount)throw new Error("Transaction/output: script and amount required");return{script:t.script,amount:t.amount}}!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.ANYONECANPAY=128]="ANYONECANPAY"}(Si||(Si={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.DEFAULT_ANYONECANPAY=128]="DEFAULT_ANYONECANPAY",t[t.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",t[t.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",t[t.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY"}(vi||(vi={}));const Oi=192,Pi=(t,e=Oi)=>Ge.utils.taggedHash("TapLeaf",new Uint8Array([e]),wo.encode(t));const Li={}.toString;class Ni{constructor(t={}){this.global={},this.inputs=[],this.outputs=[];const e=this.opts=function(t){if(void 0!==t&&"[object Object]"!==Li.call(t))throw new Error(`Wrong object type for transaction options: ${t}`);const e={...t,version:jn(t.version,2),lockTime:jn(t.lockTime,0),PSBTVersion:jn(t.PSBTVersion,0)};if(void 0!==e.allowUnknowInput&&(t.allowUnknownInputs=e.allowUnknowInput),void 0!==e.allowUnknowOutput&&(t.allowUnknownOutputs=e.allowUnknowOutput),![-1,0,1,2].includes(e.version))throw new Error(`Unknown version: ${e.version}`);if("number"!=typeof e.lockTime)throw new Error("Transaction lock time should be number");if(In.encode(e.lockTime),0!==e.PSBTVersion&&2!==e.PSBTVersion)throw new Error(`Unknown PSBT version ${e.PSBTVersion}`);for(const t of["allowUnknownOutputs","allowUnknownInputs","disableScriptCheck","bip174jsCompat","allowLegacyWitnessUtxo","lowR"]){const r=e[t];if(void 0!==r&&"boolean"!=typeof r)throw new Error(`Transation options wrong type: ${t}=${r} (${typeof r})`)}return Object.freeze(e)}(t);0!==e.lockTime&&(this.global.fallbackLocktime=e.lockTime),this.global.txVersion=e.version}static fromRaw(t,e={}){const r=xo.decode(t),n=new Ni({...e,version:r.version,lockTime:r.lockTime});for(const t of r.outputs)n.addOutput(t);if(n.outputs=r.outputs,n.inputs=r.inputs,r.witnesses)for(let t=0;t<r.witnesses.length;t++)n.inputs[t].finalScriptWitness=r.witnesses[t];return n}static fromPSBT(t,e={}){let r;try{r=Qo.decode(t)}catch(e){try{r=Xo.decode(t)}catch(t){throw e}}const n=r.global.version||0;if(0!==n&&2!==n)throw new Error(`Wrong PSBT version=${n}`);const o=r.global.unsignedTx,i=0===n?o?.version:r.global.txVersion,s=0===n?o?.lockTime:r.global.fallbackLocktime,a=new Ni({...e,version:i,lockTime:s,PSBTVersion:n}),c=0===n?o?.inputs.length:r.global.inputCount;a.inputs=r.inputs.slice(0,c).map(((t,e)=>({finalScriptSig:sn,...r.global.unsignedTx?.inputs[e],...t})));const h=0===n?o?.outputs.length:r.global.outputCount;return a.outputs=r.outputs.slice(0,h).map(((t,e)=>({...t,...r.global.unsignedTx?.outputs[e]}))),a.global={...r.global,txVersion:i},0!==s&&(a.global.fallbackLocktime=s),a}toPSBT(t=this.opts.PSBTVersion){if(0!==t&&2!==t)throw new Error(`Wrong PSBT version=${t}`);const e=this.inputs.map((e=>qo(t,No,e)));for(const t of e)t.partialSig&&!t.partialSig.length&&delete t.partialSig,t.finalScriptSig&&!t.finalScriptSig.length&&delete t.finalScriptSig,t.finalScriptWitness&&!t.finalScriptWitness.length&&delete t.finalScriptWitness;const r=this.outputs.map((e=>qo(t,$o,e))),n={...this.global};return 0===t?(n.unsignedTx=xo.decode(this.unsignedTx),delete n.fallbackLocktime,delete n.txVersion):(n.version=t,n.txVersion=this.version,n.inputCount=this.inputs.length,n.outputCount=this.outputs.length,n.fallbackLocktime&&0===n.fallbackLocktime&&delete n.fallbackLocktime),this.opts.bip174jsCompat&&(e.length||e.push({}),r.length||r.push({})),(0===t?Qo:Xo).encode({global:n,inputs:e,outputs:r})}get lockTime(){let t=0,e=0,r=0,n=0;for(const o of this.inputs)o.requiredHeightLocktime&&(t=Math.max(t,o.requiredHeightLocktime),e++),o.requiredTimeLocktime&&(r=Math.max(r,o.requiredTimeLocktime),n++);return e&&e>=n?t:0!==r?r:this.global.fallbackLocktime||0}get version(){if(void 0===this.global.txVersion)throw new Error("No global.txVersion");return this.global.txVersion}inputStatus(t){this.checkInputIdx(t);const e=this.inputs[t];return e.finalScriptSig&&e.finalScriptSig.length||e.finalScriptWitness&&e.finalScriptWitness.length?"finalized":e.tapKeySig||e.tapScriptSig&&e.tapScriptSig.length||e.partialSig&&e.partialSig.length?"signed":"unsigned"}inputSighash(t){this.checkInputIdx(t);const e=this.inputType(this.inputs[t]).sighash,r=e===Si.DEFAULT?Si.ALL:3&e;return{sigInputs:e&Si.ANYONECANPAY,sigOutputs:r}}signStatus(){let t=!0,e=!0,r=[],n=[];for(let o=0;o<this.inputs.length;o++){if("unsigned"===this.inputStatus(o))continue;const{sigInputs:i,sigOutputs:s}=this.inputSighash(o);if(i===Si.ANYONECANPAY?r.push(o):t=!1,s===Si.ALL)e=!1;else if(s===Si.SINGLE)n.push(o);else if(s!==Si.NONE)throw new Error(`Wrong signature hash output type: ${s}`)}return{addInput:t,addOutput:e,inputs:r,outputs:n}}get isFinal(){for(let t=0;t<this.inputs.length;t++)if("finalized"!==this.inputStatus(t))return!1;return!0}get hasWitnesses(){let t=!1;for(const e of this.inputs)e.finalScriptWitness&&e.finalScriptWitness.length&&(t=!0);return t}get weight(){if(!this.isFinal)throw new Error("Transaction is not finalized");let t=32;const e=this.outputs.map(ki);this.hasWitnesses&&(t+=2),t+=4*po.encode(this.inputs.length).length,t+=4*po.encode(this.outputs.length).length;for(const e of this.inputs)t+=160+4*wo.encode(e.finalScriptSig||sn).length;for(const r of e)t+=32+4*wo.encode(r.script).length;if(this.hasWitnesses)for(const e of this.inputs)e.finalScriptWitness&&(t+=mo.encode(e.finalScriptWitness).length);return t}get vsize(){return Math.ceil(this.weight/4)}toBytes(t=!1,e=!1){return xo.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(Ui).map((e=>({...e,finalScriptSig:t&&e.finalScriptSig||sn}))),outputs:this.outputs.map(ki),witnesses:this.inputs.map((t=>t.finalScriptWitness||[])),segwitFlag:e&&this.hasWitnesses})}get unsignedTx(){return this.toBytes(!1,!1)}get hex(){return br.encode(this.toBytes(!0,this.hasWitnesses))}get hash(){if(!this.isFinal)throw new Error("Transaction is not finalized");return br.encode(zn(this.toBytes(!0)))}get id(){if(!this.isFinal)throw new Error("Transaction is not finalized");return br.encode(zn(this.toBytes(!0)).reverse())}checkInputIdx(t){if(!Number.isSafeInteger(t)||0>t||t>=this.inputs.length)throw new Error(`Wrong input index=${t}`)}getInput(t){return this.checkInputIdx(t),qn(this.inputs[t])}get inputsLength(){return this.inputs.length}normalizeInput(t,e,r){let{nonWitnessUtxo:n,txid:o}=t;"string"==typeof n&&(n=br.decode(n)),Mn(n)&&(n=xo.decode(n)),void 0===n&&(n=e?.nonWitnessUtxo),"string"==typeof o&&(o=br.decode(o)),void 0===o&&(o=e?.txid);let i,s={...e,...t,nonWitnessUtxo:n,txid:o};return void 0===s.nonWitnessUtxo&&delete s.nonWitnessUtxo,void 0===s.sequence&&(s.sequence=io),null===s.tapMerkleRoot&&delete s.tapMerkleRoot,s=Zo(No,s,e,r),jo.encode(s),s.nonWitnessUtxo&&void 0!==s.index?i=s.nonWitnessUtxo.outputs[s.index]:s.witnessUtxo&&(i=s.witnessUtxo),i&&!this.opts.disableScriptCheck&&Ko(i&&i.script,s.redeemScript,s.witnessScript),s}addInput(t,e=!1){if(!e&&!this.signStatus().addInput)throw new Error("Tx has signed inputs, cannot add new one");return this.inputs.push(this.normalizeInput(t)),this.inputs.length-1}updateInput(t,e,r=!1){let n;if(this.checkInputIdx(t),!r){const e=this.signStatus();e.addInput&&!e.inputs.includes(t)||(n=Ho)}this.inputs[t]=this.normalizeInput(e,this.inputs[t],n)}checkOutputIdx(t){if(!Number.isSafeInteger(t)||0>t||t>=this.outputs.length)throw new Error(`Wrong output index=${t}`)}getOutput(t){return this.checkOutputIdx(t),qn(this.outputs[t])}get outputsLength(){return this.outputs.length}normalizeOutput(t,e,r){let{amount:n,script:o}=t;if(void 0===n&&(n=e?.amount),"bigint"!=typeof n)throw new Error("amount must be bigint sats");"string"==typeof o&&(o=br.decode(o)),void 0===o&&(o=e?.script);let i={...e,...t,amount:n,script:o};if(void 0===i.amount&&delete i.amount,i=Zo($o,i,e,r),Mo.encode(i),i.script&&!this.opts.allowUnknownOutputs&&"unknown"===bi.decode(i.script).type)throw new Error("Transaction/output: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownScript=true, if you sure");return this.opts.disableScriptCheck||Ko(i.script,i.redeemScript,i.witnessScript),i}addOutput(t,e=!1){if(!e&&!this.signStatus().addOutput)throw new Error("Tx has signed outputs, cannot add new one");return this.outputs.push(this.normalizeOutput(t)),this.outputs.length-1}updateOutput(t,e,r=!1){let n;if(this.checkOutputIdx(t),!r){const e=this.signStatus();e.addOutput&&!e.outputs.includes(t)||(n=_o)}this.outputs[t]=this.normalizeOutput(e,this.outputs[t],n)}addOutputAddress(t,e,r=oo){return this.addOutput({script:bi.encode(Ai(r).decode(t)),amount:e})}get fee(){let t=0n;for(const e of this.inputs){const r=this.prevOut(e);if(!r)throw new Error("Empty input amount");t+=r.amount}const e=this.outputs.map(ki);for(const r of e)t-=r.amount;return t}preimageLegacy(t,e,r){const{isAny:n,isNone:o,isSingle:i}=Bi(r);if(t<0||!Number.isSafeInteger(t))throw new Error(`Invalid input idx=${t}`);if(i&&t>=this.outputs.length||t>=this.inputs.length)return mn.encode(1n);e=ho.encode(ho.decode(e).filter((t=>"CODESEPARATOR"!==t)));let s=this.inputs.map(Ui).map(((r,n)=>({...r,finalScriptSig:n===t?e:sn})));n?s=[s[t]]:(o||i)&&(s=s.map(((e,r)=>({...e,sequence:r===t?e.sequence:0}))));let a=this.outputs.map(ki);o?a=[]:i&&(a=a.slice(0,t).fill(Eo).concat([a[t]]));const c=xo.encode({lockTime:this.lockTime,version:this.version,segwitFlag:!1,inputs:s,outputs:a});return zn(c,Un.encode(r))}preimageWitnessV0(t,e,r,n){const{isAny:o,isNone:i,isSingle:s}=Bi(r);let a=so,c=so,h=so;const u=this.inputs.map(Ui),f=this.outputs.map(ki);o||(a=zn(...u.map(Jo.encode))),o||s||i||(c=zn(...u.map((t=>In.encode(t.sequence))))),s||i?s&&t<f.length&&(h=zn(bo.encode(f[t]))):h=zn(...f.map(bo.encode));const l=u[t];return zn(Un.encode(this.version),a,c,On(32,!0).encode(l.txid),In.encode(l.index),wo.encode(e),xn.encode(n),In.encode(l.sequence),h,In.encode(this.lockTime),In.encode(r))}preimageWitnessV1(t,e,r,n,o=-1,i,s=192,a){if(!Array.isArray(n)||this.inputs.length!==n.length)throw new Error(`Invalid amounts array=${n}`);if(!Array.isArray(e)||this.inputs.length!==e.length)throw new Error(`Invalid prevOutScript array=${e}`);const c=[kn.encode(0),kn.encode(r),Un.encode(this.version),In.encode(this.lockTime)],h=r===Si.DEFAULT?Si.ALL:3&r,u=r&Si.ANYONECANPAY,f=this.inputs.map(Ui),l=this.outputs.map(ki);u!==Si.ANYONECANPAY&&c.push(...[f.map(Jo.encode),n.map(xn.encode),e.map(wo.encode),f.map((t=>In.encode(t.sequence)))].map((t=>Wr(Vn(...t))))),h===Si.ALL&&c.push(Wr(Vn(...l.map(bo.encode))));const d=(a?1:0)|(i?2:0);if(c.push(new Uint8Array([d])),u===Si.ANYONECANPAY){const r=f[t];c.push(Jo.encode(r),xn.encode(n[t]),wo.encode(e[t]),In.encode(r.sequence))}else c.push(In.encode(t));return 1&d&&c.push(Wr(wo.encode(a||sn))),h===Si.SINGLE&&c.push(t<l.length?Wr(bo.encode(l[t])):so),i&&c.push(Pi(i,s),kn.encode(0),Un.encode(o)),Ge.utils.taggedHash("TapSighash",...c)}prevOut(t){if(t.nonWitnessUtxo){if(void 0===t.index)throw new Error("Unknown input index");return t.nonWitnessUtxo.outputs[t.index]}if(t.witnessUtxo)return t.witnessUtxo;throw new Error("Cannot find previous output info")}inputType(t){let e="legacy",r=Si.ALL;const n=this.prevOut(t),o=bi.decode(n.script);let i=o.type,s=o;const a=[o];if("tr"===o.type)return r=Si.DEFAULT,{txType:"taproot",type:"tr",last:o,lastScript:n.script,defaultSighash:r,sighash:t.sighashType||r};{if("wpkh"!==o.type&&"wsh"!==o.type||(e="segwit"),"sh"===o.type){if(!t.redeemScript)throw new Error("inputType: sh without redeemScript");let r=bi.decode(t.redeemScript);"wpkh"!==r.type&&"wsh"!==r.type||(e="segwit"),a.push(r),s=r,i+=`-${r.type}`}if("wsh"===s.type){if(!t.witnessScript)throw new Error("inputType: wsh without witnessScript");let r=bi.decode(t.witnessScript);"wsh"===r.type&&(e="segwit"),a.push(r),s=r,i+=`-${r.type}`}const n=a[a.length-1];if("sh"===n.type||"wsh"===n.type)throw new Error("inputType: sh/wsh cannot be terminal type");const c={type:i,txType:e,last:n,lastScript:bi.encode(n),defaultSighash:r,sighash:t.sighashType||r};if("legacy"===e&&!this.opts.allowLegacyWitnessUtxo&&!t.nonWitnessUtxo)throw new Error("Transaction/sign: legacy input without nonWitnessUtxo, can result in attack that forces paying higher fees. Pass allowLegacyWitnessUtxo=true, if you sure");return c}}signIdx(t,e,r,n){this.checkInputIdx(e);const o=this.inputs[e],i=this.inputType(o);if(!Mn(t)){if(!o.bip32Derivation||!o.bip32Derivation.length)throw new Error("bip32Derivation: empty");const r=o.bip32Derivation.filter((e=>e[1].fingerprint==t.fingerprint)).map((([e,{path:r}])=>{let n=t;for(const t of r)n=n.deriveChild(t);if(!cn(n.publicKey,e))throw new Error("bip32Derivation: wrong pubKey");if(!n.privateKey)throw new Error("bip32Derivation: no privateKey");return n}));if(!r.length)throw new Error(`bip32Derivation: no items with fingerprint=${t.fingerprint}`);let n=!1;for(const t of r)this.signIdx(t.privateKey,e)&&(n=!0);return n}r?r.forEach(Ii):r=[i.defaultSighash];const s=i.sighash;if(!r.includes(s))throw new Error(`Input with not allowed sigHash=${s}. Allowed: ${r.join(", ")}`);const{sigOutputs:a}=this.inputSighash(e);if(a===Si.SINGLE&&e>=this.outputs.length)throw new Error(`Input with sighash SINGLE, but there is no output with corresponding index=${e}`);const c=this.prevOut(o);if("taproot"===i.txType){if(o.tapBip32Derivation)throw new Error("tapBip32Derivation unsupported");const r=this.inputs.map(this.prevOut),i=r.map((t=>t.script)),a=r.map((t=>t.amount));let c=!1,h=Ge.getPublicKey(t),u=o.tapMerkleRoot||sn;if(o.tapInternalKey){const{pubKey:r,privKey:f}=function(t,e,r,n=sn){return cn(r,e)&&(t=function(t,e=new Uint8Array){const r=Ge.utils,n=r.bytesToNumberBE(t),o=Rn.fromPrivateKey(n),i=o.hasEvenY()?n:r.mod(-n,Kn),s=Jn(r.pointToBytes(o),e);return r.numberToBytesBE(r.mod(i+s,Kn),32)}(t,n),e=Ge.getPublicKey(t)),{privKey:t,pubKey:e}}(t,h,o.tapInternalKey,u),[l,d]=to(o.tapInternalKey,u);if(cn(l,r)){const t=this.preimageWitnessV1(e,i,s,a),r=Vn(Ge.sign(t,f,n),s!==Si.DEFAULT?new Uint8Array([s]):sn);this.updateInput(e,{tapKeySig:r},!0),c=!0}}if(o.tapLeafScript){o.tapScriptSig=o.tapScriptSig||[];for(const[r,u]of o.tapLeafScript){const r=u.subarray(0,-1),o=ho.decode(r),f=u[u.length-1],l=Pi(r,f);if(-1===o.findIndex((t=>Mn(t)&&cn(t,h))))continue;const d=this.preimageWitnessV1(e,i,s,a,void 0,r,f),p=Vn(Ge.sign(d,t,n),s!==Si.DEFAULT?new Uint8Array([s]):sn);this.updateInput(e,{tapScriptSig:[[{pubKey:h,leafHash:l},p]]},!0),c=!0}}if(!c)throw new Error("No taproot scripts signed");return!0}{const r=Fn(t);let n=!1;const o=Wn(r);for(const t of ho.decode(i.lastScript))Mn(t)&&(cn(t,r)||cn(t,o))&&(n=!0);if(!n)throw new Error(`Input script doesn't have pubKey: ${i.lastScript}`);let a;if("legacy"===i.txType)a=this.preimageLegacy(e,i.lastScript,s);else{if("segwit"!==i.txType)throw new Error(`Transaction/sign: unknown tx type: ${i.txType}`);{let t=i.lastScript;"wpkh"===i.last.type&&(t=bi.encode({type:"pkh",hash:i.last.hash})),a=this.preimageWitnessV0(e,t,s,c.amount)}}const h=function(t,e,r=!1){let n=Dn(t,e);if(r&&!Xn(n)){const r=new Uint8Array(32);for(let o=0;o<Number.MAX_SAFE_INTEGER&&(r.set(In.encode(o)),n=Dn(t,e,{extraEntropy:r}),!Xn(n));o++);}return n.toDERRawBytes()}(a,t,this.opts.lowR);this.updateInput(e,{partialSig:[[r,Vn(h,new Uint8Array([s]))]]},!0)}return!0}sign(t,e,r){let n=0;for(let o=0;o<this.inputs.length;o++)try{this.signIdx(t,o,e,r)&&n++}catch(t){}if(!n)throw new Error("No inputs signed");return n}finalizeIdx(t){if(this.checkInputIdx(t),this.fee<0n)throw new Error("Outputs spends more than inputs amount");const e=this.inputs[t],r=this.inputType(e);if("taproot"===r.txType){if(e.tapKeySig)e.finalScriptWitness=[e.tapKeySig];else{if(!e.tapLeafScript||!e.tapScriptSig)throw new Error("finalize/taproot: unknown input");{const t=e.tapLeafScript.sort(((t,e)=>vo.encode(t[0]).length-vo.encode(e[0]).length));for(const[r,n]of t){const t=n.slice(0,-1),o=n[n.length-1],i=bi.decode(t),s=Pi(t,o),a=e.tapScriptSig.filter((t=>cn(t[0].leafHash,s)));let c=[];if("tr_ms"===i.type){const t=i.m,e=i.pubkeys;let r=0;for(const n of e){const e=a.findIndex((t=>cn(t[0].pubKey,n)));r!==t&&-1!==e?(c.push(a[e][1]),r++):c.push(sn)}if(r!==t)continue}else if("tr_ns"===i.type){for(const t of i.pubkeys){const e=a.findIndex((e=>cn(e[0].pubKey,t)));-1!==e&&c.push(a[e][1])}if(c.length!==i.pubkeys.length)continue}else{if("unknown"!==i.type||!this.opts.allowUnknownInputs)throw new Error("Finalize: Unknown tapLeafScript");{const e=ho.decode(t);if(c=a.map((([{pubKey:t},r])=>{const n=e.findIndex((e=>Mn(e)&&cn(e,t)));if(-1===n)throw new Error("finalize/taproot: cannot find position of pubkey in script");return{signature:r,pos:n}})).sort(((t,e)=>t.pos-e.pos)).map((t=>t.signature)),!c.length)continue}}e.finalScriptWitness=c.reverse().concat([t,vo.encode(r)]);break}if(!e.finalScriptWitness)throw new Error("finalize/taproot: empty witness")}}return e.finalScriptSig=sn,void Ti(e)}if(!e.partialSig||!e.partialSig.length)throw new Error("Not enough partial sign");let n,o,i=sn,s=[];if("ms"===r.last.type){const t=r.last.m,n=r.last.pubkeys;let o=[];for(const t of n){const r=e.partialSig.find((e=>cn(t,e[0])));r&&o.push(r[1])}if(o=o.slice(0,t),o.length!==t)throw new Error(`Multisig: wrong signatures count, m=${t} n=${n.length} signatures=${o.length}`);i=ho.encode([0,...o])}else if("pk"===r.last.type)i=ho.encode([e.partialSig[0][1]]);else if("pkh"===r.last.type)i=ho.encode([e.partialSig[0][1],e.partialSig[0][0]]);else if("wpkh"===r.last.type)i=sn,s=[e.partialSig[0][1],e.partialSig[0][0]];else if("unknown"===r.last.type&&!this.opts.allowUnknownInputs)throw new Error("Unknown inputs not allowed");if(r.type.includes("wsh-")&&(i.length&&r.lastScript.length&&(s=ho.decode(i).map((t=>{if(0===t)return sn;if(Mn(t))return t;throw new Error(`Wrong witness op=${t}`)}))),s=s.concat(r.lastScript)),"segwit"===r.txType&&(o=s),r.type.startsWith("sh-wsh-")?n=ho.encode([ho.encode([0,Wr(r.lastScript)])]):r.type.startsWith("sh-")?n=ho.encode([...ho.decode(i),r.lastScript]):r.type.startsWith("wsh-")||"segwit"!==r.txType&&(n=i),!n&&!o)throw new Error("Unknown error finalizing input");n&&(e.finalScriptSig=n),o&&(e.finalScriptWitness=o),Ti(e)}finalize(){for(let t=0;t<this.inputs.length;t++)this.finalizeIdx(t)}extract(){if(!this.isFinal)throw new Error("Transaction has unfinalized inputs");if(!this.outputs.length)throw new Error("Transaction has no outputs");if(this.fee<0n)throw new Error("Outputs spends more than inputs amount");return this.toBytes(!0,!0)}combine(t){for(const e of["PSBTVersion","version","lockTime"])if(this.opts[e]!==t.opts[e])throw new Error(`Transaction/combine: different ${e} this=${this.opts[e]} other=${t.opts[e]}`);for(const e of["inputs","outputs"])if(this[e].length!==t[e].length)throw new Error(`Transaction/combine: different ${e} length this=${this[e].length} other=${t[e].length}`);if(!cn(this.global.unsignedTx?xo.encode(this.global.unsignedTx):sn,t.global.unsignedTx?xo.encode(t.global.unsignedTx):sn))throw new Error("Transaction/combine: different unsigned tx");this.global=Zo(Lo,this.global,t.global);for(let e=0;e<this.inputs.length;e++)this.updateInput(e,t.inputs[e],!0);for(let e=0;e<this.outputs.length;e++)this.updateOutput(e,t.outputs[e],!0);return this}clone(){return Ni.fromPSBT(this.toPSBT(2),this.opts)}}function Ci(t,e,r=oo){if("tr"===t)return wi(Ge.getPublicKey(e),void 0,r).address;const n=Fn(e);if("pkh"===t)return ri(n,r).address;if("wpkh"===t)return ci(n,r).address;throw new Error(`getAddress: unknown type=${t}`)}function Hi(t,e){let r=t;if("number"==typeof r){if(!Number.isInteger(r))throw new RangeError("Invalid value. Values of type 'number' must be an integer.");if(r>Number.MAX_SAFE_INTEGER)throw new RangeError(`Invalid value. Values of type 'number' must be less than or equal to ${Number.MAX_SAFE_INTEGER}. For larger values, try using a BigInt instead.`);return BigInt(r)}if("string"==typeof r)if(r.toLowerCase().startsWith("0x")){let t=r.slice(2);t=t.padStart(t.length+t.length%2,"0"),r=Ki(t)}else try{return BigInt(r)}catch(t){if(t instanceof SyntaxError)throw new RangeError(`Invalid value. String integer '${r}' is not finite.`)}if("bigint"==typeof r)return r;if(r instanceof Uint8Array){if(e){const t=function(t,e){return function(t,e){return t&BigInt(1)<<e}(t,e-BigInt(1))?t-(BigInt(1)<<e):t}(BigInt(`0x${Fi(r)}`),BigInt(8*r.byteLength));return BigInt(t.toString())}return BigInt(`0x${Fi(r)}`)}if(null!=r&&"object"==typeof r&&"BN"===r.constructor.name)return BigInt(r.toString());throw new TypeError("Invalid value type. Must be a number, bigint, integer-string, hex-string, or Uint8Array.")}function $i(t,e=8){return("bigint"==typeof t?t:Hi(t,!1)).toString(16).padStart(2*e,"0")}function _i(t){return parseInt(t,16)}function Ri(t,e=16){return Ki($i(t,e))}const Di=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Fi(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(const r of t)e+=Di[r];return e}function Ki(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);const e=t.length%2?`0${t}`:t,r=new Uint8Array(e.length/2);for(let t=0;t<r.length;t++){const n=2*t,o=e.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[t]=i}return r}function ji(t){return(new TextEncoder).encode(t)}function Mi(t){return(new TextDecoder).decode(t)}function Wi(t){return!Number.isInteger(t)||t<0||t>255}function zi(t){if(t.some(Wi))throw new Error("Some values are invalid bytes.");return new Uint8Array(t)}function Vi(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const o=t[e];r.set(o,n),n+=o.length}return r}function Gi(t){return Vi(...t.map((t=>"number"==typeof t?zi([t]):t instanceof Array?zi(t):t)))}function qi(t,e,r){t[r+3]=e,e>>>=8,t[r+2]=e,e>>>=8,t[r+1]=e,e>>>=8,t[r]=e}var Yi;!function(t){t[t.Testnet=2147483648]="Testnet",t[t.Mainnet=1]="Mainnet"}(Yi||(Yi={})),Yi.Mainnet;const Zi=128,Qi=128,Xi=16;var Ji,ts,es,rs,ns;(ns=Ji||(Ji={}))[ns.Address=0]="Address",ns[ns.Principal=1]="Principal",ns[ns.LengthPrefixedString=2]="LengthPrefixedString",ns[ns.MemoString=3]="MemoString",ns[ns.AssetInfo=4]="AssetInfo",ns[ns.PostCondition=5]="PostCondition",ns[ns.PublicKey=6]="PublicKey",ns[ns.LengthPrefixedList=7]="LengthPrefixedList",ns[ns.Payload=8]="Payload",ns[ns.MessageSignature=9]="MessageSignature",ns[ns.StructuredDataSignature=10]="StructuredDataSignature",ns[ns.TransactionAuthField=11]="TransactionAuthField",function(t){t[t.TokenTransfer=0]="TokenTransfer",t[t.SmartContract=1]="SmartContract",t[t.VersionedSmartContract=6]="VersionedSmartContract",t[t.ContractCall=2]="ContractCall",t[t.PoisonMicroblock=3]="PoisonMicroblock",t[t.Coinbase=4]="Coinbase",t[t.CoinbaseToAltRecipient=5]="CoinbaseToAltRecipient"}(ts||(ts={})),function(t){t[t.Clarity1=1]="Clarity1",t[t.Clarity2=2]="Clarity2"}(es||(es={})),function(t){t[t.OnChainOnly=1]="OnChainOnly",t[t.OffChainOnly=2]="OffChainOnly",t[t.Any=3]="Any"}(rs||(rs={}));var os,is,ss,as,cs,hs,us,fs,ls,ds,ps,ys,ws,gs,bs,Es,ms,xs,As;rs.OnChainOnly,rs.OffChainOnly,rs.Any,rs.OnChainOnly,rs.OnChainOnly,rs.OffChainOnly,rs.OffChainOnly,rs.Any,rs.Any,function(t){t[t.Mainnet=0]="Mainnet",t[t.Testnet=128]="Testnet"}(os||(os={})),os.Mainnet,function(t){t[t.Allow=1]="Allow",t[t.Deny=2]="Deny"}(is||(is={})),(As=ss||(ss={}))[As.STX=0]="STX",As[As.Fungible=1]="Fungible",As[As.NonFungible=2]="NonFungible",function(t){t[t.Standard=4]="Standard",t[t.Sponsored=5]="Sponsored"}(as||(as={})),(xs=cs||(cs={}))[xs.SerializeP2PKH=0]="SerializeP2PKH",xs[xs.SerializeP2SH=1]="SerializeP2SH",xs[xs.SerializeP2WPKH=2]="SerializeP2WPKH",xs[xs.SerializeP2WSH=3]="SerializeP2WSH",(ms=hs||(hs={}))[ms.MainnetSingleSig=22]="MainnetSingleSig",ms[ms.MainnetMultiSig=20]="MainnetMultiSig",ms[ms.TestnetSingleSig=26]="TestnetSingleSig",ms[ms.TestnetMultiSig=21]="TestnetMultiSig",(Es=us||(us={}))[Es.Compressed=0]="Compressed",Es[Es.Uncompressed=1]="Uncompressed",(bs=fs||(fs={}))[bs.Equal=1]="Equal",bs[bs.Greater=2]="Greater",bs[bs.GreaterEqual=3]="GreaterEqual",bs[bs.Less=4]="Less",bs[bs.LessEqual=5]="LessEqual",(gs=ls||(ls={}))[gs.Sends=16]="Sends",gs[gs.DoesNotSend=17]="DoesNotSend",(ws=ds||(ds={}))[ws.Origin=1]="Origin",ws[ws.Standard=2]="Standard",ws[ws.Contract=3]="Contract",function(t){t[t.STX=0]="STX",t[t.Fungible=1]="Fungible",t[t.NonFungible=2]="NonFungible"}(ps||(ps={})),function(t){t.Serialization="Serialization",t.Deserialization="Deserialization",t.SignatureValidation="SignatureValidation",t.FeeTooLow="FeeTooLow",t.BadNonce="BadNonce",t.NotEnoughFunds="NotEnoughFunds",t.NoSuchContract="NoSuchContract",t.NoSuchPublicFunction="NoSuchPublicFunction",t.BadFunctionArgument="BadFunctionArgument",t.ContractAlreadyExists="ContractAlreadyExists",t.PoisonMicroblocksDoNotConflict="PoisonMicroblocksDoNotConflict",t.PoisonMicroblockHasUnknownPubKeyHash="PoisonMicroblockHasUnknownPubKeyHash",t.PoisonMicroblockIsInvalid="PoisonMicroblockIsInvalid",t.BadAddressVersionByte="BadAddressVersionByte",t.NoCoinbaseViaMempool="NoCoinbaseViaMempool",t.ServerFailureNoSuchChainTip="ServerFailureNoSuchChainTip",t.ServerFailureDatabase="ServerFailureDatabase",t.ServerFailureOther="ServerFailureOther"}(ys||(ys={}));var Ss=o(870);function vs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Is(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const Bs={number:vs,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:Is,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");vs(t.outputLen),vs(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){Is(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}},Us=("object"==typeof self&&"crypto"in self&&self.crypto,t=>new DataView(t.buffer,t.byteOffset,t.byteLength)),Ts=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function ks(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new TypeError("utf8ToBytes expected string, got "+typeof t);return(new TextEncoder).encode(t)}(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));class Os{clone(){return this._cloneInto()}}function Ps(t){const e=e=>t().update(ks(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}class Ls extends Os{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Us(this.buffer)}update(t){Bs.exists(this);const{view:e,buffer:r,blockLen:n}=this,o=(t=ks(t)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=Us(t);for(;n<=o-i;i+=n)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Bs.exists(this),Bs.output(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let t=i;t<n;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,h=n?0:4;t.setUint32(e+c,s,n),t.setUint32(e+h,a,n)}(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=Us(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)s.setUint32(4*t,h[t],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return t.length=n,t.pos=s,t.finished=o,t.destroyed=i,n%e&&t.buffer.set(r),t}}const Ns=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Cs=Uint8Array.from({length:16},((t,e)=>e)),Hs=Cs.map((t=>(9*t+5)%16));let $s=[Cs],_s=[Hs];for(let t=0;t<4;t++)for(let e of[$s,_s])e.push(e[t].map((t=>Ns[t])));const Rs=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((t=>new Uint8Array(t))),Ds=$s.map(((t,e)=>t.map((t=>Rs[e][t])))),Fs=_s.map(((t,e)=>t.map((t=>Rs[e][t])))),Ks=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),js=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),Ms=(t,e)=>t<<e|t>>>32-e;function Ws(t,e,r,n){return 0===t?e^r^n:1===t?e&r|~e&n:2===t?(e|~r)^n:3===t?e&n|r&~n:e^(r|~n)}const zs=new Uint32Array(16);class Vs extends Ls{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:e,h2:r,h3:n,h4:o}=this;return[t,e,r,n,o]}set(t,e,r,n,o){this.h0=0|t,this.h1=0|e,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(t,e){for(let r=0;r<16;r++,e+=4)zs[r]=t.getUint32(e,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,a=s,c=0|this.h3,h=c,u=0|this.h4,f=u;for(let t=0;t<5;t++){const e=4-t,l=Ks[t],d=js[t],p=$s[t],y=_s[t],w=Ds[t],g=Fs[t];for(let e=0;e<16;e++){const n=Ms(r+Ws(t,o,s,c)+zs[p[e]]+l,w[e])+u|0;r=u,u=c,c=0|Ms(s,10),s=o,o=n}for(let t=0;t<16;t++){const r=Ms(n+Ws(e,i,a,h)+zs[y[t]]+d,g[t])+f|0;n=f,f=h,h=0|Ms(a,10),a=i,i=r}}this.set(this.h1+s+h|0,this.h2+c+f|0,this.h3+u+n|0,this.h4+r+i|0,this.h0+o+a|0)}roundClean(){zs.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const Gs=Ps((()=>new Vs)),qs=(t,e,r)=>t&e^t&r^e&r,Ys=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Zs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qs=new Uint32Array(64);class Xs extends Ls{constructor(){super(64,32,8,!1),this.A=0|Zs[0],this.B=0|Zs[1],this.C=0|Zs[2],this.D=0|Zs[3],this.E=0|Zs[4],this.F=0|Zs[5],this.G=0|Zs[6],this.H=0|Zs[7]}get(){const{A:t,B:e,C:r,D:n,E:o,F:i,G:s,H:a}=this;return[t,e,r,n,o,i,s,a]}set(t,e,r,n,o,i,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)Qs[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=Qs[t-15],r=Qs[t-2],n=Ts(e,7)^Ts(e,18)^e>>>3,o=Ts(r,17)^Ts(r,19)^r>>>10;Qs[t]=o+Qs[t-7]+n+Qs[t-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(Ts(s,6)^Ts(s,11)^Ts(s,25))+((u=s)&a^~u&c)+Ys[t]+Qs[t]|0,f=(Ts(r,2)^Ts(r,13)^Ts(r,22))+qs(r,n,o)|0;h=c,c=a,a=s,s=i+e|0,i=o,o=n,n=r,r=e+f|0}var u;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,n,o,i,s,a,c,h)}roundClean(){Qs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Js extends Xs{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ta=Ps((()=>new Xs)),ea=(Ps((()=>new Js)),BigInt(2**32-1)),ra=BigInt(32);function na(t,e=!1){return e?{h:Number(t&ea),l:Number(t>>ra&ea)}:{h:0|Number(t>>ra&ea),l:0|Number(t&ea)}}const oa=function(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:i,l:s}=na(t[o],e);[r[o],n[o]]=[i,s]}return[r,n]},ia=(t,e,r)=>t>>>r,sa=(t,e,r)=>t<<32-r|e>>>r,aa=(t,e,r)=>t>>>r|e<<32-r,ca=(t,e,r)=>t<<32-r|e>>>r,ha=(t,e,r)=>t<<64-r|e>>>r-32,ua=(t,e,r)=>t>>>r-32|e<<64-r,fa=function(t,e,r,n){const o=(e>>>0)+(n>>>0);return{h:t+r+(o/2**32|0)|0,l:0|o}},la=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),da=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,pa=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),ya=(t,e,r,n,o)=>e+r+n+o+(t/2**32|0)|0,wa=(t,e,r,n,o,i)=>e+r+n+o+i+(t/2**32|0)|0,ga=(t,e,r,n,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(o>>>0),[ba,Ea]=oa(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))),ma=new Uint32Array(80),xa=new Uint32Array(80);class Aa extends Ls{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:a,Eh:c,El:h,Fh:u,Fl:f,Gh:l,Gl:d,Hh:p,Hl:y}=this;return[t,e,r,n,o,i,s,a,c,h,u,f,l,d,p,y]}set(t,e,r,n,o,i,s,a,c,h,u,f,l,d,p,y){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|u,this.Fl=0|f,this.Gh=0|l,this.Gl=0|d,this.Hh=0|p,this.Hl=0|y}process(t,e){for(let r=0;r<16;r++,e+=4)ma[r]=t.getUint32(e),xa[r]=t.getUint32(e+=4);for(let t=16;t<80;t++){const e=0|ma[t-15],r=0|xa[t-15],n=aa(e,r,1)^aa(e,r,8)^ia(e,r,7),o=ca(e,r,1)^ca(e,r,8)^sa(e,r,7),i=0|ma[t-2],s=0|xa[t-2],a=aa(i,s,19)^ha(i,s,61)^ia(i,s,6),c=ca(i,s,19)^ua(i,s,61)^sa(i,s,6),h=pa(o,c,xa[t-7],xa[t-16]),u=ya(h,n,a,ma[t-7],ma[t-16]);ma[t]=0|u,xa[t]=0|h}let{Ah:r,Al:n,Bh:o,Bl:i,Ch:s,Cl:a,Dh:c,Dl:h,Eh:u,El:f,Fh:l,Fl:d,Gh:p,Gl:y,Hh:w,Hl:g}=this;for(let t=0;t<80;t++){const e=aa(u,f,14)^aa(u,f,18)^ha(u,f,41),b=ca(u,f,14)^ca(u,f,18)^ua(u,f,41),E=u&l^~u&p,m=ga(g,b,f&d^~f&y,Ea[t],xa[t]),x=wa(m,w,e,E,ba[t],ma[t]),A=0|m,S=aa(r,n,28)^ha(r,n,34)^ha(r,n,39),v=ca(r,n,28)^ua(r,n,34)^ua(r,n,39),I=r&o^r&s^o&s,B=n&i^n&a^i&a;w=0|p,g=0|y,p=0|l,y=0|d,l=0|u,d=0|f,({h:u,l:f}=fa(0|c,0|h,0|x,0|A)),c=0|s,h=0|a,s=0|o,a=0|i,o=0|r,i=0|n;const U=la(A,v,B);r=da(U,x,S,I),n=0|U}({h:r,l:n}=fa(0|this.Ah,0|this.Al,0|r,0|n)),({h:o,l:i}=fa(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:a}=fa(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:h}=fa(0|this.Dh,0|this.Dl,0|c,0|h)),({h:u,l:f}=fa(0|this.Eh,0|this.El,0|u,0|f)),({h:l,l:d}=fa(0|this.Fh,0|this.Fl,0|l,0|d)),({h:p,l:y}=fa(0|this.Gh,0|this.Gl,0|p,0|y)),({h:w,l:g}=fa(0|this.Hh,0|this.Hl,0|w,0|g)),this.set(r,n,o,i,s,a,c,h,u,f,l,d,p,y,w,g)}roundClean(){ma.fill(0),xa.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Sa extends Aa{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class va extends Aa{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Ia extends Aa{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}Ps((()=>new Aa)),Ps((()=>new Sa)),Ps((()=>new va)),Ps((()=>new Ia));var Ba=o(314),Ua=o.t(Ba,2);const Ta=BigInt(0),ka=BigInt(1),Oa=BigInt(2),Pa=BigInt(3),La=BigInt(8),Na=Object.freeze({a:Ta,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:ka,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),Ca=(t,e)=>(t+e/Oa)/e,Ha={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(t){const{n:e}=Na,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-ka*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,s=BigInt("0x100000000000000000000000000000000"),a=Ca(i*t,e),c=Ca(-n*t,e);let h=ac(t-a*r-c*o,e),u=ac(-a*n-c*i,e);const f=h>s,l=u>s;if(f&&(h=e-h),l&&(u=e-u),h>s||u>s)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:f,k1:h,k2neg:l,k2:u}}},$a=32,_a=32;function Ra(t){const{a:e,b:r}=Na,n=ac(t*t),o=ac(n*t);return ac(o+e*t+r)}const Da=Na.a===Ta;class Fa extends Error{constructor(t){super(t)}}function Ka(t){if(!(t instanceof ja))throw new TypeError("JacobianPoint expected")}class ja{constructor(t,e,r){this.x=t,this.y=e,this.z=r}static fromAffine(t){if(!(t instanceof za))throw new TypeError("JacobianPoint#fromAffine: expected Point");return t.equals(za.ZERO)?ja.ZERO:new ja(t.x,t.y,ka)}static toAffineBatch(t){const e=function(t,e=Na.P){const r=new Array(t.length),n=hc(t.reduce(((t,n,o)=>n===Ta?t:(r[o]=t,ac(t*n,e))),ka),e);return t.reduceRight(((t,n,o)=>n===Ta?t:(r[o]=ac(t*r[o],e),ac(t*n,e))),n),r}(t.map((t=>t.z)));return t.map(((t,r)=>t.toAffine(e[r])))}static normalizeZ(t){return ja.toAffineBatch(t).map(ja.fromAffine)}equals(t){Ka(t);const{x:e,y:r,z:n}=this,{x:o,y:i,z:s}=t,a=ac(n*n),c=ac(s*s),h=ac(e*c),u=ac(o*a),f=ac(ac(r*s)*c),l=ac(ac(i*n)*a);return h===u&&f===l}negate(){return new ja(this.x,ac(-this.y),this.z)}double(){const{x:t,y:e,z:r}=this,n=ac(t*t),o=ac(e*e),i=ac(o*o),s=t+o,a=ac(Oa*(ac(s*s)-n-i)),c=ac(Pa*n),h=ac(c*c),u=ac(h-Oa*a),f=ac(c*(a-u)-La*i),l=ac(Oa*e*r);return new ja(u,f,l)}add(t){Ka(t);const{x:e,y:r,z:n}=this,{x:o,y:i,z:s}=t;if(o===Ta||i===Ta)return this;if(e===Ta||r===Ta)return t;const a=ac(n*n),c=ac(s*s),h=ac(e*c),u=ac(o*a),f=ac(ac(r*s)*c),l=ac(ac(i*n)*a),d=ac(u-h),p=ac(l-f);if(d===Ta)return p===Ta?this.double():ja.ZERO;const y=ac(d*d),w=ac(d*y),g=ac(h*y),b=ac(p*p-w-Oa*g),E=ac(p*(g-b)-f*w),m=ac(n*s*d);return new ja(b,E,m)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=ja.ZERO;if("bigint"==typeof t&&t===Ta)return e;let r=sc(t);if(r===ka)return this;if(!Da){let t=e,n=this;for(;r>Ta;)r&ka&&(t=t.add(n)),n=n.double(),r>>=ka;return t}let{k1neg:n,k1:o,k2neg:i,k2:s}=Ha.splitScalar(r),a=e,c=e,h=this;for(;o>Ta||s>Ta;)o&ka&&(a=a.add(h)),s&ka&&(c=c.add(h)),h=h.double(),o>>=ka,s>>=ka;return n&&(a=a.negate()),i&&(c=c.negate()),c=new ja(ac(c.x*Ha.beta),c.y,c.z),a.add(c)}precomputeWindow(t){const e=Da?128/t+1:256/t+1,r=[];let n=this,o=n;for(let i=0;i<e;i++){o=n,r.push(o);for(let e=1;e<2**(t-1);e++)o=o.add(n),r.push(o);n=o.double()}return r}wNAF(t,e){!e&&this.equals(ja.BASE)&&(e=za.BASE);const r=e&&e._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=e&&Wa.get(e);n||(n=this.precomputeWindow(r),e&&1!==r&&(n=ja.normalizeZ(n),Wa.set(e,n)));let o=ja.ZERO,i=ja.BASE;const s=1+(Da?128/r:256/r),a=2**(r-1),c=BigInt(2**r-1),h=2**r,u=BigInt(r);for(let e=0;e<s;e++){const r=e*a;let s=Number(t&c);t>>=u,s>a&&(s-=h,t+=ka);const f=r,l=r+Math.abs(s)-1,d=e%2!=0,p=s<0;0===s?i=i.add(Ma(d,n[f])):o=o.add(Ma(p,n[l]))}return{p:o,f:i}}multiply(t,e){let r,n,o=sc(t);if(Da){const{k1neg:t,k1:i,k2neg:s,k2:a}=Ha.splitScalar(o);let{p:c,f:h}=this.wNAF(i,e),{p:u,f}=this.wNAF(a,e);c=Ma(t,c),u=Ma(s,u),u=new ja(ac(u.x*Ha.beta),u.y,u.z),r=c.add(u),n=h.add(f)}else{const{p:t,f:i}=this.wNAF(o,e);r=t,n=i}return ja.normalizeZ([r,n])[0]}toAffine(t){const{x:e,y:r,z:n}=this,o=this.equals(ja.ZERO);null==t&&(t=o?La:hc(n));const i=t,s=ac(i*i),a=ac(s*i),c=ac(e*s),h=ac(r*a),u=ac(n*i);if(o)return za.ZERO;if(u!==ka)throw new Error("invZ was invalid");return new za(c,h)}}function Ma(t,e){const r=e.negate();return t?r:e}ja.BASE=new ja(Na.Gx,Na.Gy,ka),ja.ZERO=new ja(Ta,ka,Ta);const Wa=new WeakMap;class za{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,Wa.delete(this)}hasEvenY(){return this.y%Oa===Ta}static fromCompressedHex(t){const e=32===t.length,r=oc(e?t:t.subarray(1));if(!dc(r))throw new Error("Point is not on curve");let n=function(t){const{P:e}=Na,r=BigInt(6),n=BigInt(11),o=BigInt(22),i=BigInt(23),s=BigInt(44),a=BigInt(88),c=t*t*t%e,h=c*c*t%e,u=cc(h,Pa)*h%e,f=cc(u,Pa)*h%e,l=cc(f,Oa)*c%e,d=cc(l,n)*l%e,p=cc(d,o)*d%e,y=cc(p,s)*p%e,w=cc(y,a)*y%e,g=cc(w,s)*p%e,b=cc(g,Pa)*h%e,E=cc(b,i)*d%e,m=cc(E,r)*c%e,x=cc(m,Oa);if(x*x%e!==t)throw new Error("Cannot find square root");return x}(Ra(r));const o=(n&ka)===ka;e?o&&(n=ac(-n)):1==(1&t[0])!==o&&(n=ac(-n));const i=new za(r,n);return i.assertValidity(),i}static fromUncompressedHex(t){const e=oc(t.subarray(1,33)),r=oc(t.subarray(33,65)),n=new za(e,r);return n.assertValidity(),n}static fromHex(t){const e=ic(t),r=e.length,n=e[0];if(r===$a)return this.fromCompressedHex(e);if(33===r&&(2===n||3===n))return this.fromCompressedHex(e);if(65===r&&4===n)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${r}`)}static fromPrivateKey(t){return za.BASE.multiply(pc(t))}static fromSignature(t,e,r){const{r:n,s:o}=function(t){if(t instanceof qa)return t.assertValidity(),t;try{return qa.fromDER(t)}catch(e){return qa.fromCompact(t)}}(e);if(![0,1,2,3].includes(r))throw new Error("Cannot recover: invalid recovery bit");const i=function(t,e=!1){const r=function(t){const e=8*t.length-256,r=oc(t);return e>0?r>>BigInt(e):r}(t);if(e)return r;const{n}=Na;return r>=n?r-n:r}(ic(t)),{n:s}=Na,a=2===r||3===r?n+s:n,c=hc(a,s),h=ac(-i*c,s),u=ac(o*c,s),f=1&r?"03":"02",l=za.fromHex(f+Ja(a)),d=za.BASE.multiplyAndAddUnsafe(l,h,u);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(t=!1){return nc(this.toHex(t))}toHex(t=!1){const e=Ja(this.x);return t?`${this.hasEvenY()?"02":"03"}${e}`:`04${e}${Ja(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:r}=this;if(!dc(e)||!dc(r))throw new Error(t);const n=ac(r*r);if(ac(n-Ra(e))!==Ta)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new za(this.x,ac(-this.y))}double(){return ja.fromAffine(this).double().toAffine()}add(t){return ja.fromAffine(this).add(ja.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return ja.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,r){const n=ja.fromAffine(this),o=e===Ta||e===ka||this!==za.BASE?n.multiplyUnsafe(e):n.multiply(e),i=ja.fromAffine(t).multiplyUnsafe(r),s=o.add(i);return s.equals(ja.ZERO)?void 0:s.toAffine()}}function Va(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function Ga(t){if(t.length<2||2!==t[0])throw new Error(`Invalid signature integer tag: ${Qa(t)}`);const e=t[1],r=t.subarray(2,e+2);if(!e||r.length!==e)throw new Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:oc(r),left:t.subarray(e+2)}}za.BASE=new za(Na.Gx,Na.Gy),za.ZERO=new za(Ta,Ta);class qa{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=t instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof t&&!e)throw new TypeError(`${r}: Expected string or Uint8Array`);const n=e?Qa(t):t;if(128!==n.length)throw new Error(`${r}: Expected 64-byte hex`);return new qa(rc(n.slice(0,64)),rc(n.slice(64,128)))}static fromDER(t){const e=t instanceof Uint8Array;if("string"!=typeof t&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r,s:n}=function(t){if(t.length<2||48!=t[0])throw new Error(`Invalid signature tag: ${Qa(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:r}=Ga(t.subarray(2)),{data:n,left:o}=Ga(r);if(o.length)throw new Error(`Invalid signature: left bytes after parsing: ${Qa(o)}`);return{r:e,s:n}}(e?t:nc(t));return new qa(r,n)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!lc(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!lc(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=Na.n>>ka;return this.s>t}normalizeS(){return this.hasHighS()?new qa(this.r,ac(-this.s,Na.n)):this}toDERRawBytes(){return nc(this.toDERHex())}toDERHex(){const t=Va(ec(this.s)),e=Va(ec(this.r)),r=t.length/2,n=e.length/2,o=ec(r),i=ec(n);return`30${ec(n+r+4)}02${i}${e}02${o}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return nc(this.toCompactHex())}toCompactHex(){return Ja(this.r)+Ja(this.s)}}function Ya(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const o=t[e];r.set(o,n),n+=o.length}return r}const Za=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Qa(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let r=0;r<t.length;r++)e+=Za[t[r]];return e}const Xa=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Ja(t){if("bigint"!=typeof t)throw new Error("Expected bigint");if(!(Ta<=t&&t<Xa))throw new Error("Expected number 0 <= n < 2^256");return t.toString(16).padStart(64,"0")}function tc(t){const e=nc(Ja(t));if(32!==e.length)throw new Error("Error: expected 32 bytes");return e}function ec(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function rc(t){if("string"!=typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function nc(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){const n=2*r,o=t.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[r]=i}return e}function oc(t){return rc(Qa(t))}function ic(t){return t instanceof Uint8Array?Uint8Array.from(t):nc(t)}function sc(t){if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if("bigint"==typeof t&&lc(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function ac(t,e=Na.P){const r=t%e;return r>=Ta?r:e+r}function cc(t,e){const{P:r}=Na;let n=t;for(;e-- >Ta;)n*=n,n%=r;return n}function hc(t,e=Na.P){if(t===Ta||e<=Ta)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=ac(t,e),n=e,o=Ta,i=ka,s=ka,a=Ta;for(;r!==Ta;){const t=n/r,e=n%r,c=o-s*t,h=i-a*t;n=r,r=e,o=s,i=a,s=c,a=h}if(n!==ka)throw new Error("invert: does not exist");return ac(o,e)}let uc,fc;function lc(t){return Ta<t&&t<Na.n}function dc(t){return Ta<t&&t<Na.P}function pc(t){let e;if("bigint"==typeof t)e=t;else if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if("string"==typeof t){if(64!==t.length)throw new Error("Expected 32 bytes of private key");e=rc(t)}else{if(!(t instanceof Uint8Array))throw new TypeError("Expected valid private key");if(t.length!==_a)throw new Error("Expected 32 bytes of private key");e=oc(t)}if(!lc(e))throw new Error("Expected private key: 0 < key < n");return e}za.BASE._setWindowSize(8);const yc={node:Ua,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},wc={},gc={bytesToHex:Qa,hexToBytes:nc,concatBytes:Ya,mod:ac,invert:hc,isValidPrivateKey(t){try{return pc(t),!0}catch(t){return!1}},_bigintTo32Bytes:tc,_normalizePrivateKey:pc,hashToPrivateKey:t=>{if((t=ic(t)).length<40||t.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");return tc(ac(oc(t),Na.n-ka)+ka)},randomBytes:(t=32)=>{if(yc.web)return yc.web.getRandomValues(new Uint8Array(t));if(yc.node){const{randomBytes:e}=yc.node;return Uint8Array.from(e(t))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>gc.hashToPrivateKey(gc.randomBytes(40)),precompute(t=8,e=za.BASE){const r=e===za.BASE?e:new za(e.x,e.y);return r._setWindowSize(t),r.multiply(Pa),r},sha256:async(...t)=>{if(yc.web){const e=await yc.web.subtle.digest("SHA-256",Ya(...t));return new Uint8Array(e)}if(yc.node){const{createHash:e}=yc.node,r=e("sha256");return t.forEach((t=>r.update(t))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(yc.web){const r=await yc.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Ya(...e),o=await yc.web.subtle.sign("HMAC",r,n);return new Uint8Array(o)}if(yc.node){const{createHmac:r}=yc.node,n=r("sha256",t);return e.forEach((t=>n.update(t))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let r=wc[t];if(void 0===r){const e=await gc.sha256(Uint8Array.from(t,(t=>t.charCodeAt(0))));r=Ya(e,e),wc[t]=r}return gc.sha256(r,...e)},taggedHashSync:(t,...e)=>{if("function"!=typeof uc)throw new Fa("sha256Sync is undefined, you need to set it");let r=wc[t];if(void 0===r){const e=uc(Uint8Array.from(t,(t=>t.charCodeAt(0))));r=Ya(e,e),wc[t]=r}return uc(r,...e)},_JacobianPoint:ja};Object.defineProperties(gc,{sha256Sync:{configurable:!1,get:()=>uc,set(t){uc||(uc=t)}},hmacSha256Sync:{configurable:!1,get:()=>fc,set(t){fc||(fc=t)}}}),o(907);const bc=(t,e)=>!!t&&ji(t).length>e,Ec=t=>Fi((t=>Gs(ta(t)))(t));function mc(t,e,r){const n=e||1,o=r||Zi;if(bc(t,o))throw new Error(`String length exceeds maximum bytes ${o}`);return{type:Ji.LengthPrefixedString,content:t,lengthPrefixBytes:n,maxLengthBytes:o}}function xc(t){const e=(0,Ss.yI)(t);return{type:Ji.Address,version:e[0],hash160:e[1]}}function Ac(t){const e=[];return e.push(Ki($i(t.version,1))),e.push(Ki(t.hash160)),Gi(e)}function Sc(t){const e=_i(Fi(t.readBytes(1))),r=Fi(t.readBytes(20));return{type:Ji.Address,version:e,hash160:r}}function vc(t){const e=[],r=ji(t.content),n=r.byteLength;return e.push(Ki($i(n,t.lengthPrefixBytes))),e.push(r),Gi(e)}function Ic(t,e,r){e=e||1;const n=_i(Fi(t.readBytes(e)));return mc(Mi(t.readBytes(n)),e,r??128)}var Bc,Uc;(Uc=Bc||(Bc={}))[Uc.Int=0]="Int",Uc[Uc.UInt=1]="UInt",Uc[Uc.Buffer=2]="Buffer",Uc[Uc.BoolTrue=3]="BoolTrue",Uc[Uc.BoolFalse=4]="BoolFalse",Uc[Uc.PrincipalStandard=5]="PrincipalStandard",Uc[Uc.PrincipalContract=6]="PrincipalContract",Uc[Uc.ResponseOk=7]="ResponseOk",Uc[Uc.ResponseErr=8]="ResponseErr",Uc[Uc.OptionalNone=9]="OptionalNone",Uc[Uc.OptionalSome=10]="OptionalSome",Uc[Uc.List=11]="List",Uc[Uc.Tuple=12]="Tuple",Uc[Uc.StringASCII=13]="StringASCII",Uc[Uc.StringUTF8=14]="StringUTF8";class Tc extends Error{constructor(t){super(t),this.message=t,this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class kc extends Tc{constructor(t){super(t)}}class Oc extends Tc{constructor(t){super(t)}}function Pc(t,e){return Gi([t,e])}function Lc(t,e){const r=[],n="ascii"==e?function(t){const e=[];for(let r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return new Uint8Array(e)}(t.data):ji(t.data),o=new Uint8Array(4);return qi(o,n.length,0),r.push(o),r.push(n),Pc(t.type,Gi(r))}function Nc(t){switch(t.type){case Bc.BoolTrue:case Bc.BoolFalse:return function(t){return new Uint8Array([t.type])}(t);case Bc.OptionalNone:case Bc.OptionalSome:return(e=t).type===Bc.OptionalNone?new Uint8Array([e.type]):Pc(e.type,Nc(e.value));case Bc.Buffer:return function(t){const e=new Uint8Array(4);return qi(e,t.buffer.length,0),Pc(t.type,Vi(e,t.buffer))}(t);case Bc.UInt:return function(t){const e=Ri(t.value,Xi);return Pc(t.type,e)}(t);case Bc.Int:return function(t){const e=Ri(function(t,e){if(t<-(BigInt(1)<<e-BigInt(1))||(BigInt(1)<<e-BigInt(1))-BigInt(1)<t)throw`Unable to represent integer in width: ${e}`;return t>=BigInt(0)?BigInt(t):t+(BigInt(1)<<e)}(t.value,BigInt(Qi)),Xi);return Pc(t.type,e)}(t);case Bc.PrincipalStandard:return function(t){return Pc(t.type,Ac(t.address))}(t);case Bc.PrincipalContract:return function(t){return Pc(t.type,Vi(Ac(t.address),vc(t.contractName)))}(t);case Bc.ResponseOk:case Bc.ResponseErr:return function(t){return Pc(t.type,Nc(t.value))}(t);case Bc.List:return function(t){const e=[],r=new Uint8Array(4);qi(r,t.list.length,0),e.push(r);for(const r of t.list){const t=Nc(r);e.push(t)}return Pc(t.type,Gi(e))}(t);case Bc.Tuple:return function(t){const e=[],r=new Uint8Array(4);qi(r,Object.keys(t.data).length,0),e.push(r);const n=Object.keys(t.data).sort(((t,e)=>t.localeCompare(e)));for(const r of n){const n=mc(r);e.push(vc(n));const o=Nc(t.data[r]);e.push(o)}return Pc(t.type,Gi(e))}(t);case Bc.StringASCII:return function(t){return Lc(t,"ascii")}(t);case Bc.StringUTF8:return function(t){return Lc(t,"utf8")}(t);default:throw new kc("Unable to serialize. Invalid Clarity Value.")}var e}class Cc extends Os{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Bs.hash(t);const r=ks(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let t=0;t<o.length;t++)o[t]^=54;this.iHash.update(o),this.oHash=t.create();for(let t=0;t<o.length;t++)o[t]^=106;this.oHash.update(o),o.fill(0)}update(t){return Bs.exists(this),this.iHash.update(t),this}digestInto(t){Bs.exists(this),Bs.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return t.finished=n,t.destroyed=o,t.blockLen=i,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Hc=(t,e,r)=>new Cc(t,e).update(r).digest();function $c(t){const e="string"==typeof t?Ki(t):t;if(32!=e.length&&33!=e.length)throw new Error(`Improperly formatted private-key. Private-key byte length should be 32 or 33. Length provided: ${e.length}`);if(33==e.length&&1!==e[32])throw new Error("Improperly formatted private-key. 33 bytes indicate compressed key, but the last byte must be == 01");return e}var _c,Rc;Hc.create=(t,e)=>new Cc(t,e),function(t){t[t.Testnet=2147483648]="Testnet",t[t.Mainnet=1]="Mainnet"}(_c||(_c={})),function(t){t[t.Mainnet=0]="Mainnet",t[t.Testnet=128]="Testnet"}(Rc||(Rc={}));const Dc=33;function Fc(t,e=os.Mainnet){return function(t,e=os.Mainnet){t="string"==typeof t?t:Fi(t);const r=function(t,e){switch(t){case cs.SerializeP2PKH:switch(e){case os.Mainnet:return hs.MainnetSingleSig;case os.Testnet:return hs.TestnetSingleSig;default:throw new Error(`Unexpected txVersion ${JSON.stringify(e)} for hashMode ${t}`)}case cs.SerializeP2SH:case cs.SerializeP2WPKH:case cs.SerializeP2WSH:switch(e){case os.Mainnet:return hs.MainnetMultiSig;case os.Testnet:return hs.TestnetMultiSig;default:throw new Error(`Unexpected txVersion ${JSON.stringify(e)} for hashMode ${t}`)}default:throw new Error(`Unexpected hashMode ${JSON.stringify(t)}`)}}(cs.SerializeP2PKH,e);var n,o,i;return i=(n=r,o=Ec(Ki(t)),{type:Ji.Address,version:n,hash160:o}),(0,Ss.H4)(i.version,i.hash160)}(function(t){const e=function(t){const e=$c(t);return{data:e,compressed:e.length==Dc}}(t),r=function(t,e=!1){return za.fromPrivateKey(t).toRawBytes(e)}(e.data.slice(0,32),e.compressed);return n=Fi(r),{type:Ji.PublicKey,data:Ki(n)};var n}(t).data,e)}gc.hmacSha256Sync=(t,...e)=>{const r=Hc.create(ta,t);return e.forEach((t=>r.update(t))),r.digest()};var Kc=o(102),jc=o.n(Kc);function Mc(t,e=8){return("bigint"==typeof t?t:function(t,e){let r=t;if("number"==typeof r){if(!Number.isInteger(r))throw new RangeError("Invalid value. Values of type 'number' must be an integer.");if(r>Number.MAX_SAFE_INTEGER)throw new RangeError(`Invalid value. Values of type 'number' must be less than or equal to ${Number.MAX_SAFE_INTEGER}. For larger values, try using a BigInt instead.`);return BigInt(r)}if("string"==typeof r)if(r.toLowerCase().startsWith("0x")){let t=r.slice(2);t=t.padStart(t.length+t.length%2,"0"),r=Vc(t)}else try{return BigInt(r)}catch(t){if(t instanceof SyntaxError)throw new RangeError(`Invalid value. String integer '${r}' is not finite.`)}if("bigint"==typeof r)return r;if(r instanceof Uint8Array){if(e){const t=function(t,e){return function(t,e){return t&BigInt(1)<<e}(t,e-BigInt(1))?t-(BigInt(1)<<e):t}(BigInt(`0x${zc(r)}`),BigInt(8*r.byteLength));return BigInt(t.toString())}return BigInt(`0x${zc(r)}`)}if(null!=r&&"object"==typeof r&&"BN"===r.constructor.name)return BigInt(r.toString());throw new TypeError("Invalid value type. Must be a number, bigint, integer-string, hex-string, or Uint8Array.")}(t,!1)).toString(16).padStart(2*e,"0")}const Wc=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function zc(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(const r of t)e+=Wc[r];return e}function Vc(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);const e=t.length%2?`0${t}`:t,r=new Uint8Array(e.length/2);for(let t=0;t<r.length;t++){const n=2*t,o=e.slice(n,n+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[t]=i}return r}function Gc(t){return(new TextEncoder).encode(t)}function qc(t){const e=[];for(let r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return new Uint8Array(e)}function Yc(t,e){if(ji(e.content).byteLength>=128)throw new Error("Contract name must be less than 128 bytes");return{type:Bc.PrincipalContract,address:t,contractName:e}}o(22),gc.hmacSha256Sync=(t,...e)=>{const r=Hc.create(ta,t);return e.forEach((t=>r.update(t))),r.digest()};const Zc=BigInt("0xffffffffffffffffffffffffffffffff"),Qc=BigInt(0),Xc=BigInt("0x7fffffffffffffffffffffffffffffff"),Jc=BigInt("-170141183460469231731687303715884105728");const th=new Map;function eh(t,e){const r=th.get(t);if(void 0!==r)return r(e);const n=function(t){const e=Object.values(t).filter((t=>"number"==typeof t)),r=new Set(e);return t=>r.has(t)}(t);return th.set(t,n),eh(t,e)}class rh{constructor(t){this.consumed=0,this.source=t}readBytes(t){const e=this.source.subarray(this.consumed,this.consumed+t);return this.consumed+=t,e}readUInt32BE(){return(t=this.readBytes(4))[0]*2**24+65536*t[1]+256*t[2]+t[3];var t}readUInt8(){return this.readBytes(1)[0]}readUInt16BE(){return((t=this.readBytes(2))[0+0]<<8|t[1])>>>0;var t}readBigUIntLE(t){const e=Fi(this.readBytes(t).slice().reverse());return BigInt(`0x${e}`)}readBigUIntBE(t){const e=Fi(this.readBytes(t));return BigInt(`0x${e}`)}get readOffset(){return this.consumed}set readOffset(t){this.consumed=t}get internalBytes(){return this.source}readUInt8Enum(t,e){const r=this.readUInt8();if(eh(t,r))return r;throw e(r)}}const nh=function(t,e){return Yc(xc(t),mc(e))},oh=function(t){const e=xc(t);return{type:Bc.PrincipalStandard,address:e}},ih=function t(e){let r;if("string"==typeof e){const t="0x"===e.slice(0,2).toLowerCase();r=new rh(Ki(t?e.slice(2):e))}else r=e instanceof Uint8Array?new rh(e):e;switch(r.readUInt8Enum(Bc,(t=>{throw new Oc(`Cannot recognize Clarity Type: ${t}`)}))){case Bc.Int:return(t=>{const e=Hi(t,!0);if(e>Xc)throw new RangeError(`Cannot construct clarity integer from value greater than ${Xc}`);if(e<Jc)throw new RangeError(`Cannot construct clarity integer form value less than ${Jc}`);return{type:Bc.Int,value:e}})(r.readBytes(16));case Bc.UInt:return(t=>{const e=Hi(t,!1);if(e<Qc)throw new RangeError("Cannot construct unsigned clarity integer from negative value");if(e>Zc)throw new RangeError(`Cannot construct unsigned clarity integer greater than ${Zc}`);return{type:Bc.UInt,value:e}})(r.readBytes(16));case Bc.Buffer:const e=r.readUInt32BE();return(t=>{if(t.length>1e6)throw new Error("Cannot construct clarity buffer that is greater than 1MB");return{type:Bc.Buffer,buffer:t}})(r.readBytes(e));case Bc.BoolTrue:return{type:Bc.BoolTrue};case Bc.BoolFalse:return{type:Bc.BoolFalse};case Bc.PrincipalStandard:return a=Sc(r),{type:Bc.PrincipalStandard,address:a};case Bc.PrincipalContract:return Yc(Sc(r),Ic(r));case Bc.ResponseOk:return s=t(r),{type:Bc.ResponseOk,value:s};case Bc.ResponseErr:return function(t){return{type:Bc.ResponseErr,value:t}}(t(r));case Bc.OptionalNone:return{type:Bc.OptionalNone};case Bc.OptionalSome:return function(t){return{type:Bc.OptionalSome,value:t}}(t(r));case Bc.List:const c=r.readUInt32BE(),h=[];for(let e=0;e<c;e++)h.push(t(r));return i=h,{type:Bc.List,list:i};case Bc.Tuple:const u=r.readUInt32BE(),f={};for(let e=0;e<u;e++){const e=Ic(r).content;if(void 0===e)throw new Oc('"content" is undefined');f[e]=t(r)}return function(t){for(const r in t)if(!(/^[a-zA-Z]([a-zA-Z0-9]|[-_!?+<>=/*])*$|^[-+=/*]$|^[<>]=?$/.test(e=r)&&e.length<128))throw new Error(`"${r}" is not a valid Clarity name`);var e;return{type:Bc.Tuple,data:t}}(f);case Bc.StringASCII:const l=r.readUInt32BE(),d=(o=r.readBytes(l),String.fromCharCode.apply(null,o));return n=d,{type:Bc.StringASCII,data:n};case Bc.StringUTF8:const p=r.readUInt32BE();return(t=>({type:Bc.StringUTF8,data:t}))(Mi(r.readBytes(p)));default:throw new Oc("Unable to deserialize Clarity Value from Uint8Array. Could not find valid Clarity Type.")}var n,o,i,s,a},sh="--TODO--",ah="bcrt1pte5zmd7qzj4hdu45lh9mmdm0nwq3z35pwnxmzkwld6y0a8g83nnqhj6vc0",ch="ST3ACFZ2XKFPKAFD9YY92ZP0Y4QN6MTX3H20C27NY.asset",hh="ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.asset";var uh=(t=>(t.Mainnet="X2",t.Testnet="T2",t.Regtest="id",t))(uh||{}),fh=(t=>(t.PegIn="3C",t.PegOut="3E",t))(fh||{});const lh={...oo,bip32:{public:76067358,private:76066276},bip84:{coin:0},magicBytes:"X2"},dh={bech32:"tb",pubKeyHash:111,scriptHash:196,wif:239,bip32:{public:70617039,private:70615956},bip84:{coin:1},magicBytes:"T2"},ph={...dh,bech32:"bcrt",magicBytes:"id"},yh=10,wh=68,gh=hn;function bh(t){const[e,r]=t.split("."),[n,o]=(0,Ss.yI)(e),i=Vc(n.toString(16)),s=Vc(o),a=Eh(r,Gc);return gh(i,s,a)}function Eh(t,e=Gc,r=40,n=1){if(!t)return new Uint8Array(0);const o=e(t);if(r>=0&&o.byteLength>r)throw new RangeError(`Content byteLength exceeds maximum length of ${r}`);const i=Vc(Mc(o.byteLength,n));if(i.byteLength>n)throw new RangeError(`Prefix byteLength exceeds maximum length of ${n}`);return gh(i,o)}async function mh({tx:t,feeRate:e,utxos:r,utxoToSpendable:n}){const o=[];for(let e=0;e<t.outputsLength;e++)o.push(t.getOutput(e));return await kh({feeRate:e,utxos:r,utxoToSpendable:n,outputs:o})}function xh(t,e){return yh+t.map(Ah).reduce(Ih,0)+e.map(Sh).reduce(Ih,0)}function Ah(t){const e=new Ni({allowUnknownInputs:!0}),r=e.vsize;return e.addInput(t),e.vsize-r}function Sh(t){const e=new Ni({allowUnknownOutputs:!0}),r=e.vsize;return e.addOutput(t),e.vsize-r}function vh(t,e){return Math.ceil(t*e)}const Ih=(t,e)=>t+e,Bh={wpkh:Uh};function Uh(t){if(!t.output?.script)throw new Error("No script found on utxo tx");const e={txid:Vc(t.utxo.txid),index:t.utxo.vout,...t.output,witnessUtxo:{script:t.output.script,amount:BigInt(t.utxo.value)}};return(new Ni).addInput(e),{input:e,vsize:wh}}function Th(t,e,r){if(!r.output?.script)throw new Error("No script found on utxo tx");let n;for(let o=0;o<10;o++)try{if(0===o?n=oi(ci(Vc(e)),t):1===o?n=oi(si(ci(Vc(e))),t):2===o?n=oi(si(ri(Vc(e)),t)):3===o?n=oi(ui(1,[Vc(e)]),t):4===o?n=oi(ri(Vc(e)),t):5===o?n=oi(oi(ri(Vc(e)),t)):6===o&&(n=oi(oi(ci(Vc(e)),t))),!n)throw new Error("No valid p2sh variant found.");if(o<3){const t={txid:Vc(r.utxo.txid),index:r.utxo.vout,witnessUtxo:{script:n.script,amount:BigInt(r.utxo.value)},redeemScript:n.redeemScript};return(new Ni).addInput(t),{input:t,vsize:wh+(n.script?.byteLength??0)}}const i={txid:Vc(r.utxo.txid),index:r.utxo.vout,nonWitnessUtxo:r.txHex,redeemScript:n.redeemScript};return(new Ni).addInput(i),{input:i,vsize:n.script?.byteLength??0}}catch(t){}throw new Error("No valid p2sh variant found.")}async function kh({feeRate:t,utxos:e,utxoToSpendable:r,outputs:n}){const o=n.reduce(((t,e)=>t+(e.amount??0n)),0n),i=[];let s=0n,a=xh([],n);for(const n of e)try{const{input:e,vsize:c}=await Oh(n,r),h=c??Ah(e);if(t*h>n.value)continue;i.push(e),s+=BigInt(n.value),a+=h;const u=t*a;if(s>=o+BigInt(Math.ceil(u)))return{inputs:i,totalSats:s,changeSats:s-(o+BigInt(Math.ceil(u)))}}catch(t){console.warn(`Failed to make UTXO spendable; txid: ${n.txid}\n`,t);continue}throw new Error("Not enough funds")}async function Oh(t,e){const r=await t.tx,n=Ni.fromRaw(Vc(r),{allowUnknownOutputs:!0,allowUnknownInputs:!0}),o=n.getOutput(t.vout);if(!o?.script)throw new Error("No script found on utxo tx");const i=bi.decode(o.script);try{const s=e[i.type];if(!s)throw new Error(`Unsupported script type: ${i.type}`);return await s({tx:n,txHex:r,utxo:t,output:o,spendScript:i})}catch(e){throw new Error(`Failed to make utxo spendable. ${JSON.stringify(t)}`,{cause:e})}}function Ph(t,e,r){return new Proxy(t,{get:(t,n)=>(n===e&&void 0===t[n]&&(t[n]=Promise.resolve(r()).catch((e=>{throw delete t[n],e}))),t[n]),has:(t,r)=>r===e||r in t})}class Lh{constructor(t){this.config=t}async fetchUtxos(t){return fetch(`${this.config.bitcoinElectrsApiUrl}/address/${t}/utxo`).then((t=>t.json())).then((t=>t.sort(((t,e)=>t.status.block_height-e.status.block_height)))).then((t=>t.map((t=>Ph(t,"tx",(()=>this.fetchTxHex(t.txid)))))))}async fetchTxHex(t){return fetch(`${this.config.bitcoinElectrsApiUrl}/tx/${t}/hex`).then((t=>t.text()))}async estimateFeeRates(){return fetch(`${this.config.bitcoinElectrsApiUrl}/fee-estimates`).then((t=>t.json()))}async estimateFeeRate(t){const e=await this.estimateFeeRates(),r="number"==typeof t?t.toString():"high"===t?"1":"medium"===t?"2":"3";if(r in e)return e[r];throw new Error(`Invalid fee target: ${t}`)}async broadcastTx(t){return await fetch(`${this.config.bitcoinElectrsApiUrl}/tx`,{method:"POST",body:t.hex}).then((t=>t.text()))}async stacksCallReadOnly({contractAddress:t,functionName:e,sender:r="ST000000000000000000002AMW42H",args:n=[]}){return t=t.replace(".","/"),await fetch(`${this.config.stacksApiUrl}/v2/contracts/call-read/${t}/${encodeURIComponent(e)}`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sender:r,arguments:n.map(Nc).map(zc)})}).then((t=>t.json())).then((t=>ih(t.result)))}async getBalance(t){const e=await fetch(`${this.config.bitcoinElectrsApiUrl}/address/${t}`).then((t=>t.json()));return e.chain_stats.funded_txo_sum-e.chain_stats.spent_txo_sum}async getSbtcBalance({holderAddress:t,sbtcContract:e}){const[r,n]=t.split("."),o=await this.stacksCallReadOnly({contractAddress:e,functionName:"get-balance",args:[n?nh(r,n):oh(r)]});return o?.value?.value??0}async getBitcoinAccount(t,e=0){return await Rh(lh,t,e)}async getStacksAccount(t,e=0){return await Dh(os.Mainnet,t,e)}}class Nh extends Lh{constructor(t){super(Object.assign({bitcoinElectrsApiUrl:"https://blockstream.info/testnet/api",stacksApiUrl:"https://stacks-node-api.testnet.stacks.co"},t))}async getSbtcPegAddress(t=ch){const e=(await this.stacksCallReadOnly({contractAddress:t,functionName:"get-bitcoin-wallet-public-key"})).value.buffer;return wi(33===e.length?e.subarray(1):e,void 0,dh).address}async getBitcoinAccount(t,e=0){return await Rh(dh,t,e)}async getStacksAccount(t,e=0){return await Dh(os.Testnet,t,e)}}class Ch extends Lh{constructor(t){super(Object.assign({bitcoinElectrsApiUrl:"http://127.0.0.1:3002",stacksApiUrl:"http://127.0.0.1:3999"},t));const e=t?.bitcoinCoreRpcUrl??"http://devnet:devnet@127.0.0.1:18433";this.btcRpc=new(jc())(e).Typed}async getSbtcPegAddress(){return(await this.getBitcoinAccount(Hh)).tr.address}async getBitcoinAccount(t,e=0){return await Rh(ph,t,e)}async getStacksAccount(t,e=0){return await Dh(os.Testnet,t,e)}}const Hh="twice kind fence tip hidden tilt action fragile skin nothing glory cousin green tomorrow spring wrist shed math olympic multiply hip blue scout claw",$h="sell invite acquire kitten bamboo drastic jelly vivid peace spawn twice guilt pave pen trash pretty park cube fragile unaware remain midnight betray rebuild",_h="hold excess usual excess ring elephant install account glad dry fragile donkey gaze humble truck breeze nation gasp vacuum limb head keep delay hospital";async function Rh(t,e,r=0){const n=await kr(e),o=Br.fromMasterSeed(n,t.bip32),i=`m/84'/${t.bip84.coin}'/${r}'/0/0`,s=o.derive(i).privateKey,a=o.derive(i).publicKey,c=`m/86'/${t.bip84.coin}'/${r}'/0/0`,h=o.derive(c).privateKey,u=o.derive(c).publicKey;return{privateKey:s,publicKey:a,wpkh:{address:Ci("wpkh",s,t)},tr:{address:Ci("tr",h,t),publicKey:u}}}async function Dh(t,e,r=0){const n=await kr(e),o=zc(function(t){const e=$c(t);return e.length==Dc?e:Vi(e,new Uint8Array([1]))}(Br.fromMasterSeed(n).derive("m/44'/5757'/0'/0").deriveChild(r).privateKey));return{stxPrivateKey:o,privateKey:o,address:Fc(o,t)}}function Fh(t){return new Promise((e=>setTimeout(e,t)))}const Kh=hn;function jh({network:t,address:e}){const r=qc(t.magicBytes),n=Vc(fh.PegIn),o=e.includes(".")?Vc("06"):Vc("05");return Kh(r,n,o,bh(e))}const Mh=Wh;function Wh({network:t=ph,amountSats:e,stacksAddress:r,pegAddress:n=ah}){const o=jh({network:t,address:r}),i=new Ni({allowUnknownInputs:!0,allowUnknownOutputs:!0});return i.addOutput({script:ho.encode(["RETURN",o]),amount:BigInt(0)}),i.addOutputAddress(n,BigInt(e),t),i}async function zh({network:t=ph,amountSats:e,stacksAddress:r,bitcoinChangeAddress:n,feeRate:o,utxos:i,utxoToSpendable:s=Bh,pegAddress:a=ah,paymentPublicKey:c}){c&&(s.sh=Th.bind(null,t,c));const h=Wh({network:t,amountSats:e,stacksAddress:r,pegAddress:a}),u=await mh({tx:h,feeRate:o,utxos:i,utxoToSpendable:s});for(const t of u.inputs)h.addInput(t);const f=u.changeSats-BigInt(Math.ceil(wh*o));return f>vh(wh,o)&&h.addOutputAddress(n,f,t),h}const Vh=hn;async function Gh({network:t=ph,amountSats:e,signature:r,fulfillmentFeeSats:n,bitcoinAddress:o,bitcoinChangeAddress:i,pegAddress:s=ah,feeRate:a,utxos:c,utxoToSpendable:h=Bh,paymentPublicKey:u}){u&&(h.sh=Th.bind(null,t,u));const f=Yh({network:t,amountSats:e,signature:r,bitcoinAddress:o});f.addOutputAddress(s,BigInt(n),t);const l=await mh({tx:f,feeRate:a,utxos:c,utxoToSpendable:h});for(const t of l.inputs)f.addInput(t);const d=l.changeSats-BigInt(Math.ceil(wh*a));return d>vh(wh,a)&&f.addOutputAddress(i,d,t),f}const qh=Yh;function Yh({network:t=ph,amountSats:e,signature:r,bitcoinAddress:n}){const o=Zh({network:t,amountSats:e,signature:r}),i=new Ni({allowUnknownInputs:!0,allowUnknownOutputs:!0});return i.addOutput({script:ho.encode(["RETURN",o]),amount:BigInt(0)}),i.addOutputAddress(n,BigInt(e),t),i}function Zh({network:t=ph,amountSats:e,signature:r}){const n=qc(t.magicBytes),o=Vc(fh.PegOut),i=An.encode(BigInt(e)),s=Vc(r.slice(r.length-2)+r.slice(0,-2));return Vh(n,o,i,s)}function Qh({network:t=ph,amountSats:e,bitcoinAddress:r}){const n=An.encode(BigInt(e)),o=bi.encode(Ai(t).decode(r));return`Withdraw request for ${e} satoshis to the bitcoin address ${r} (${zc(Vh(n,o))})`}})(),i})()));
//# sourceMappingURL=index.js.map